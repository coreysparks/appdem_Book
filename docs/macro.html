<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Applied Demographic Data Analysis - 4&nbsp; Macrodemographic Analysis of Places</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./micro.html" rel="next">
<link href="./survey.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./macro.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Macrodemographic Analysis of Places</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Applied Demographic Data Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Preface</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rintro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./survey.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analysis of Survey Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./macro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Macrodemographic Analysis of Places</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./micro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Event History Models for Microdemography</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#macro-demographic-data-analysis" id="toc-macro-demographic-data-analysis" class="nav-link active" data-scroll-target="#macro-demographic-data-analysis"><span class="header-section-number">5</span> Macro demographic data analysis</a>
  <ul class="collapse">
  <li><a href="#getting-data-on-places" id="toc-getting-data-on-places" class="nav-link" data-scroll-target="#getting-data-on-places"><span class="header-section-number">5.1</span> Getting data on places</a></li>
  <li><a href="#getting-data-on-places-1" id="toc-getting-data-on-places-1" class="nav-link" data-scroll-target="#getting-data-on-places-1"><span class="header-section-number">5.2</span> Getting data on places</a></li>
  <li><a href="#us-contexts" id="toc-us-contexts" class="nav-link" data-scroll-target="#us-contexts"><span class="header-section-number">5.3</span> US contexts</a>
  <ul class="collapse">
  <li><a href="#tidycensus" id="toc-tidycensus" class="nav-link" data-scroll-target="#tidycensus"><span class="header-section-number">5.3.1</span> Tidycensus</a></li>
  <li><a href="#ipums-nhgis" id="toc-ipums-nhgis" class="nav-link" data-scroll-target="#ipums-nhgis"><span class="header-section-number">5.3.2</span> IPUMS NHGIS</a></li>
  <li><a href="#international-data" id="toc-international-data" class="nav-link" data-scroll-target="#international-data"><span class="header-section-number">5.3.3</span> International data</a></li>
  </ul></li>
  <li><a href="#statistical-models-for-place-based-data" id="toc-statistical-models-for-place-based-data" class="nav-link" data-scroll-target="#statistical-models-for-place-based-data"><span class="header-section-number">5.4</span> Statistical models for place-based data</a></li>
  <li><a href="#the-linear-model-framework" id="toc-the-linear-model-framework" class="nav-link" data-scroll-target="#the-linear-model-framework"><span class="header-section-number">5.5</span> The linear model framework</a></li>
  <li><a href="#estimating-the-linear-model-in-r" id="toc-estimating-the-linear-model-in-r" class="nav-link" data-scroll-target="#estimating-the-linear-model-in-r"><span class="header-section-number">5.6</span> Estimating the linear model in R</a></li>
  <li><a href="#assumptions-of-the-ols-model" id="toc-assumptions-of-the-ols-model" class="nav-link" data-scroll-target="#assumptions-of-the-ols-model"><span class="header-section-number">5.7</span> Assumptions of the OLS model</a>
  <ul class="collapse">
  <li><a href="#linearity-assumption" id="toc-linearity-assumption" class="nav-link" data-scroll-target="#linearity-assumption"><span class="header-section-number">5.7.1</span> Linearity assumption</a></li>
  <li><a href="#generalized-least-squares" id="toc-generalized-least-squares" class="nav-link" data-scroll-target="#generalized-least-squares"><span class="header-section-number">5.7.2</span> Generalized Least Squares</a></li>
  <li><a href="#predictions-and-marginal-means" id="toc-predictions-and-marginal-means" class="nav-link" data-scroll-target="#predictions-and-marginal-means"><span class="header-section-number">5.7.3</span> Predictions and marginal means</a></li>
  </ul></li>
  <li><a href="#basics-of-generalized-linear-models" id="toc-basics-of-generalized-linear-models" class="nav-link" data-scroll-target="#basics-of-generalized-linear-models"><span class="header-section-number">5.8</span> Basics of Generalized Linear Models</a>
  <ul class="collapse">
  <li><a href="#binomial-distribution" id="toc-binomial-distribution" class="nav-link" data-scroll-target="#binomial-distribution"><span class="header-section-number">5.8.1</span> Binomial Distribution</a></li>
  </ul></li>
  <li><a href="#poisson-distribution" id="toc-poisson-distribution" class="nav-link" data-scroll-target="#poisson-distribution"><span class="header-section-number">5.9</span> Poisson distribution</a></li>
  <li><a href="#relative-risk-analysis" id="toc-relative-risk-analysis" class="nav-link" data-scroll-target="#relative-risk-analysis"><span class="header-section-number">5.10</span> Relative risk analysis</a></li>
  <li><a href="#overdispersion" id="toc-overdispersion" class="nav-link" data-scroll-target="#overdispersion"><span class="header-section-number">5.11</span> Overdispersion</a></li>
  <li><a href="#modeling-overdispersion-via-a-quasi-distribution" id="toc-modeling-overdispersion-via-a-quasi-distribution" class="nav-link" data-scroll-target="#modeling-overdispersion-via-a-quasi-distribution"><span class="header-section-number">5.12</span> Modeling Overdispersion via a Quasi distribution</a>
  <ul class="collapse">
  <li><a href="#modeling-dispersion-properly" id="toc-modeling-dispersion-properly" class="nav-link" data-scroll-target="#modeling-dispersion-properly"><span class="header-section-number">5.12.1</span> Modeling dispersion properly</a></li>
  </ul></li>
  <li><a href="#other-count-models" id="toc-other-count-models" class="nav-link" data-scroll-target="#other-count-models"><span class="header-section-number">5.13</span> Other count models</a>
  <ul class="collapse">
  <li><a href="#beta-distribution-model" id="toc-beta-distribution-model" class="nav-link" data-scroll-target="#beta-distribution-model"><span class="header-section-number">5.13.1</span> Beta distribution model</a></li>
  <li><a href="#negative-binomial-model" id="toc-negative-binomial-model" class="nav-link" data-scroll-target="#negative-binomial-model"><span class="header-section-number">5.13.2</span> Negative binomial model</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Macrodemographic Analysis of Places</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div style="page-break-after: always;"></div>
<section id="macro-demographic-data-analysis" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Macro demographic data analysis</h1>
<p>Prior to the advent in the 1960’s of large scale social surveys like the General Social Survey (GSS), most demographic research was done not on individuals but on aggregates, because that’s how data were available. If you look at texts such as <span class="citation" data-cites="keyfitz_introduction_1968">Keyfitz (<a href="#ref-keyfitz_introduction_1968" role="doc-biblioref">1968</a>)</span>, all of the examples are for national level calculations, and many nations did not have sufficient data availability to produce quality statistical summaries of their populations, resulting in publications such as the United Nations Population Division’s famous Manual X <span class="citation" data-cites="united_nations_population_division_manual_1983">(<a href="#ref-united_nations_population_division_manual_1983" role="doc-biblioref">1983</a>)</span>, which gave pragmatic formulas to measure a wide variety of demographic indicators at the national level using basic inputs, usually available from census summaries.</p>
<p>Paul Voss <span class="citation" data-cites="voss_demography_2007">(<a href="#ref-voss_demography_2007" role="doc-biblioref">2007</a>)</span> describes most demography (and certainly most demographic studies prior to the 1970’s and 1980’s) as <strong>Macro</strong> demography. Voss also mentions that prior to the availability of individual level microdata, all demography was macro-demography, and most demographic studies were spatial in nature, because demographic data were only available in spatial units corresponding to administrative areas. Typical types of geographic areas would be counties, census tracts, ZIP codes, state or nations.</p>
<p>In the macro-demographic perspective on demography, observations are typically places, areas, or some other aggregate level of individuals. We do not observe the individual people themselves often times. An example of this is if you were to have access to an aggregate count of deaths in a region, even if the deaths were classified by age and sex, you still would be dealing with data that ignores, or has no index to the more nuanced characteristics of the individual decedents themselves. That being said, data such as these are invaluable, and most demographic summaries of individual-level data would aggregate based on the characteristics of the individuals any way. The macro scale principal is illustrated below, where all of the variables we observe are a scale above the individual person.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/macro2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Macro Level Proposition</figcaption>
</figure>
</div>
<p>Such <strong>macro-level propositions</strong> are hypothesized relationships among variables (<span class="math inline">\(\rightarrow\)</span>) measured at a macro scale (<span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>), which ignores individual level data, mostly because we don’t observe individuals (<span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>) in many of these kinds of analysis.</p>
<p>If all we looked at were the individuals within the population, we would be overwhelmed by the variation that we would see, and we wouldn’t be doing statistics anymore, we would be trying to process a million anecdotes, and the plural of anecdote is not data. By aggregating across basic demographic groups, such as age and sex, demographers begin to tease apart the differences that we are interested in. If we go a little further and, data willing, aggregate not only across these fundamental demographic groups, but also across some kind of place-based areal unit, then we adding an extremely important part of human existence: the <strong>where</strong> part of where we live.</p>
<p>This presents an attractive view of populations and typically data on places are more widely available, but there are caveats we must be aware of. If we are using purely aggregate data in our analysis, meaning that we do not have access to the individual level microdata, then our ability to observe variation within a place is extremely limited, if not impossible.</p>
<p>The goal of this chapter is to illustrate how places are a special unit of analysis, and the types of data we often see at the place level are very different from individual level surveys. Additionally, the analysis of place-based data is similar to survey data in that places are do not necessarily represent random observations, and so analyzing data on places often requires special modifications to statistical models. In this chapter, I show how the the linear regression model can be expanded in several ways and illustrate the generalized linear model as a very useful and extendable tool to analyze data on places and especially when we are analyzing rates as demographers often do.</p>
<section id="getting-data-on-places" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="getting-data-on-places"><span class="header-section-number">5.1</span> Getting data on places</h2>
<p>In the macro-demographic perspective on demography, observations are typically places, areas, or some other aggregate level of individuals. We do not observe the individual people themselves often times. An example of this is if you were to have access to an aggregate count of deaths in a region, even if the deaths were classified by age and sex, you still would be dealing with data that ignores, or has no index to the more nuanced characteristics of the individual decedents themselves. That being said, data such as these are invaluable, and most demographic summaries of individual-level data would aggregate based on the characteristics of the individuals any way. The macro scale principal is illustrated below, where all of the variables we observe are a scale above the individual person.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/macro2.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Macro Level Proposition</figcaption>
</figure>
</div>
<p>Such <strong>macro-level propositions</strong> are hypothesized relationships among variables (<span class="math inline">\(\rightarrow\)</span>) measured at a macro scale (<span class="math inline">\(Z\)</span> and <span class="math inline">\(Y\)</span>), which ignores individual level data, mostly because we don’t observe individuals (<span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>) in many of these kinds of analysis.</p>
<p>If all we looked at were the individuals within the population, we would be overwhelmed by the variation that we would see, and we wouldn’t be doing statistics anymore, we would be trying to process a million anecdotes, and the plural of anecdote is not data. By aggregating across basic demographic groups, such as age and sex, demographers begin to tease apart the differences that we are interested in. If we go a little further and, data willing, aggregate not only across these fundamental demographic groups, but also across some kind of place-based areal unit, then we adding an extremely important part of human existence: the <strong>where</strong> part of where we live.</p>
<p>This presents an attractive view of populations and typically data on places are more widely available, but there are caveats we must be aware of. If we are using purely aggregate data in our analysis, meaning that we do not have access to the individual level microdata, then our ability to observe variation within a place is extremely limited, if not impossible.</p>
<p>The goal of this chapter is to illustrate how places are a special unit of analysis, and the types of data we often see at the place level are very different from individual level surveys. Additionally, the analysis of place-based data is similar to survey data in that places are do not necessarily represent random observations, and so analyzing data on places often requires special modifications to statistical models. In this chapter, I show how the the linear regression model can be expanded in several ways and illustrate the generalized linear model as a very useful and extendable tool to analyze data on places and especially when we are analyzing rates as demographers often do.</p>
</section>
<section id="getting-data-on-places-1" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="getting-data-on-places-1"><span class="header-section-number">5.2</span> Getting data on places</h2>
<p>Typically when thinking about data on places, we are really referring to some sort of administrative geography, such as nations, states, region, and census tracts. While these are often readily available (and I’ll show some R package that can easily get data from the web), we often have to use these as proxy measures of more interesting social spaces like neighborhoods and other types of activity spaces. These social spaces are harder to get data on, typically because they are more fluid in their definitions, and there is generally not a systematic effort to produce data on socially defined spaces on national scales. This is a big part of doing macro demography, defining the scale and the unit of analysis, both because we need to define the scope of our work, but also we are very much constrained by the availability of data for our projects. For instance, I may want to look at national scale inequality in mortality risk in neighborhoods in the United States, but you immediately face a couple of hurdles. No national data source identifies sub-city residential location for death certificates, also, what are neighborhoods? Again, they’re probably some socially defined space that may not be available from a national scale source. To get around this, we may have to settle for a state-level analysis, because state vital registration systems will often allow researchers to use more fine-scale geographic data on death certificates (such as latitude/longitude of the decedent’s residence), and once we have very fine scale geographic data on the vital events, we could potentially find data on some more socially defined spaces, perhaps from cities who often maintain geographic data on neighborhoods specific to that city. OK, so that’s fine, but then you still run into the “what’s my denominator” problem, where you have no baseline population data on the age and sex breakdown of the population, or even the population size of these places, because federal agencies don’t produce estimates for such small scale areas. <em>This is frustrating</em>. Often when advising students on their dissertation projects, I have to have this moment of truth where I lay out the problems of the mixing of geographic scales for their projects, and the hard reality of the lack of data on so many things they would like to study. Often what happens is that we have to proxy our ideal places with places for which we can find data. You see this a lot in the population health literature, where people want to analyze <em>neighborhoods</em> but all they have are census tracts. Tracts aren’t social spaces! They’re arbitrary areas of 3 to 5 thousand people, that change every 10 years, that the Census uses to count people. Likewise, counties are very rich areas to find data for, but they are not really activity spaces or neighborhoods, but they may be areas that have some policy making authority (such as county health departments) that <em>could</em> be relevant for something. States are also nice geographies, they’re very large, so you loose the ability to contextualize behavior on a fine spatial scale, but states make a lot of decisions that affect the lives of their residents, often more than national decisions. States have become very popular units of analysis in the health literature again, primarily as a result of differential adoption of portions of the Patient Protection and Affordable Care Act of 2010 <span class="citation" data-cites="soni2017a courtemanche2019">(<a href="#ref-soni2017a" role="doc-biblioref">Soni, Hendryx, and Simon 2017</a>; <a href="#ref-courtemanche2019" role="doc-biblioref">Courtemanche et al. 2019</a>)</span>. This being said, many times when we do an analysis on places, that analysis has lots of limitations, which we must acknowledge, and analyses such as these are often called <em>ecological</em> analyses because we are examining associations at the macro scale, and we do not observe individual level outcomes.</p>
</section>
<section id="us-contexts" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="us-contexts"><span class="header-section-number">5.3</span> US contexts</h2>
<p>The US Census bureau produces a wide variety of geographic data products that are the most widely used forms of geographic data for demographic studies in the United States. The TIGER Line Files data consist of geographic data with census bureau GEOIDs attached so they can be linked to any number of federal statistical products. They do not contain demographic data themselves, but are easily linked. The <code>tigris</code> package in R provides a direct way to download any TIGER line file data type directly in a R session as either a <em>simple feature</em> class or as a <em>Spatial_DataFrame</em> <span class="citation" data-cites="tigris">(<a href="#ref-tigris" role="doc-biblioref">Walker 2021</a>)</span>.</p>
<p>Using the <code>tigris</code> package is very easy and its functions fit directly into the tidyverse as well. Below, I download two layers of information, first the state polygon for New York state, and the census tracts within the state and overlay the two datasets on each other. The package has a function for each type of geography that you would want, for example <code>states()</code> downloads state level geographies and <code>tracts()</code> does the same for census tracts. The functions have some common arguments, including <code>cb = TRUE/FALSE</code> so you can choose cartographic boundary files or not. Cartographic boundary files are lower resolution, smaller files that are often used for thematic mapping. Also <code>year =</code> will allow you to get different annual vintages of the data. The <code>tracts()</code> function also allows you to obtain geographies for specific counties within a state.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>nyst <span class="ot">&lt;-</span> <span class="fu">states</span>(<span class="at">cb =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">year =</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME <span class="sc">==</span> <span class="st">"New York"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>nyst_ct <span class="ot">&lt;-</span> <span class="fu">tracts</span>(<span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cb =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">year =</span> <span class="dv">2010</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>nyst)<span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">lwd =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_sf</span>(<span class="at">data =</span> nyst_ct,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="cn">NA</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"New York State Census Tracts"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="tidycensus" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="tidycensus"><span class="header-section-number">5.3.1</span> Tidycensus</h3>
<p>Another package the provides access to the US Census Bureau Decennial census summary file , the American Community Survey, Census population estimates, migration flow data and Census Public Use Microdata Sample (PUMS) data is <code>tidycensus</code> <span class="citation" data-cites="walker21">(<a href="#ref-walker21" role="doc-biblioref">Walker and Herman 2021</a>)</span>. The <code>tidycensus</code> package primarily works to allow users to use the Census Bureau’s Application Programming Interface (API) to download Census summary file data for places within an R session. This removes the need to download separate files to your computer, and allows users to produce visualizations of Census data easily. The package is actively maintained and has several online tutorials on how to use it <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Depending on which data source you are interested in, there are functions that allow extracts from them. The ACS data is accessed through the <code>get_acs()</code> function, likewise the decennial census data is accessed using the <code>get_decennial()</code> function. The package also allows users to test for differences in ACS estimates either across time or between areas using the <code>significance()</code> function.</p>
<p>The package requires users to obtain a developer API key from the Census Bureau’s developer page<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> and install it on your local computer. The package has a function that helps you install the key to your <code>.Renviron</code> file. It is used like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">census_api_key</span>(<span class="at">key =</span> <span class="st">"yourkeyhere"</span>, <span class="at">install =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which only needs to be done once.</p>
<p>A basic use of the <code>tidycensus</code> package is to get data and produce maps of the indicators. This is done easily because <code>tidycensus</code> fits directly into general <code>dplyr</code> and <code>ggplot2</code> workflows. Below is an example of accessing 2019 ACS data on poverty rate estimates for New York census tracts from New York county, New York. The syntax takes several arguments indicating what level of census geography you want, the year of the estimates, the details of states and counties you may want, and which ACS tables you want. Here I use the Data Profile table for the percentage estimate of families with incomes below the poverty line. The <code>output = "wide"</code> option is useful if you get multiple estimates, as it arranges them into columns, one for each estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>nyny <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">"tract"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">year =</span> <span class="dv">2018</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">state =</span> <span class="st">"NY"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">county =</span> <span class="st">"061"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">variables =</span> <span class="st">"DP03_0119PE"</span>, </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">output =</span> <span class="st">"wide"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">geometry =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Getting data from the 2014-2018 5-year ACS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Downloading feature geometry from the Census website.  To cache shapefiles for use in future sessions, set `options(tigris_use_cache = TRUE)`.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Using the ACS Data Profile</code></pre>
</div>
</div>
<p>The tabular output shows the Estimate column ending in <em>E</em> and the ACS margin of error column ending in <em>M</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">x =</span> <span class="fu">head</span>(nyny),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">format =</span> <span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">GEOID</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">NAME</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DP03_0119PE</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">DP03_0119PM</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">36061020101</td>
<td style="text-align: left;">Census Tract 201.01, New York County, New York</td>
<td style="text-align: right;">0.0</td>
<td style="text-align: right;">20.0</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.96155 4...</td>
</tr>
<tr class="even">
<td style="text-align: left;">36061020701</td>
<td style="text-align: left;">Census Tract 207.01, New York County, New York</td>
<td style="text-align: right;">24.1</td>
<td style="text-align: right;">17.0</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.95922 4...</td>
</tr>
<tr class="odd">
<td style="text-align: left;">36061022200</td>
<td style="text-align: left;">Census Tract 222, New York County, New York</td>
<td style="text-align: right;">18.5</td>
<td style="text-align: right;">9.1</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.95068 4...</td>
</tr>
<tr class="even">
<td style="text-align: left;">36061022600</td>
<td style="text-align: left;">Census Tract 226, New York County, New York</td>
<td style="text-align: right;">15.5</td>
<td style="text-align: right;">9.4</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.94703 4...</td>
</tr>
<tr class="odd">
<td style="text-align: left;">36061000600</td>
<td style="text-align: left;">Census Tract 6, New York County, New York</td>
<td style="text-align: right;">37.5</td>
<td style="text-align: right;">9.8</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.99256 4...</td>
</tr>
<tr class="even">
<td style="text-align: left;">36061001600</td>
<td style="text-align: left;">Census Tract 16, New York County, New York</td>
<td style="text-align: right;">22.2</td>
<td style="text-align: right;">8.5</td>
<td style="text-align: left;">MULTIPOLYGON (((-73.99606 4...</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>The <code>geometry = TRUE</code> option also download the TIGER line file for the requested geography and merges it to the ACS estimates. This allows you to immediately map the estimates for the requested geographies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map of estimates</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>nyny <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span> (<span class="at">Poverty_Rt =</span> DP03_0119PE)<span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Poverty_Rt))<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()<span class="sc">+</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span> ( <span class="at">label =</span> <span class="st">"Poverty Rate in New York Census Tracts"</span>, </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">"2018 ACS Estimates"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The <code>tidycensus</code> package had a great array of functions and the author Kyle Walker has published a book on using it <em>FILL IN CITATION</em> which covers its many uses.</p>
<p>One common task that we should do when visualizing ACS estimates is to examine the coefficient of variation in the estimates. This gives us an idea of how stable the estimates are. This can be particularly problematic as we use smaller and smaller geographies in our analysis. Below, I calculate the coefficient of variation for the estimates and map it. To get the standard error of the ACS estimate, I divide the margin of error by 1.645, following Census Bureau recommendations <span class="citation" data-cites="us_census_bureau_worked_nodate">(<a href="#ref-us_census_bureau_worked_nodate" role="doc-biblioref">Bureau 2019</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>nyny <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span> ( <span class="at">cv =</span><span class="fu">ifelse</span>(<span class="at">test =</span> DP03_0119PE<span class="sc">==</span><span class="dv">0</span>,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">yes =</span> <span class="dv">0</span>,</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">no =</span> (DP03_0119PM<span class="sc">/</span><span class="fl">1.645</span>) <span class="sc">/</span> DP03_0119PE))<span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> cv))<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>()<span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()<span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span> ( <span class="at">label =</span> <span class="st">"Poverty Rate Coefficient of Variation</span><span class="sc">\n</span><span class="st"> in New York Census Tracts"</span>, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">subtitle =</span> <span class="st">"2018 ACS Estimates"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>which shows areas with the highest coefficient of variations mostly adjacent to Central Park and on the lower west side of Manhattan. These are also the areas with the lowest poverty rates in the city, so the estimates have low precision because so few respondents report incomes below the poverty line.</p>
</section>
<section id="ipums-nhgis" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="ipums-nhgis"><span class="header-section-number">5.3.2</span> IPUMS NHGIS</h3>
<p>The IPUMS NHGIS project <a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> is also a great source for demographic data on US places, and allows you to select many demographic tables for census data products going back to the 1790 census <span class="citation" data-cites="nhgis">(<a href="#ref-nhgis" role="doc-biblioref">Manson et al. 2021</a>)</span>. When you perform an extract from the site, you can get both data tables and ESRI shapefiles for your requested geographies. The IPUMS staff have created several tutorials which go through how to construct a query from their site <a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. Below, I use the <code>sf</code> library to read in the geographic data from IPUMS and the tabular data and join them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ipums_co <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">"data/US_county_2020.shp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error: Cannot open "data/US_county_2020.shp"; The file doesn't seem to exist.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>im_dat <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">"data/nhgis0025_ds231_2005_county.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3143 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (7): GISJOIN, AREANAME, STATE, STATEA, COUNTY, COUNTYA, DATAFLAG
dbl (5): YEAR, NOTECODE, AGWE001, AGWI001, AGWJ001

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>m_dat <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="at">x =</span> ipums_co,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> im_dat,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"GISJOIN"</span> <span class="ot">=</span> <span class="st">"GISJOIN"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'ipums_co' not found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>m_dat <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(STATE <span class="sc">==</span> <span class="st">"New York"</span> )<span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span> (<span class="at">fill =</span> AGWJ001))<span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>()<span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="at">label =</span> <span class="st">"Infant Mortality Rate per 10,000 Live Births"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">"New York, 2005"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in eval(expr, envir, enclos): object 'm_dat' not found</code></pre>
</div>
</div>
</section>
<section id="international-data" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="international-data"><span class="header-section-number">5.3.3</span> International data</h3>
<p>Sources of international data exist in numerous sites on the internet. Personally, I frequently will use the DHS Spatial Data repository <a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> to access data from DHS sampled countries. This repository allows you to obtain both spatial administrative boundary data, as well as key indicators of maternal and child health at sub-national levels. Additionally, the <code>rdhs</code> package allows you to perform queries from the spatial data repository and from the DHS microdata as well directly via the DHS API from within an R session <span class="citation" data-cites="rdhs">(<a href="#ref-rdhs" role="doc-biblioref">Watson, FitzJohn, and Eaton 2019</a>)</span>, assuming you have registered with the DHS and have an approved project with them.</p>
</section>
</section>
<section id="statistical-models-for-place-based-data" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="statistical-models-for-place-based-data"><span class="header-section-number">5.4</span> Statistical models for place-based data</h2>
<p>Data on places is often analysed in the same ways as data on individuals, with some notable complications. The remainder of this chapter introduces the regression framework for analyzing data at the macro level, first by a review of the linear model and its associated pitfalls, and then the generalized linear model with a specific focus on the analysis of demographic count outcomes that are commonly observed for places.</p>
<p>In the example below, I use data from the U.S. Health Resources and Services Administration Area Health Resource File (AHRF), which is a produced annually and includes a wealth of information on current and historical data on health infrastructure in U.S. counties, as well as data from the Census Bureau, and the National Center for Health Statistics. The AHRF is publicly available, and we can read the data directly from the HHS website as a SAS format <code>.sas7bdat</code> data set within a ZIP archive. R can read this file to your local computer then extract it using the commands below. I would strongly encourage you consulting the AHRF codebook available from the HRSA website<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>.</p>
<div class="cell" data-messages="false">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create temporary file on  your computer</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">tempfile</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Download the SAS dataset as a ZIP compressed archive</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">"https://data.hrsa.gov/DataDownload/AHRF/AHRF_2019-2020_SAS.zip"</span>, temp)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Read SAS data into R</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>ahrf<span class="ot">&lt;-</span>haven<span class="sc">::</span><span class="fu">read_sas</span>(<span class="fu">unz</span>(temp,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">filename =</span> <span class="st">"ahrf2020.sas7bdat"</span>))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(temp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, I remove many of the variables in the AHRF and recode several others. In the analysis examples that follow in this chapter, I will focus on the outcome of low birth weight births, measured at the county level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ahrf2<span class="ot">&lt;-</span>ahrf<span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cofips =</span> f00004, </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">coname =</span> f00010,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">state =</span> f00011,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">popn =</span>  f1198416,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">births1618 =</span>  f1254616, </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">lowbw1618 =</span> f1255316,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">fampov14 =</span>  f1443214,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">lbrate1618 =</span> <span class="dv">1000</span><span class="sc">*</span>(f1255316<span class="sc">/</span>f1254616),  <span class="co">#Rate per 1000 births</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">rucc =</span> <span class="fu">as.factor</span>(f0002013),</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">hpsa16 =</span> <span class="fu">case_when</span>(.<span class="sc">$</span>f0978716 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'no shortage'</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                            .<span class="sc">$</span>f0978716 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'whole county shortage'</span>,</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                            .<span class="sc">$</span>f0978716 <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">'partial county shortage'</span>),</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">obgyn15_pc=</span> <span class="dv">1000</span><span class="sc">*</span>( f1168415 <span class="sc">/</span> f1198416 ) )<span class="sc">%&gt;%</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rucc =</span> <span class="fu">droplevels</span>(rucc, <span class="st">""</span>))<span class="sc">%&gt;%</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(births1618,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                lowbw1618,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                lbrate1618,</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                state,</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                cofips,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                coname,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                popn,</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>                fampov14,</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>                rucc,</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>                hpsa16,</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>                obgyn15_pc)<span class="sc">%&gt;%</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.))<span class="sc">%&gt;%</span></span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In order to make a nice looking map of the outcome, I use the <code>tigris</code> package to fetch geographic data for US states and counties, then merge the county data to the AHRF data using <code>left_join()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">tigris_class=</span><span class="st">"sf"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>usco<span class="ot">&lt;-</span><span class="fu">counties</span>(<span class="at">cb =</span> T, <span class="at">year=</span> <span class="dv">2016</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>usco<span class="sc">$</span>cofips<span class="ot">&lt;-</span>usco<span class="sc">$</span>GEOID</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>sts<span class="ot">&lt;-</span><span class="fu">states</span>(<span class="at">cb =</span> T, <span class="at">year =</span> <span class="dv">2016</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>sts<span class="ot">&lt;-</span><span class="fu">st_boundary</span>(sts)<span class="sc">%&gt;%</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>STATEFP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"02"</span>, <span class="st">"15"</span>, <span class="st">"60"</span>, <span class="st">"66"</span>, <span class="st">"69"</span>, <span class="st">"72"</span>, <span class="st">"78"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">2163</span>)</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>ahrf_m<span class="ot">&lt;-</span><span class="fu">left_join</span>(usco, ahrf2,</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">by =</span> <span class="st">"cofips"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(lbrate1618)<span class="sc">==</span>F, </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span>STATEFP <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"02"</span>, <span class="st">"15"</span>, <span class="st">"60"</span>, <span class="st">"66"</span>, <span class="st">"69"</span>, <span class="st">"72"</span>, <span class="st">"78"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="dv">2163</span>)</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ahrf_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>There are a total of 2,418 observations in the data, because the HRSA restricts some counties with small numbers of births from the data.</p>
<p>Here is a <code>ggplot()</code> histogram of the low birth weight rate for US counties.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ahrf_m<span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> lbrate1618))<span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Low Birth Weight Rates in US Counties"</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"2016 - 2018"</span>)<span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">xlab</span>(<span class="st">"Rate per 1,000 Live Births"</span>)<span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span> (<span class="st">"Frequency"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Here, we do a basic map of the outcome variable for the continental US, and see the highest rates of low birth weight births in the US occur in the southeastern areas of the country. Notice, I do not color the boundaries of the counties in order to maximize the reader’s ability to see the variation, instead I show lines between states by overlaying the <code>sts</code> layer from above. I also add cartographic options of a scale bar and a north arrow, which I personally believe should be on any map shown to the public.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(ahrf_m)<span class="sc">+</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">"lbrate1618"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">border.col =</span> <span class="cn">NULL</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">title=</span><span class="st">"Low Birth Weight Rt"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette=</span><span class="st">"Blues"</span>,</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">"quantile"</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">n=</span><span class="dv">5</span>,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">showNA=</span>T, <span class="at">colorNA =</span> <span class="st">"grey50"</span>)<span class="sc">+</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tm_format</span>(<span class="at">format=</span> <span class="st">"World"</span>,</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">main.title=</span><span class="st">"US Low Birth Weight Rate by County"</span>,</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span>  <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">main.title.position =</span><span class="fu">c</span>(<span class="st">"center"</span>))<span class="sc">+</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">position =</span> <span class="fu">c</span>(.<span class="dv">1</span>,<span class="dv">0</span>))<span class="sc">+</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>()<span class="sc">+</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(sts)<span class="sc">+</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>( <span class="at">col =</span> <span class="st">"black"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>When doing analysis of place-based data, maps are almost a fundamental aspect of the analysis and often convey much more information about the distribution of the outcome than either distribution plots or summary statistics.</p>
</section>
<section id="the-linear-model-framework" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="the-linear-model-framework"><span class="header-section-number">5.5</span> The linear model framework</h2>
<p>Probably the most used and often abused statistical model is the linear regression model, sometimes called the OLS model because it is typically estimated by the method of least squares. I do not plan on spending a lot of real estate in this this book talking about the linear model, mostly because lots of times it doesn’t get us very far, and there are much more thorough books on this subject, one of my personal favorites being John Fox’s text on applied regression <span class="citation" data-cites="fox_applied_2016">(<a href="#ref-fox_applied_2016" role="doc-biblioref">Fox 2016</a>)</span>.</p>
<p>This model is typically shown as:</p>
<p><span class="math display">\[y_i = \beta_0 +\sum_k \beta_k x_{ki} + \epsilon_i\]</span></p>
<p>with the <span class="math inline">\(\beta\)</span>’s being parameters that define the linear relationship between the independent variables <span class="math inline">\(x_k\)</span>, and <span class="math inline">\(y\)</span>, and <span class="math inline">\(\epsilon_i\)</span> being the unexplained, or residual portion of <span class="math inline">\(y\)</span> that is included in the model. The model has several assumptions that we need to worry about, first being normality of the residuals, or</p>
<p><span class="math display">\[\epsilon_i \sim Normal(0, \sigma_\epsilon)\]</span></p>
<p>Where <span class="math inline">\(\sigma_\epsilon ^2\)</span> is the residual variance, or mean square error of the model. Under the strict assumptions of the linear model, the Gauss-Markov theorem says that the unbiased and minimum variance estimates of the <span class="math inline">\(\beta\)</span>’s is:</p>
<p><span class="math display">\[
\beta_k = \frac{\sum (y_i - \bar{y})(x_i - \bar{x})}{\sum x_i - \bar{x}^2} = \frac{Cov(x,y)}{Var(x)}
\]</span></p>
<p>Which is often shown in the more compact matrix form:</p>
<p><span class="math display">\[\beta_k = (X'X)^{-1} X'Y\]</span></p>
<p>We could just as directly write the model in it’s distributional form as:</p>
<p><span class="math display">\[
y_i \sim Normal(\beta_0 +\sum_k \beta_k x_{ki}, \sigma_\epsilon)
\]</span></p>
<p>or even as:</p>
<p><span class="math display">\[
y_i \sim Normal(X' \beta, \sigma_\epsilon)
\]</span></p>
<p>Which I prefer because it sets up the regression equation as the <strong>linear predictor</strong>, or linear combination (in the linear algebra sense) of the predictors and the model parameters for the mean of the outcome. This term, linear predictor, is a useful one, because as you get more and more accustomed to regression, you will see this same structure in every regression model you ever do. This is the fundamental workhorse of regression, where we get an estimated value for every combination of the observed predictors. Moreover, below when I present the <strong>Generalized Linear Model</strong>, it will be apparent that the linear predictor can be placed within a number of so-called <strong>link functions</strong> to ensure that the mean of the outcome agrees with the assumed distribution for the outcome.</p>
</section>
<section id="estimating-the-linear-model-in-r" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="estimating-the-linear-model-in-r"><span class="header-section-number">5.6</span> Estimating the linear model in R</h2>
<p>The linear model is included in the base R <code>stats</code> package, and is accessed by the <code>lm()</code> function. In the example below, I use data from the U.S. Health Resources and Services Administration Area Health Resource File (AHRF) to estimate a model of the associations between the poverty rate, the rurality of the county and whether the county is a healthcare shortage area. This is a mixture of continuous (or partially continuous) and categorical predictors.</p>
<p>The basic <code>lm()</code> model syntax is specified as <code>lm ( y ~ x_1 + x_2, data = dataname)</code> with the <code>~</code> operator representing the formula for the model equation, with the outcome on the left and the predictors on the right. You also provide the name of the dataframe which contains the variables specified in the formula in a <code>data=</code> argument. For help on the function and to see the other potential arguments use <code>?lm</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lm1 <span class="ot">&lt;-</span> <span class="fu">lm</span> (lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16, <span class="at">data =</span> ahrf_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This stores the model data and parameter estimates in the object called <code>lm1</code>. You can name the object anything you wish, just try to avoid using other R commands as object names. For instance, I wouldn’t want to call an object <code>mean</code> or <code>sd</code> because those are names of functions. The basic way to see the model results is to use the <code>summary()</code> function on the model fit.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lbrate1618 ~ fampov14 + rucc + hpsa16, data = ahrf_m)

Residuals:
    Min      1Q  Median      3Q     Max 
-90.114 -10.345  -1.229   9.287  77.778 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   62.26920    1.18901  52.371  &lt; 2e-16 ***
fampov14                       2.25805    0.06846  32.981  &lt; 2e-16 ***
rucc02                        -1.91854    1.20082  -1.598 0.110249    
rucc03                        -3.38658    1.25055  -2.708 0.006818 ** 
rucc04                        -6.65483    1.40639  -4.732 2.36e-06 ***
rucc05                        -5.96283    1.93739  -3.078 0.002110 ** 
rucc06                        -3.94180    1.14317  -3.448 0.000575 ***
rucc07                        -4.00730    1.28166  -3.127 0.001790 ** 
rucc08                         0.45112    2.11062   0.214 0.830770    
rucc09                        -3.88365    2.29118  -1.695 0.090202 .  
hpsa16partial county shortage -0.66219    1.00767  -0.657 0.511148    
hpsa16whole county shortage    2.36214    1.25335   1.885 0.059601 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.36 on 2312 degrees of freedom
Multiple R-squared:  0.3697,    Adjusted R-squared:  0.3667 
F-statistic: 123.3 on 11 and 2312 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We see that there is a significant positive association between family poverty and the low birth weight rate, we also see that there is a tendency for more rural areas to have lower low birth weight rates than the largest cities (Reference level = <code>rucc01</code>). There is a marginally significant association between a county being a healthcare shortage area and the low birth weight rate. Overall the model is explaining about a third of the variation in the outcome, as seen in the adjusted R-Square value of .3667.</p>
<section id="a-not-on-interpretation" class="level4" data-number="5.6.0.1">
<h4 data-number="5.6.0.1" class="anchored" data-anchor-id="a-not-on-interpretation"><span class="header-section-number">5.6.0.1</span> A not on interpretation</h4>
<p>It is important to remember, when describing results for place-based data, to avoid using language centered on individuals. For instance, with reference to the <code>fampov14</code> variable, we cannot say that families living in poverty are more likely to have a low birth weight birth, instead, we must focus on discussion on <em>places</em> with higher rates of poverty having a higher rate of low birth weight births. Ascribing individual risk from an ecological analysis is an example of the <em>ecological fallacy</em> often seen when doing place-based analysis, and we must be aware of it when framing our questions and describing our results.</p>
<p>The <code>gtsummary</code> package <span class="citation" data-cites="gtsummary">(<a href="#ref-gtsummary" role="doc-biblioref">Sjoberg et al. 2021</a>)</span> provides a very nice interface to produce much better looking summaries of models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>lm1<span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">add_estimate_to_reference_rows =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="kpndrzuyoi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kpndrzuyoi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kpndrzuyoi thead, #kpndrzuyoi tbody, #kpndrzuyoi tfoot, #kpndrzuyoi tr, #kpndrzuyoi td, #kpndrzuyoi th {
  border-style: none;
}

#kpndrzuyoi p {
  margin: 0;
  padding: 0;
}

#kpndrzuyoi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kpndrzuyoi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kpndrzuyoi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kpndrzuyoi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kpndrzuyoi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpndrzuyoi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpndrzuyoi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpndrzuyoi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kpndrzuyoi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kpndrzuyoi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kpndrzuyoi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kpndrzuyoi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kpndrzuyoi .gt_spanner_row {
  border-bottom-style: hidden;
}

#kpndrzuyoi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kpndrzuyoi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kpndrzuyoi .gt_from_md > :first-child {
  margin-top: 0;
}

#kpndrzuyoi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kpndrzuyoi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kpndrzuyoi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kpndrzuyoi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kpndrzuyoi .gt_row_group_first td {
  border-top-width: 2px;
}

#kpndrzuyoi .gt_row_group_first th {
  border-top-width: 2px;
}

#kpndrzuyoi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpndrzuyoi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kpndrzuyoi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kpndrzuyoi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpndrzuyoi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpndrzuyoi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kpndrzuyoi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kpndrzuyoi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kpndrzuyoi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpndrzuyoi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpndrzuyoi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpndrzuyoi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpndrzuyoi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpndrzuyoi .gt_left {
  text-align: left;
}

#kpndrzuyoi .gt_center {
  text-align: center;
}

#kpndrzuyoi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kpndrzuyoi .gt_font_normal {
  font-weight: normal;
}

#kpndrzuyoi .gt_font_bold {
  font-weight: bold;
}

#kpndrzuyoi .gt_font_italic {
  font-style: italic;
}

#kpndrzuyoi .gt_super {
  font-size: 65%;
}

#kpndrzuyoi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kpndrzuyoi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kpndrzuyoi .gt_indent_1 {
  text-indent: 5px;
}

#kpndrzuyoi .gt_indent_2 {
  text-indent: 10px;
}

#kpndrzuyoi .gt_indent_3 {
  text-indent: 15px;
}

#kpndrzuyoi .gt_indent_4 {
  text-indent: 20px;
}

#kpndrzuyoi .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">% Families Below Poverty Level 2014-18</td>
<td headers="estimate" class="gt_row gt_center">2.3</td>
<td headers="ci" class="gt_row gt_center">2.1, 2.4</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">rucc</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;01</td>
<td headers="estimate" class="gt_row gt_center">0.00</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;02</td>
<td headers="estimate" class="gt_row gt_center">-1.9</td>
<td headers="ci" class="gt_row gt_center">-4.3, 0.44</td>
<td headers="p.value" class="gt_row gt_center">0.11</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;03</td>
<td headers="estimate" class="gt_row gt_center">-3.4</td>
<td headers="ci" class="gt_row gt_center">-5.8, -0.93</td>
<td headers="p.value" class="gt_row gt_center">0.007</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;04</td>
<td headers="estimate" class="gt_row gt_center">-6.7</td>
<td headers="ci" class="gt_row gt_center">-9.4, -3.9</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;05</td>
<td headers="estimate" class="gt_row gt_center">-6.0</td>
<td headers="ci" class="gt_row gt_center">-9.8, -2.2</td>
<td headers="p.value" class="gt_row gt_center">0.002</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;06</td>
<td headers="estimate" class="gt_row gt_center">-3.9</td>
<td headers="ci" class="gt_row gt_center">-6.2, -1.7</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;07</td>
<td headers="estimate" class="gt_row gt_center">-4.0</td>
<td headers="ci" class="gt_row gt_center">-6.5, -1.5</td>
<td headers="p.value" class="gt_row gt_center">0.002</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;08</td>
<td headers="estimate" class="gt_row gt_center">0.45</td>
<td headers="ci" class="gt_row gt_center">-3.7, 4.6</td>
<td headers="p.value" class="gt_row gt_center">0.8</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;09</td>
<td headers="estimate" class="gt_row gt_center">-3.9</td>
<td headers="ci" class="gt_row gt_center">-8.4, 0.61</td>
<td headers="p.value" class="gt_row gt_center">0.090</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hpsa16</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no shortage</td>
<td headers="estimate" class="gt_row gt_center">0.00</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;partial county shortage</td>
<td headers="estimate" class="gt_row gt_center">-0.66</td>
<td headers="ci" class="gt_row gt_center">-2.6, 1.3</td>
<td headers="p.value" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;whole county shortage</td>
<td headers="estimate" class="gt_row gt_center">2.4</td>
<td headers="ci" class="gt_row gt_center">-0.10, 4.8</td>
<td headers="p.value" class="gt_row gt_center">0.060</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="assumptions-of-the-ols-model" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="assumptions-of-the-ols-model"><span class="header-section-number">5.7</span> Assumptions of the OLS model</h2>
<p>The linear model has several assumptions that we need to be concerned with, the big four are</p>
<ol type="1">
<li><em>Normality of residuals</em>,</li>
<li><em>Constant variance in residuals, or</em> <em><em>homoskedasticity</em></em>, and</li>
<li><em>Linearity of the regression function</em>, and</li>
<li><em>Independence of observations</em></li>
</ol>
<p>The normality assumption is linked to distributional assumption underlying the linear regression model. This states that the model residuals, calculated as <span class="math inline">\(e_i = (\beta_0 +\sum_k \beta_k x_{ki}) - y_i\)</span>, or more compactly as <span class="math inline">\(e_i =\hat{y_i} - y_i\)</span> follow a normal distribution. If the errors around the mean function are not normally distributed, this can be an indicator that the linear model is not appropriate for the outcome under consideration. A commonly used graphical check of this is the <em>quantile-quantile</em> or Q-Q plot, which plots the residuals from a model against the hypothetical quantiles from a normal distribution.</p>
<p>We can check these for our model above easily:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">residuals</span>(lm1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(<span class="fu">resid</span>(lm1)),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Density plot of the residuals"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,<span class="dv">0</span>,<span class="fu">sd</span>(<span class="fu">resid</span>(lm1))),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span><span class="dv">2</span>, <span class="at">add=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm1, <span class="at">which =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>While the overall distribution of the residuals is fairly normal based on the histogram and the comparison to the normal density plot, the q-q plot shows that the tails of the distribution are not well modeled by the normal distribution because there are several observations that are too far below or above the theoretical line (dotted line).</p>
<p>The <em>homoskedasticity</em> assumption is also tied to the normal distributional assumption of the model, as see above, if we write the model in its distributional form, <span class="math inline">\(y_i \sim Normal(X' \beta, \sigma_\epsilon)\)</span>, the term $ _$ is a single parameter, meaning that we only have one of these in a linear regression model. This parameter determines the spread of the variation around the mean function. Larger values equal more spread around the mean, and smaller values equal less spread. A commonly used graphical procedure to detect lack of homoskedasticity, or <em>heteroskedasticity</em>, is an envelope plot, or a plot of the residuals against the fitted values from the model. Formal tests also exist including the <em>Breusch-Pagan test</em> and the modified version of this test developed by Cook and Weisberg [cite]</p>
<p>A graphical check of this assumption is easily done from the model fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lm1, <span class="at">which =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>These plots show some evidence that the error variances are non-constant. The first plot has the very characteristic “fish” or “cone” shape, where the error variances increase as the fitted values increase. We can also do a formal test using functions from the <code>car</code> package:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 469.4844, Df = 1, p = &lt; 2.22e-16</code></pre>
</div>
</div>
<p>Which again shows more statistical evidence of the non-constant variance in residuals.</p>
<section id="correction-for-non-constant-variance" class="level4" data-number="5.7.0.1">
<h4 data-number="5.7.0.1" class="anchored" data-anchor-id="correction-for-non-constant-variance"><span class="header-section-number">5.7.0.1</span> Correction for non-constant variance</h4>
<p>The assumption of homoskedasticity is important for two reasons, first is related to prediction from the model, but the second is related to the test statistics derived from the model. In order to test our hypothesis that <span class="math inline">\(x\)</span> is related to <span class="math inline">\(y\)</span>, we form the ratio of the <span class="math inline">\(\beta_1\)</span> parameter to its error, this is typically either a <span class="math inline">\(z\)</span>, <span class="math inline">\(t\)</span> or Wald <span class="math inline">\(\chi^2\)</span> statistic, depending on which procedure you’re using.</p>
<p><span class="math display">\[t = \frac{\hat{\beta_1}}{se(\beta_1))}\]</span> The term <span class="math inline">\(se(\beta_1)\)</span> is the estimated standard error of the parameter, and is calculated using the ratio of the residual standard deviation and the square root of the sums of squares of the <span class="math inline">\(x\)</span>:</p>
<p><span class="math display">\[se(\beta_1) = \frac{\sigma_{\epsilon}}{\sqrt{\sum(x - \bar{x})^2}}\]</span></p>
<p>or in the matrix terms:</p>
<p><span class="math display">\[Var(\beta) = \sigma_{\epsilon}(X'X)^{-1}\]</span></p>
<p>if the term <span class="math inline">\(\sigma_{\epsilon}\)</span> is not constant then the standard error of each parameter in the model is incorrect. Corrections for heteroskedasticity are commonplace in the social sciences, and are usually attributed to White <span class="citation" data-cites="white_1980">(<a href="#ref-white_1980" role="doc-biblioref">1980</a>)</span> and MacKinnon and White <span class="citation" data-cites="mackinnon_white_1985">(<a href="#ref-mackinnon_white_1985" role="doc-biblioref">1985</a>)</span> with many additions since the original publication, notably Long and Ervin <span class="citation" data-cites="long_using_2000">(<a href="#ref-long_using_2000" role="doc-biblioref">2000</a>)</span>. These corrections use the empirically observed error terms and avoid the assumption of common variance in all residuals.</p>
<p>The <code>coeftest()</code> function in the <code>lmtest</code> package is one option to correct for heteroskedasticity in regression models. It allows for various correction types, with the “HC3” type <span class="citation" data-cites="long_using_2000">(<a href="#ref-long_using_2000" role="doc-biblioref">Long and Ervin 2000</a>)</span> being the default for linear models. Below, I show the default tests assuming constant variance and the corrected tests.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(lm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                               Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)                   62.269198   1.189010 52.3706 &lt; 2.2e-16 ***
fampov14                       2.258054   0.068465 32.9813 &lt; 2.2e-16 ***
rucc02                        -1.918536   1.200819 -1.5977 0.1102488    
rucc03                        -3.386577   1.250553 -2.7081 0.0068176 ** 
rucc04                        -6.654825   1.406391 -4.7318 2.359e-06 ***
rucc05                        -5.962826   1.937392 -3.0778 0.0021101 ** 
rucc06                        -3.941799   1.143175 -3.4481 0.0005746 ***
rucc07                        -4.007304   1.281664 -3.1266 0.0017901 ** 
rucc08                         0.451120   2.110622  0.2137 0.8307703    
rucc09                        -3.883651   2.291182 -1.6950 0.0902020 .  
hpsa16partial county shortage -0.662194   1.007671 -0.6572 0.5111478    
hpsa16whole county shortage    2.362138   1.253348  1.8847 0.0596007 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(lm1, <span class="at">vcov  =</span> <span class="fu">vcovHC</span>(lm1, <span class="at">type =</span> <span class="st">"HC3"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                              Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)                   62.26920    1.14941 54.1749 &lt; 2.2e-16 ***
fampov14                       2.25805    0.11349 19.8966 &lt; 2.2e-16 ***
rucc02                        -1.91854    0.97531 -1.9671 0.0492896 *  
rucc03                        -3.38658    1.06364 -3.1839 0.0014722 ** 
rucc04                        -6.65483    1.20922 -5.5034 4.137e-08 ***
rucc05                        -5.96283    1.95622 -3.0481 0.0023288 ** 
rucc06                        -3.94180    1.09704 -3.5931 0.0003336 ***
rucc07                        -4.00730    1.30130 -3.0795 0.0020981 ** 
rucc08                         0.45112    2.42803  0.1858 0.8526203    
rucc09                        -3.88365    3.29696 -1.1779 0.2389381    
hpsa16partial county shortage -0.66219    0.85442 -0.7750 0.4384068    
hpsa16whole county shortage    2.36214    1.26921  1.8611 0.0628553 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The take away in this example is that non-constant variance can affect the standard errors of the model parameter estimates, and in turn affect the test statistics that we base all of our hypothesis tests on. In the particulars of this model there is not a lot of change, the <code>rucc02</code> parameter is barley significant once using the corrected standard errors, otherwise we see a very similar pattern in terms of what is significant in the model.</p>
</section>
<section id="clustered-standard-errors" class="level4" data-number="5.7.0.2">
<h4 data-number="5.7.0.2" class="anchored" data-anchor-id="clustered-standard-errors"><span class="header-section-number">5.7.0.2</span> Clustered standard errors</h4>
<p>Another commonly used correction in regression modeling is the <em>clustered standard error</em>. These are commonplace and almost the default in the Stata programming environment, and are widely used in the field of economics. Clustering of standard errors attempts to correct for clustering in the residuals from the regression model. Clustering can happen for a wide variety of reasons, and as we saw in the previous chapter on survey data analysis, is often an artifact of how the data are collected. With place-based data, we may have clustering because the places are close to each other, or because the share some other characteristic that we have not measured in our regression model. In the case of our regression model, and in our descriptive analysis of our outcome, the map shown prior may indicate some form of <em>spatial correlation</em> in the outcome. While there are models to deal with such non-independence in place-based data, they are not a subject I will touch on here. Instead, we may use the state which each county is in as a proxy for the spatial clustering in the outcome, as one example of potential of a clustering term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(lm1,</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">vcov  =</span> <span class="fu">vcovCL</span>(lm1, <span class="at">cluster =</span> ahrf_m<span class="sc">$</span>state))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

                              Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)                   62.26920    2.43737 25.5477 &lt; 2.2e-16 ***
fampov14                       2.25805    0.28830  7.8322 7.243e-15 ***
rucc02                        -1.91854    1.15345 -1.6633  0.096387 .  
rucc03                        -3.38658    1.42381 -2.3785  0.017462 *  
rucc04                        -6.65483    1.35050 -4.9277 8.912e-07 ***
rucc05                        -5.96283    2.60314 -2.2906  0.022075 *  
rucc06                        -3.94180    1.28117 -3.0767  0.002118 ** 
rucc07                        -4.00730    2.11299 -1.8965  0.058017 .  
rucc08                         0.45112    2.59621  0.1738  0.862069    
rucc09                        -3.88365    4.73238 -0.8207  0.411927    
hpsa16partial county shortage -0.66219    1.18695 -0.5579  0.576971    
hpsa16whole county shortage    2.36214    1.80407  1.3093  0.190549    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>In this case, the <code>rucc02</code> and <code>rucc07</code> terms become marginally significant and the healthcare shortage areas lose their marginal significance.</p>
</section>
<section id="weighted-least-squares" class="level4" data-number="5.7.0.3">
<h4 data-number="5.7.0.3" class="anchored" data-anchor-id="weighted-least-squares"><span class="header-section-number">5.7.0.3</span> Weighted Least Squares</h4>
<p>Another method of dealing with non-constant error variance is the method of weighted least squares. This method modifies the model somewhat to be:</p>
<p><span class="math display">\[y \sim Normal(\beta_0 +\sum_k \beta_k x_{ki}, \sigma_{\epsilon_i} )\]</span></p>
<p>Where the term <span class="math inline">\(\sigma_{\epsilon_i}\)</span> represents the different variances for each observation. The weights in the model are often variables that represent an underlying factor that affects the variance in the estimates. In demography this is often the population size of a place, as places with smaller population sizes often have more volatility to their rate estimates. This approach has been used in the spatial demographic modeling of county mortality rates in the United States by several authors <span class="citation" data-cites="mclaughlin_differential_2007 sparks_application_2010">(<a href="#ref-mclaughlin_differential_2007" role="doc-biblioref">McLaughlin et al. 2007</a>; <a href="#ref-sparks_application_2010" role="doc-biblioref">Sparks and Sparks 2010</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>lm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> popn)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lbrate1618 ~ fampov14 + rucc + hpsa16, data = ahrf_m, 
    weights = popn)

Weighted Residuals:
   Min     1Q Median     3Q    Max 
-42957  -2122   -106   2333  27618 

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   65.54503    0.98536  66.519  &lt; 2e-16 ***
fampov14                       1.83332    0.06338  28.928  &lt; 2e-16 ***
rucc02                        -0.63464    0.66623  -0.953 0.340901    
rucc03                        -1.67371    0.93793  -1.784 0.074479 .  
rucc04                        -4.38387    1.31520  -3.333 0.000872 ***
rucc05                        -3.31398    2.16308  -1.532 0.125642    
rucc06                        -1.87074    1.35213  -1.384 0.166630    
rucc07                        -2.12596    1.80385  -1.179 0.238693    
rucc08                         3.92060    4.33118   0.905 0.365452    
rucc09                        -0.21442    4.93030  -0.043 0.965315    
hpsa16partial county shortage -1.85070    0.93518  -1.979 0.047938 *  
hpsa16whole county shortage    0.21786    1.65417   0.132 0.895229    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4620 on 2312 degrees of freedom
Multiple R-squared:  0.2832,    Adjusted R-squared:  0.2798 
F-statistic: 83.05 on 11 and 2312 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We see that by including the population size weights in the model, most of the parameters are no longer significant in the analysis, but the weights have not dealt with the non-constant variance issue totally:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ncvTest</span>(lm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 84.49228, Df = 1, p = &lt; 2.22e-16</code></pre>
</div>
</div>
<p>But the overall size of the non-constant variance test is much lower than it was for the original model.</p>
</section>
<section id="linearity-assumption" class="level3" data-number="5.7.1">
<h3 data-number="5.7.1" class="anchored" data-anchor-id="linearity-assumption"><span class="header-section-number">5.7.1</span> Linearity assumption</h3>
<p>The linearity assumption of the model assumes that the true underlying relationship in the data can be modeled using a linear combination of the predictors and the parameters. I think a lot of people think this means that you cannot include square or polynomial terms in a regression model, but that is not the case. The assumption is concerned with the linearity of the parameters, not the predictor variables themselves. For example the standard linear model with one predictor, x is written:</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 x_1 + \epsilon\]</span></p>
<p>Which is clearly the equation for a straight line with y-intercept <span class="math inline">\(\beta_0\)</span> and slope <span class="math inline">\(\beta_1\)</span>. We also see that the parameters combine in a linear (additive) fashion. This is the assumption of the model, and can also be seen when expressing this equation using vector notation</p>
<p><span class="math display">\[y = x' \beta\]</span></p>
<p>Because the term <span class="math inline">\(x' \beta\)</span> is the inner product of the <span class="math inline">\(\beta\)</span> parameters and the information from <span class="math inline">\(x\)</span>. If we include the square of <span class="math inline">\(x\)</span> in the model:</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 x_1 + \beta_2 x_1^2 + \epsilon\]</span> The same inner, additive product of the <span class="math inline">\(\beta\)</span>s and the <span class="math inline">\(x\)</span>s is still the same. If we constructed a model that was non-linear function of the <span class="math inline">\(\beta\)</span>s, such as:</p>
<p><span class="math display">\[y = \beta_0 + \beta_1 x_1 *  e^{\beta_2 x_1^2} + \epsilon\]</span> The the model would no longer be linear in the parameters because we introduce a nonlinearity by exponentiating the <span class="math inline">\(\beta_2\)</span> parameter inside the mean function (not that this is a real model, just as an example).</p>
<p>When this actually comes into our experience is when our data are actually generated by a nonlinear process, such as a time series with seasonality included, which may oscillate between seasons (such as temperature, or rainfall), for instance a situation such as this arises:</p>
<p>Where the variable y is actually generated from a cosine curve with noise. Since the linear regression of y on x forces the y to change linearly with x, the model is absolutely unable to recover the underlying pattern in the data.</p>
<style>
div.blue { background-color:#e6f0ff; border-radius: 5px; padding: 20px;}
</style>
<div class="blue">
<p><strong>A note on splines</strong></p>
<p>If the data clearly do not display a linear trend, I personally automatically look to <em>splines</em> as a means to model the non-linearity in relationship. Splines are a method of constructing a model based on connecting either linear or non-linear functions across a series of breaks or <strong><em>knots</em></strong> along the data in which the form of the function changes.</p>
<p>Mathematically, knots can be written as:</p>
$$ Y(x) =
<span class="math display">\[\begin{Bmatrix}
F_1(x) \text {  for  } x\in [x_1, x_2]\\
F_2(x) \text {  for  } x\in [x_2, x_3]\\
\cdots \\
F_{k}(x) \text {  for  } x\in [x_{k-1}, x_k]\\

\end{Bmatrix}\]</span>
<p>$$</p>
<p>Where each of the <span class="math inline">\(F_k (x)\)</span> functions imply a different form in the interval between <span class="math inline">\(x\in [x_{k-1}, x_k]\)</span>, where the <span class="math inline">\(k\)</span> breaks are at a given knot in the data. Most splines are nonlinear functions, usually cubic polynomials, and the spline model combines a series of these polynomials to model nonlinearities in the relationship between predictors and outcomes. A relatively recent invention, <em>Generalized Additive Models</em> or <em>GAMs</em> are a way to model an outcome with both linear and non-linear terms together. The GAM model forms the linear predictor of a model can be constructed as:</p>
<p><span class="math display">\[E(y)= \beta_0 + f(x_1) + \beta_1 x_2\]</span> where the <span class="math inline">\(f(x_1)\)</span> term is a regression spline of one of the variables. The models can be a mixture of linear and smooth terms. Here is an example of using a B-spline within the <code>lm()</code> model to fit a smooth regression function to the messy nonlinear model above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>sm<span class="ot">&lt;-</span> <span class="fu">lm</span>(y2<span class="sc">~</span><span class="fu">bs</span>(t, <span class="at">df =</span> <span class="dv">5</span>))</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(t, y2, <span class="at">t=</span><span class="st">"p"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">range</span>(y2) <span class="sc">*</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">1.2</span>),</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Nice Spline Model,</span><span class="sc">\n</span><span class="st">Fit to Nonlinear Outcome"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span><span class="st">"y"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span> <span class="st">"x"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>t<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(t),<span class="at">to =</span> <span class="fu">max</span>(t), <span class="at">length.out =</span> <span class="fu">length</span>(y2))</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(t, <span class="fu">predict</span>( <span class="fu">lm</span> (y2 <span class="sc">~</span> <span class="fu">bs</span>(t, <span class="at">df =</span> <span class="dv">5</span>)),</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">data.frame</span>(<span class="at">t =</span> t), <span class="at">lwd =</span> <span class="fl">1.5</span>),</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">col=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I really think splines, and GAMs are an excellent addition to the modeling world and have started teaching them in my own methods courses. In the world of demography, especially, with age affecting everything, there is no need to constantly assume relationships are purely linear, and splines offer an excellent method to explore such relationships.</p>
</div>
<p>If these assumptions are violated, then several things can happen. At best, our interpretation of the model coefficients could be wrong, meaning that, as seen above, our model would suggest one relationship from the data, but in fact because the model was misspecified, the relationship we discover is incorrect. Our poor linear model would predict a decline in the outcome, while the outcome itself is perfectly stationary, as shown by the dashed line.</p>
<p>In a more social science sensibility, the interpretation of the beta coefficients for the effect of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> in this case will provide us a false conclusion of the relationship in the data. This is a really dangerous outcome for us in social science, because that’s why we’re doing statistics in the first place, to answer questions.</p>
<p>The normality assumption above primarily affect predictions from the model, which, since the normal distribution is bound on <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>, can easily lead to a prediction outside of the realm of possibility, say for a dichotomous outcome, or a count, neither of which can have predicted values beyond 0 and 1, or less than 0.</p>
</section>
<section id="generalized-least-squares" class="level3" data-number="5.7.2">
<h3 data-number="5.7.2" class="anchored" data-anchor-id="generalized-least-squares"><span class="header-section-number">5.7.2</span> Generalized Least Squares</h3>
<p>Once our data start to violate the assumptions of the linear model, the model becomes less and less useful. For instance, why make all of the strict assumptions about homoskedastic (I am contractually required by the statistics union to say this at least once) variances in the model residuals in order to use OLS, when you can use it’s friend and brother, <strong>Generalized Least Squares</strong> (GLS, of course), which allows you to make useful and pragmatic changes to the OLS model structure to accommodate all of the fun and annoying things about real data, but still use the normal distribution to model our outcomes[^macrodem-9].</p>
<p>Generalized Least Squares adds a lot more flexibility to modeling normally distributed outcomes, basically by allowing us to modify the fundamental equations above to accommodate unequal variances, or the use of covariates or stratification variables on variances. Another way to write the OLS model above would be:</p>
<p><span class="math inline">\(\epsilon_i \sim Normal(X'\beta, I\sigma_\epsilon)\)</span> Where <span class="math inline">\(I\)</span> is the <strong>identity matrix</strong>, which implies that for each observation, the variances in the residuals are all the same:</p>
<p><span class="math display">\[
\sigma_{\epsilon}  = I * \sigma_{\epsilon} = \begin{Bmatrix}
1&amp; 0&amp; 0 \\
0&amp; 1&amp; 0 \\
0&amp; 0&amp; 1\\
\end{Bmatrix} *\sigma_{\epsilon} = \begin{Bmatrix}
\sigma_{\epsilon}&amp; 0&amp; 0 \\
0&amp; \sigma_{\epsilon}&amp; 0 \\
0&amp; 0 &amp; \sigma_{\epsilon} \\
\end{Bmatrix}
\]</span></p>
<p>Which shows the common variance for the three residuals. GLS allows us to relax this constant variance assumption, by at the minimum allowing the variances to be a function of a weighting variable (which produces <strong>Weighted Least Squares</strong>), or some covariate. In the most basic presentation of this principle, this makes the residuals have some other, non-constant form of:</p>
<p><span class="math inline">\(\sigma_{\epsilon} = \Omega\)</span> which in turn modifies the estimation equation for the <span class="math inline">\(\beta\)</span>’s to:</p>
<p><span class="math inline">\(\beta_{k_{GLS}} = (X' \Omega^{-1} X)^{-1} X' \Omega^{-1} Y\)</span> Applications of such models are more commonly seen in time series modeling and longitudinal analysis, where the residuals of the model often have an autoregressive form to allow individuals to be correlated with themselves over time, but when talking about place-based demography, more modifications of the model have been derived that allow for addressing another key assumption of independence among observations and nonconstant variances. This in fact is the realm of an entire field of econometrics, often called <strong>spatial econometrics</strong> <span class="citation" data-cites="anselin_spatial_1988 chi_spatial_2020 elhorst_spatial_2014 lesage_introduction_2009">(<a href="#ref-anselin_spatial_1988" role="doc-biblioref">Anselin 1988</a>; <a href="#ref-chi_spatial_2020" role="doc-biblioref">Chi and Zhu 2020</a>; <a href="#ref-elhorst_spatial_2014" role="doc-biblioref">Elhorst 2014</a>; <a href="#ref-lesage_introduction_2009" role="doc-biblioref">LeSage and Pace 2009</a>)</span>.</p>
<p>The <code>gls()</code> function in the <code>nlme</code> library is very flexible at modeling heteroskedasticity using several types of variance functions. The general principle of the gls model in terms of modeling heteroskedasticity is that the OLS model residual variance <span class="math inline">\(\sigma_{\epsilon}\)</span> is now not a constant, but a function of covariates or different variances based on a stratification variable. This generates a model for the residual variances of the form:</p>
<p><span class="math display">\[Var(\epsilon_i |\beta) = \sigma^2 g\]</span></p>
<p>Where the <span class="math inline">\(g\)</span> function can be the effect of a covariate, which would allow the variance to increase or decrease as function of that variable, or a set of strata, where the variance can be different in two or more groups. Below, I first show the model above fit using <code>gls()</code> instead of <code>lm()</code>, then extend the model to include heteroskedasticity based on the population size of the county, and state-specific variance terms <span class="citation" data-cites="pinheiro_mixed-effects_2000">(<a href="#ref-pinheiro_mixed-effects_2000" role="doc-biblioref">Pinheiro and Bates 2000</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'nlme'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    collapse</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lm1g<span class="ot">&lt;-</span> <span class="fu">gls</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by REML
  Model: lbrate1618 ~ fampov14 + rucc + hpsa16 
  Data: ahrf_m 
       AIC      BIC    logLik
  19580.52 19655.22 -9777.261

Coefficients:
                                 Value Std.Error  t-value p-value
(Intercept)                   62.26920 1.1890098 52.37063  0.0000
fampov14                       2.25805 0.0684647 32.98129  0.0000
rucc02                        -1.91854 1.2008189 -1.59769  0.1102
rucc03                        -3.38658 1.2505531 -2.70806  0.0068
rucc04                        -6.65483 1.4063909 -4.73185  0.0000
rucc05                        -5.96283 1.9373921 -3.07776  0.0021
rucc06                        -3.94180 1.1431747 -3.44812  0.0006
rucc07                        -4.00730 1.2816639 -3.12664  0.0018
rucc08                         0.45112 2.1106217  0.21374  0.8308
rucc09                        -3.88365 2.2911822 -1.69504  0.0902
hpsa16partial county shortage -0.66219 1.0076706 -0.65715  0.5111
hpsa16whole county shortage    2.36214 1.2533476  1.88466  0.0596

 Correlation: 
                              (Intr) fmpv14 rucc02 rucc03 rucc04 rucc05 rucc06
fampov14                      -0.381                                          
rucc02                        -0.364 -0.121                                   
rucc03                        -0.342 -0.114  0.462                            
rucc04                        -0.298 -0.160  0.416  0.399                     
rucc05                        -0.207 -0.144  0.305  0.293  0.269              
rucc06                        -0.317 -0.245  0.521  0.501  0.453  0.336       
rucc07                        -0.281 -0.242  0.467  0.449  0.410  0.304  0.525
rucc08                        -0.140 -0.163  0.288  0.278  0.248  0.186  0.344
rucc09                        -0.101 -0.226  0.274  0.265  0.241  0.182  0.334
hpsa16partial county shortage -0.560 -0.131 -0.068 -0.078 -0.043 -0.024 -0.070
hpsa16whole county shortage   -0.390 -0.235 -0.035 -0.045  0.017  0.015 -0.105
                              rucc07 rucc08 rucc09 hps16pcs
fampov14                                                   
rucc02                                                     
rucc03                                                     
rucc04                                                     
rucc05                                                     
rucc06                                                     
rucc07                                                     
rucc08                         0.298                       
rucc09                         0.292  0.204                
hpsa16partial county shortage -0.058 -0.051 -0.037         
hpsa16whole county shortage   -0.035 -0.132 -0.097  0.693  

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-5.50851038 -0.63237431 -0.07515361  0.56768444  4.75446234 

Residual standard error: 16.35905 
Degrees of freedom: 2324 total; 2312 residual</code></pre>
</div>
</div>
<p>These are the same results, in terms of the regression coefficients as returned by <code>lm()</code>. If we include a <code>varFixed()</code> term, we can regress the residual variance term on a covariate, in this case I select the population size.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>lm2g<span class="ot">&lt;-</span> <span class="fu">gls</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">varFixed</span>(<span class="sc">~</span>popn) )</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm2g)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by REML
  Model: lbrate1618 ~ fampov14 + rucc + hpsa16 
  Data: ahrf_m 
       AIC      BIC    logLik
  21560.43 21635.12 -10767.21

Variance function:
 Structure: fixed weights
 Formula: ~popn 

Coefficients:
                                 Value Std.Error  t-value p-value
(Intercept)                   64.51684 1.7992819 35.85700  0.0000
fampov14                       2.02451 0.0672245 30.11574  0.0000
rucc02                        -3.65253 2.0140861 -1.81349  0.0699
rucc03                        -3.74951 1.9836516 -1.89021  0.0589
rucc04                        -6.48571 2.3336913 -2.77916  0.0055
rucc05                        -6.03115 2.9497652 -2.04462  0.0410
rucc06                        -2.53166 1.6616043 -1.52362  0.1277
rucc07                        -2.30731 1.7300102 -1.33369  0.1824
rucc08                         0.54783 2.1293518  0.25727  0.7970
rucc09                        -2.85405 2.1820264 -1.30798  0.1910
hpsa16partial county shortage  0.18574 1.3009964  0.14277  0.8865
hpsa16whole county shortage    5.22180 1.4198726  3.67766  0.0002

 Correlation: 
                              (Intr) fmpv14 rucc02 rucc03 rucc04 rucc05 rucc06
fampov14                      -0.269                                          
rucc02                        -0.537 -0.065                                   
rucc03                        -0.550 -0.045  0.536                            
rucc04                        -0.466 -0.088  0.463  0.466                     
rucc05                        -0.363 -0.085  0.367  0.370  0.328              
rucc06                        -0.603 -0.163  0.649  0.655  0.568  0.452       
rucc07                        -0.591 -0.169  0.627  0.631  0.555  0.441  0.776
rucc08                        -0.431 -0.174  0.508  0.513  0.439  0.350  0.637
rucc09                        -0.409 -0.234  0.500  0.503  0.435  0.348  0.632
hpsa16partial county shortage -0.464 -0.092 -0.062 -0.062 -0.063 -0.048 -0.109
hpsa16whole county shortage   -0.429 -0.215 -0.016 -0.027  0.038  0.031 -0.050
                              rucc07 rucc08 rucc09 hps16pcs
fampov14                                                   
rucc02                                                     
rucc03                                                     
rucc04                                                     
rucc05                                                     
rucc06                                                     
rucc07                                                     
rucc08                         0.609                       
rucc09                         0.605  0.512                
hpsa16partial county shortage -0.100 -0.101 -0.087         
hpsa16whole county shortage    0.001 -0.099 -0.070  0.767  

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-7.55351050 -0.48060084 -0.06047952  0.31143188  8.68535299 

Residual standard error: 0.1103656 
Degrees of freedom: 2324 total; 2312 residual</code></pre>
</div>
</div>
<p>This model shows some very different effects after controlling for non-constant variance. For instance, the <code>whole county shortage</code> effect is now much more significant in the model, compared to the <code>lm1</code> model.</p>
<p>The final model includes a separate variance for each state using the <code>varIdent()</code> term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>lm3<span class="ot">&lt;-</span> <span class="fu">gls</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span><span class="sc">|</span><span class="fu">factor</span>(state) ) )</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by REML
  Model: lbrate1618 ~ fampov14 + rucc + hpsa16 
  Data: ahrf_m 
       AIC      BIC    logLik
  19232.57 19583.07 -9555.287

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | factor(state) 
 Parameter estimates:
       21        01        04        05        06        08        09        11 
1.0000000 1.6653572 1.4666877 1.3444082 1.4169906 2.3439093 0.4153761 0.9349384 
       12        13        16        17        18        48        49        50 
0.8691605 1.4618211 1.2492319 0.8531463 0.7272325 1.0046612 0.9955712 0.6782617 
       22        23        24        25        26        27        28        29 
1.5206083 0.5562842 1.0764207 0.3632039 0.8797361 0.8694446 2.1388815 1.0671070 
       30        33        34        35        36        37        38        39 
0.8593438 0.3518410 0.5857512 1.6675040 0.8834383 1.2756652 1.3451314 0.7590721 
       40        41        42        44        45        46        47        51 
0.9096844 0.9789355 0.7160118 0.7725377 1.4955639 2.2706999 0.9232718 1.4150226 
       53        54        55        10        32        19        20        56 
1.1651279 1.4044153 0.8102840 0.8493449 1.3739156 0.8028595 0.9380637 1.5713111 
       31 
1.1601422 

Coefficients:
                                 Value Std.Error  t-value p-value
(Intercept)                   61.00371 0.9636746 63.30323  0.0000
fampov14                       2.20339 0.0626079 35.19354  0.0000
rucc02                        -1.55250 0.9300585 -1.66925  0.0952
rucc03                        -2.67599 0.9989933 -2.67869  0.0074
rucc04                        -6.75071 1.0541928 -6.40368  0.0000
rucc05                        -7.07431 1.6290634 -4.34256  0.0000
rucc06                        -5.33031 0.8964666 -5.94591  0.0000
rucc07                        -6.20026 1.0294913 -6.02264  0.0000
rucc08                        -0.38337 1.8548174 -0.20669  0.8363
rucc09                        -3.80880 2.0564547 -1.85212  0.0641
hpsa16partial county shortage -0.40513 0.8049182 -0.50332  0.6148
hpsa16whole county shortage    0.69954 1.0571871  0.66170  0.5082

 Correlation: 
                              (Intr) fmpv14 rucc02 rucc03 rucc04 rucc05 rucc06
fampov14                      -0.425                                          
rucc02                        -0.330 -0.118                                   
rucc03                        -0.300 -0.112  0.415                            
rucc04                        -0.281 -0.137  0.396  0.369                     
rucc05                        -0.155 -0.132  0.262  0.244  0.236              
rucc06                        -0.275 -0.238  0.476  0.446  0.423  0.284       
rucc07                        -0.232 -0.230  0.417  0.390  0.374  0.253  0.467
rucc08                        -0.105 -0.142  0.235  0.221  0.207  0.140  0.280
rucc09                        -0.058 -0.215  0.222  0.209  0.199  0.138  0.272
hpsa16partial county shortage -0.592 -0.112 -0.037 -0.042 -0.028 -0.026 -0.037
hpsa16whole county shortage   -0.390 -0.189 -0.015 -0.026  0.019  0.016 -0.106
                              rucc07 rucc08 rucc09 hps16pcs
fampov14                                                   
rucc02                                                     
rucc03                                                     
rucc04                                                     
rucc05                                                     
rucc06                                                     
rucc07                                                     
rucc08                         0.236                       
rucc09                         0.233  0.147                
hpsa16partial county shortage -0.036 -0.032 -0.019         
hpsa16whole county shortage   -0.031 -0.110 -0.076  0.654  

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-3.71110304 -0.57404142  0.07995833  0.73280651  3.80484317 

Residual standard error: 13.75474 
Degrees of freedom: 2324 total; 2312 residual</code></pre>
</div>
</div>
<p>Which also provides similar results to <code>lm1</code>. So, which model is better for this particular outcome? One way to examine relative model fit is to compare the Akaike Information Criteria (AIC) for the three models. The AIC consists of two components, one showing overall model deviance, or residual variance and a penalty term for the number of parameters in a model. A general form of it is:</p>
<p><span class="math display">\[
AIC = -2LL(\theta) + 2k
\]</span> Where the term <span class="math inline">\(-2LL(\theta)\)</span> is the model -2 Log likelihood, or <em>deviance</em>, and <span class="math inline">\(2k\)</span> is a penalty term with <span class="math inline">\(k\)</span> being the number of parameters.</p>
<p>Since the three models <code>lm1g</code>, <code>lm2</code> and <code>lm3</code> are all fit by <code>gls()</code>, and fit to the same dataset, we can compare them. We can even add another model with a smooth spline effect of poverty:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>lm3s<span class="ot">&lt;-</span> <span class="fu">gls</span>(lbrate1618 <span class="sc">~</span>  <span class="fu">bs</span>(fampov14, <span class="at">df=</span><span class="dv">4</span>) <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span><span class="sc">|</span><span class="fu">factor</span>(state) ) )</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm3s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Generalized least squares fit by REML
  Model: lbrate1618 ~ bs(fampov14, df = 4) + rucc + hpsa16 
  Data: ahrf_m 
       AIC      BIC    logLik
  19166.97 19534.62 -9519.486

Variance function:
 Structure: Different standard deviations per stratum
 Formula: ~1 | factor(state) 
 Parameter estimates:
       21        01        04        05        06        08        09        11 
1.0000000 1.8015440 1.5283795 1.4399605 1.5393732 2.5102463 0.4584789 0.8961499 
       12        13        16        17        18        48        49        50 
0.9169369 1.5786894 1.2845194 0.9010857 0.7815679 1.0169676 1.0666628 0.7347100 
       22        23        24        25        26        27        28        29 
1.7020601 0.6180479 1.1587213 0.4065278 0.9556412 0.9113779 2.4411415 1.1501547 
       30        33        34        35        36        37        38        39 
0.9098260 0.3629158 0.6330773 1.6758907 0.9583268 1.3320870 1.3647418 0.8178477 
       40        41        42        44        45        46        47        51 
0.9867867 1.0609522 0.7586694 0.8150356 1.5564278 1.0001279 0.9815430 1.5006645 
       53        54        55        10        32        19        20        56 
1.2497825 1.4843275 0.8554764 0.9154187 1.4561259 0.8426759 1.0163896 1.7112344 
       31 
1.2457365 

Coefficients:
                                 Value Std.Error   t-value p-value
(Intercept)                   65.28605  2.227553 29.308421  0.0000
bs(fampov14, df = 4)1          4.58369  3.031480  1.512031  0.1307
bs(fampov14, df = 4)2         50.98375  3.137696 16.248784  0.0000
bs(fampov14, df = 4)3         72.74204  8.455071  8.603362  0.0000
bs(fampov14, df = 4)4         15.96517 11.310702  1.411510  0.1582
rucc02                        -1.78937  0.947673 -1.888176  0.0591
rucc03                        -2.99112  1.007407 -2.969130  0.0030
rucc04                        -6.96833  1.065192 -6.541851  0.0000
rucc05                        -7.95180  1.605224 -4.953700  0.0000
rucc06                        -5.72170  0.906461 -6.312131  0.0000
rucc07                        -6.38566  1.028234 -6.210321  0.0000
rucc08                        -0.84020  1.849541 -0.454273  0.6497
rucc09                        -3.84206  2.006058 -1.915231  0.0556
hpsa16partial county shortage -0.54729  0.798950 -0.685016  0.4934
hpsa16whole county shortage    0.60030  1.043145  0.575469  0.5650

 Correlation: 
                              (Intr) b(14,d=4)1 b(14,d=4)2 b(14,d=4)3
bs(fampov14, df = 4)1         -0.907                                 
bs(fampov14, df = 4)2         -0.157 -0.005                          
bs(fampov14, df = 4)3         -0.527  0.664     -0.533               
bs(fampov14, df = 4)4         -0.089  0.053      0.318     -0.304    
rucc02                         0.011 -0.166     -0.133     -0.073    
rucc03                        -0.008 -0.129     -0.146     -0.034    
rucc04                        -0.002 -0.132     -0.134     -0.060    
rucc05                         0.006 -0.088     -0.128     -0.034    
rucc06                         0.001 -0.142     -0.190     -0.081    
rucc07                        -0.011 -0.120     -0.139     -0.100    
rucc08                        -0.015 -0.040     -0.115     -0.019    
rucc09                         0.006 -0.063     -0.076     -0.095    
hpsa16partial county shortage -0.166 -0.091     -0.123     -0.029    
hpsa16whole county shortage   -0.143 -0.042     -0.096     -0.055    
                              b(14,d=4)4 rucc02 rucc03 rucc04 rucc05 rucc06
bs(fampov14, df = 4)1                                                      
bs(fampov14, df = 4)2                                                      
bs(fampov14, df = 4)3                                                      
bs(fampov14, df = 4)4                                                      
rucc02                        -0.036                                       
rucc03                        -0.038      0.435                            
rucc04                        -0.035      0.414  0.388                     
rucc05                        -0.032      0.282  0.265  0.255              
rucc06                        -0.043      0.495  0.466  0.441  0.304       
rucc07                        -0.035      0.433  0.406  0.390  0.269  0.482
rucc08                        -0.019      0.243  0.231  0.216  0.150  0.290
rucc09                        -0.114      0.231  0.216  0.207  0.146  0.283
hpsa16partial county shortage -0.031     -0.012 -0.023 -0.009 -0.003 -0.013
hpsa16whole county shortage   -0.054     -0.006 -0.019  0.026  0.027 -0.096
                              rucc07 rucc08 rucc09 hps16pcs
bs(fampov14, df = 4)1                                      
bs(fampov14, df = 4)2                                      
bs(fampov14, df = 4)3                                      
bs(fampov14, df = 4)4                                      
rucc02                                                     
rucc03                                                     
rucc04                                                     
rucc05                                                     
rucc06                                                     
rucc07                                                     
rucc08                         0.243                       
rucc09                         0.245  0.152                
hpsa16partial county shortage -0.015 -0.022 -0.015         
hpsa16whole county shortage   -0.018 -0.107 -0.073  0.650  

Standardized residuals:
        Min          Q1         Med          Q3         Max 
-3.66477973 -0.58141552  0.08014607  0.72668723  3.87024262 

Residual standard error: 12.88614 
Degrees of freedom: 2324 total; 2309 residual</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>( lm1g,  lm2g, lm3, lm3s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in AIC.default(lm1g, lm2g, lm3, lm3s): models are not all fitted to the
same number of observations</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     df      AIC
lm1g 13 19580.52
lm2g 13 21560.43
lm3  61 19232.57
lm3s 64 19166.97</code></pre>
</div>
</div>
<p>The <code>AIC()</code> function calculates AIC for each model, and we see that <code>lm3s</code> has the lowest of the three, suggesting that the non-constant variance across states is a better representation than the effects of population size on the residual variance, and that the nonlinear effect of poverty is also present in this case.</p>
<section id="further-model-comparisons" class="level4" data-number="5.7.2.1">
<h4 data-number="5.7.2.1" class="anchored" data-anchor-id="further-model-comparisons"><span class="header-section-number">5.7.2.1</span> Further model comparisons</h4>
<p>R has a general method of comparing models using <span class="math inline">\(F\)</span> tests or Likelihood Ratio Tests. These are often used when comparing nested models, where one model is a simplified version of another. We have such models above in our <code>gls()</code> models. The <code>lm1g</code> model is a simplified version of the <code>lm3</code> model because it doesn’t contain the extra parameters modeling the unequal variances. The <code>anova()</code> method can compare the models to see if the extra parameters are explaining the model deviance (or variation) better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lm1g, lm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Model df      AIC      BIC    logLik   Test  L.Ratio p-value
lm1g     1 13 19580.52 19655.22 -9777.261                        
lm3      2 61 19232.57 19583.07 -9555.287 1 vs 2 443.9476  &lt;.0001</code></pre>
</div>
</div>
<p>Here the likelihood ratio test <code>L.Ratio</code> shows a significant decrease in the <code>logLik</code> in model <code>lm3</code>, suggesting that it better explains the data than <code>lm1g</code> does. The likelihood ratio is calculated as <span class="math inline">\(2*LL_2 - LL_1\)</span>, or in the case above <code>2*(-9555.287--9777.261)</code>. The <code>anova</code> method is very useful for comparing alternative models and can be used on most of the models shown in this book.</p>
</section>
</section>
<section id="predictions-and-marginal-means" class="level3" data-number="5.7.3">
<h3 data-number="5.7.3" class="anchored" data-anchor-id="predictions-and-marginal-means"><span class="header-section-number">5.7.3</span> Predictions and marginal means</h3>
<p>Working with fitted values from a regression is one of the least taught aspects of modeling. Since the models are fundamentally doing very fancy averaging, the estimated, or fitted values from the model can often be very useful to us as we try to explain the results of our models. Remember, the fitted values of the model are just:</p>
<p><span class="math display">\[
\hat{y}_i = \sum \hat{\beta_k} x_{ki}
\]</span></p>
<p>or the linear combination of the estimated model parameters and the <span class="math inline">\(k\)</span> observed predictors, <span class="math inline">\(x_{ki}\)</span>. Most models in R have a <code>fitted()</code> method to extract the fitted values of the outcome variable for each observation.</p>
<p>For example, here are the first six fitted values from the original <code>lm1</code> OLS model, the <code>gls()</code> heteroskedastic model <code>lm3</code> model, and the first six values of the outcome:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>fits<span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">head</span>( ahrf_m<span class="sc">$</span>NAME ),</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lm1 =</span> <span class="fu">head</span>( <span class="fu">fitted</span> ( lm1 )),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">lm3 =</span> <span class="fu">head</span>( <span class="fu">fitted</span>( lm3 )), </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed =</span> <span class="fu">head</span>( ahrf_m<span class="sc">$</span>lbrate1618 )</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>fits<span class="sc">%&gt;%</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="ydgabwknrs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ydgabwknrs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ydgabwknrs thead, #ydgabwknrs tbody, #ydgabwknrs tfoot, #ydgabwknrs tr, #ydgabwknrs td, #ydgabwknrs th {
  border-style: none;
}

#ydgabwknrs p {
  margin: 0;
  padding: 0;
}

#ydgabwknrs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ydgabwknrs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ydgabwknrs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ydgabwknrs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ydgabwknrs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ydgabwknrs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ydgabwknrs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ydgabwknrs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ydgabwknrs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ydgabwknrs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ydgabwknrs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ydgabwknrs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ydgabwknrs .gt_spanner_row {
  border-bottom-style: hidden;
}

#ydgabwknrs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ydgabwknrs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ydgabwknrs .gt_from_md > :first-child {
  margin-top: 0;
}

#ydgabwknrs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ydgabwknrs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ydgabwknrs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ydgabwknrs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ydgabwknrs .gt_row_group_first td {
  border-top-width: 2px;
}

#ydgabwknrs .gt_row_group_first th {
  border-top-width: 2px;
}

#ydgabwknrs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ydgabwknrs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ydgabwknrs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ydgabwknrs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ydgabwknrs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ydgabwknrs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ydgabwknrs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ydgabwknrs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ydgabwknrs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ydgabwknrs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ydgabwknrs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ydgabwknrs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ydgabwknrs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ydgabwknrs .gt_left {
  text-align: left;
}

#ydgabwknrs .gt_center {
  text-align: center;
}

#ydgabwknrs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ydgabwknrs .gt_font_normal {
  font-weight: normal;
}

#ydgabwknrs .gt_font_bold {
  font-weight: bold;
}

#ydgabwknrs .gt_font_italic {
  font-style: italic;
}

#ydgabwknrs .gt_super {
  font-size: 65%;
}

#ydgabwknrs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ydgabwknrs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ydgabwknrs .gt_indent_1 {
  text-indent: 5px;
}

#ydgabwknrs .gt_indent_2 {
  text-indent: 10px;
}

#ydgabwknrs .gt_indent_3 {
  text-indent: 15px;
}

#ydgabwknrs .gt_indent_4 {
  text-indent: 20px;
}

#ydgabwknrs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="name">name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="lm1">lm1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="lm3">lm3</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="observed">observed</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="name" class="gt_row gt_left">Anderson</td>
<td headers="lm1" class="gt_row gt_right">83.16599</td>
<td headers="lm3" class="gt_row gt_right">79.91074</td>
<td headers="observed" class="gt_row gt_right">87.78626</td></tr>
    <tr><td headers="name" class="gt_row gt_left">Bullitt</td>
<td headers="lm1" class="gt_row gt_right">79.44563</td>
<td headers="lm3" class="gt_row gt_right">78.00540</td>
<td headers="observed" class="gt_row gt_right">84.47205</td></tr>
    <tr><td headers="name" class="gt_row gt_left">Clark</td>
<td headers="lm1" class="gt_row gt_right">85.43028</td>
<td headers="lm3" class="gt_row gt_right">84.16478</td>
<td headers="observed" class="gt_row gt_right">89.20188</td></tr>
    <tr><td headers="name" class="gt_row gt_left">Daviess</td>
<td headers="lm1" class="gt_row gt_right">86.20507</td>
<td headers="lm3" class="gt_row gt_right">84.98880</td>
<td headers="observed" class="gt_row gt_right">81.26411</td></tr>
    <tr><td headers="name" class="gt_row gt_left">Hardin</td>
<td headers="lm1" class="gt_row gt_right">82.15580</td>
<td headers="lm3" class="gt_row gt_right">81.27857</td>
<td headers="observed" class="gt_row gt_right">78.47222</td></tr>
    <tr><td headers="name" class="gt_row gt_left">Harrison</td>
<td headers="lm1" class="gt_row gt_right">83.16599</td>
<td headers="lm3" class="gt_row gt_right">79.91074</td>
<td headers="observed" class="gt_row gt_right">81.89655</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>We can also easily construct the map of the observed, fitted values and residuals from the model using <code>tmap</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>ahrf_m<span class="sc">$</span>fitted_lm3 <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm3)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>ahrf_m<span class="sc">$</span>resid <span class="ot">&lt;-</span> <span class="fu">resid</span>(lm3)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>actual <span class="ot">&lt;-</span><span class="fu">tm_shape</span>(ahrf_m)<span class="sc">+</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"lbrate1618"</span>,</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">n=</span><span class="dv">6</span>,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">"fisher"</span>,</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">border.col =</span> <span class="cn">NULL</span>,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey50"</span>)<span class="sc">+</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(sts)<span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>( <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">tm_shape</span>(ahrf_m)<span class="sc">+</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"fitted_lm3"</span>,</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"Blues"</span>,</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">n=</span><span class="dv">6</span>,</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">"fisher"</span>, </span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">border.col =</span> <span class="cn">NULL</span>,</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey50"</span>)<span class="sc">+</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(sts)<span class="sc">+</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>( <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>resids<span class="ot">&lt;-</span><span class="fu">tm_shape</span>(ahrf_m)<span class="sc">+</span></span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>(<span class="st">"resid"</span>,</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">palette =</span> <span class="st">"RdBu"</span>,</span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">n=</span><span class="dv">6</span>,</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">style=</span><span class="st">"fisher"</span>,</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">midpoint =</span> <span class="cn">NA</span>,</span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">border.col =</span> <span class="cn">NULL</span>,</span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">colorNA =</span> <span class="st">"grey50"</span>)<span class="sc">+</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_shape</span>(sts)<span class="sc">+</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_lines</span>( <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(actual, fit, resids, <span class="at">nrow=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>This map layout shows the observed rates, the fitted rates from the <code>lm3</code> model and the residuals from the model. Mapping residuals from models run on place-based data can show areas within the data where the model is consistently under or over-estimating the outcome. For instance in the example above, we see consistently high residuals in several of the south eastern states, and the mountain west, and several areas where the residuals are consistently negative, meaning we are over-estimating the rate. This can be instructive as to other variables we may be leaving out of the model that follow similar spatial distributions of the residuals. If such spatially patterned residuals are observed, it is generally a good idea to consider a statistical model that incorporates some kind of spatially explicit model specification.</p>
<section id="more-on-predicted-values" class="level4" data-number="5.7.3.1">
<h4 data-number="5.7.3.1" class="anchored" data-anchor-id="more-on-predicted-values"><span class="header-section-number">5.7.3.1</span> More on predicted values</h4>
<p>There are more systematic methods for generating predictions from a model that allow us to marginalize the estimates across other variables and to generate counter factual or hypothetical rates using combinations of <span class="math inline">\(x\)</span> values that may not be observed in the data. The <code>emmeans</code> package is very good at this and also accommodates many types of models. For instance if we would like the marginal means for counties by their healthcare shortage area type, after controlling for the other variables in our model, we can request that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>rg<span class="ot">&lt;-</span> <span class="fu">ref_grid</span>(lm3s)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>mu1 <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rg, <span class="at">specs =</span><span class="st">"hpsa16"</span> )</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>mu1<span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="auujvnjgio" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#auujvnjgio table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#auujvnjgio thead, #auujvnjgio tbody, #auujvnjgio tfoot, #auujvnjgio tr, #auujvnjgio td, #auujvnjgio th {
  border-style: none;
}

#auujvnjgio p {
  margin: 0;
  padding: 0;
}

#auujvnjgio .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#auujvnjgio .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#auujvnjgio .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#auujvnjgio .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#auujvnjgio .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#auujvnjgio .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#auujvnjgio .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#auujvnjgio .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#auujvnjgio .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#auujvnjgio .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#auujvnjgio .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#auujvnjgio .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#auujvnjgio .gt_spanner_row {
  border-bottom-style: hidden;
}

#auujvnjgio .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#auujvnjgio .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#auujvnjgio .gt_from_md > :first-child {
  margin-top: 0;
}

#auujvnjgio .gt_from_md > :last-child {
  margin-bottom: 0;
}

#auujvnjgio .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#auujvnjgio .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#auujvnjgio .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#auujvnjgio .gt_row_group_first td {
  border-top-width: 2px;
}

#auujvnjgio .gt_row_group_first th {
  border-top-width: 2px;
}

#auujvnjgio .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#auujvnjgio .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#auujvnjgio .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#auujvnjgio .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#auujvnjgio .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#auujvnjgio .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#auujvnjgio .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#auujvnjgio .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#auujvnjgio .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#auujvnjgio .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#auujvnjgio .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#auujvnjgio .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#auujvnjgio .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#auujvnjgio .gt_left {
  text-align: left;
}

#auujvnjgio .gt_center {
  text-align: center;
}

#auujvnjgio .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#auujvnjgio .gt_font_normal {
  font-weight: normal;
}

#auujvnjgio .gt_font_bold {
  font-weight: bold;
}

#auujvnjgio .gt_font_italic {
  font-style: italic;
}

#auujvnjgio .gt_super {
  font-size: 65%;
}

#auujvnjgio .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#auujvnjgio .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#auujvnjgio .gt_indent_1 {
  text-indent: 5px;
}

#auujvnjgio .gt_indent_2 {
  text-indent: 10px;
}

#auujvnjgio .gt_indent_3 {
  text-indent: 15px;
}

#auujvnjgio .gt_indent_4 {
  text-indent: 20px;
}

#auujvnjgio .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="hpsa16">hpsa16</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="emmean">emmean</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="SE">SE</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="df">df</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="lower.CL">lower.CL</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="upper.CL">upper.CL</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="hpsa16" class="gt_row gt_center">no shortage</td>
<td headers="emmean" class="gt_row gt_right">83.82779</td>
<td headers="SE" class="gt_row gt_right">0.8441041</td>
<td headers="df" class="gt_row gt_right">2261</td>
<td headers="lower.CL" class="gt_row gt_right">82.17249</td>
<td headers="upper.CL" class="gt_row gt_right">85.48309</td></tr>
    <tr><td headers="hpsa16" class="gt_row gt_center">partial county shortage</td>
<td headers="emmean" class="gt_row gt_right">83.28049</td>
<td headers="SE" class="gt_row gt_right">0.4890943</td>
<td headers="df" class="gt_row gt_right">2261</td>
<td headers="lower.CL" class="gt_row gt_right">82.32137</td>
<td headers="upper.CL" class="gt_row gt_right">84.23962</td></tr>
    <tr><td headers="hpsa16" class="gt_row gt_center">whole county shortage</td>
<td headers="emmean" class="gt_row gt_right">84.42809</td>
<td headers="SE" class="gt_row gt_right">0.7923959</td>
<td headers="df" class="gt_row gt_right">2261</td>
<td headers="lower.CL" class="gt_row gt_right">82.87419</td>
<td headers="upper.CL" class="gt_row gt_right">85.98198</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>Which unsurprisingly does not tell us much, because the health care shortage area variable in <code>lm3</code> was not a significant predictor of the low birth weight rate. We can include more than one margin in the function, and include specific values we wish to highlight. For instance, let’s compare three hypothetical counties with three different poverty rates, we can use the <code>summary(ahrf_m$fampov14)</code> to see the first and third quartiles of the distribution and the mean, we will use these as our theoretical values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>rg<span class="ot">&lt;-</span><span class="fu">ref_grid</span>(lm3,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">at=</span><span class="fu">list</span>( <span class="at">fampov14 =</span> <span class="fu">c</span>(<span class="fl">1.8</span>,<span class="fl">7.8</span>, <span class="fl">11.6</span>, <span class="fl">14.3</span>, <span class="fl">52.1</span>) ) )</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rg, <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"fampov14"</span>, <span class="st">"rucc"</span>))</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>means<span class="sc">%&gt;%</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>rucc, <span class="at">y=</span>emmean))<span class="sc">+</span></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="fu">factor</span>(fampov14), <span class="at">color=</span><span class="fu">factor</span>(fampov14)))<span class="sc">+</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which illustrates the differences in the poverty rates on the low birth weight rate across the rural-urban continuum. The use of these marginal means is very useful when illustrating the effects of covariates in regression models, and to effectively illustrate interactions in such models. For instance, if we estimate the model below, which interacts the poverty rate with the rural-urban continuum code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>lm3i<span class="ot">&lt;-</span> <span class="fu">gls</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">*</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span><span class="sc">|</span><span class="fu">factor</span>(state) ) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>rg<span class="ot">&lt;-</span><span class="fu">ref_grid</span>(lm3i,</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">at=</span><span class="fu">list</span>( <span class="at">fampov14 =</span> <span class="fu">c</span>(<span class="fl">7.8</span>, <span class="fl">11.6</span>, <span class="fl">14.3</span>) ) )</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>means <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(rg, <span class="at">specs =</span> <span class="fu">c</span>(<span class="st">"fampov14"</span>, <span class="st">"rucc"</span>))</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>means<span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>rucc, <span class="at">y=</span>emmean))<span class="sc">+</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="fu">factor</span>(fampov14), <span class="at">color=</span><span class="fu">factor</span>(fampov14)))<span class="sc">+</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see that in the most rural areas, (the <code>09</code> level of <code>rucc</code>), the differences by poverty rate are less than in more metropolitan areas, such as the <code>02</code> or <code>03</code> levels.</p>
</section>
<section id="use-of-ols-for-place-based-models" class="level4" data-number="5.7.3.2">
<h4 data-number="5.7.3.2" class="anchored" data-anchor-id="use-of-ols-for-place-based-models"><span class="header-section-number">5.7.3.2</span> Use of OLS for place-based models</h4>
<p>The OLS model and its extensions are a very useful staring place when analyzing data on places. For nothing more than the interpretive ease of the models estimates, it presents a very attractive choice for ecological modeling. The extension of the model through weighted and generalized least square allows for more flexible modeling to accommodate non-constant variance that often arises. Further extensions of the model by techniques of spatial econometrics further allow for direct incorporation of spatially correlated and lagged effects of covariates and model error terms to better deal with the idiosyncrasies of place-based data <span class="citation" data-cites="chi_spatial_2020 elhorst_spatial_2014 lesage_introduction_2009">(<a href="#ref-chi_spatial_2020" role="doc-biblioref">Chi and Zhu 2020</a>; <a href="#ref-elhorst_spatial_2014" role="doc-biblioref">Elhorst 2014</a>; <a href="#ref-lesage_introduction_2009" role="doc-biblioref">LeSage and Pace 2009</a>)</span>. These methods have seen wide use in demographic research over the past twenty years. Despite the fundamental flexibility of the OLS model, it may still not present the best solution when modeling demographic rates. One glaring reason is that if our outcomes are measured as rates, which are effectively probabilities, then the model can easily lead to estimates of predicted values that are either negative or greater than one, either of which presenting an issue for limited outcomes. In fact, this is why I am a strong proponent of not using the linear model for estimating probabilities. The next section of the book turns to the use of the <em>Generalized Linear Model</em> <span class="citation" data-cites="nelder_generalized_1972 mccullagh_generalized_1998">(<a href="#ref-nelder_generalized_1972" role="doc-biblioref">Nelder and Wedderburn 1972</a>; <a href="#ref-mccullagh_generalized_1998" role="doc-biblioref">McCullagh and Nelder 1998</a>)</span> as an alternative modeling strategy, especially when considering place-based data, when data are measured either as rates or as relative risks.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
<section id="basics-of-generalized-linear-models" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="basics-of-generalized-linear-models"><span class="header-section-number">5.8</span> Basics of Generalized Linear Models</h2>
<p>Up until now, we have been relying on linear statistical models which assumed the Normal distribution for our outcomes. A broader class of regression models, are <strong><em>Generalized Linear Models</em></strong> <span class="citation" data-cites="nelder_generalized_1972 mccullagh_generalized_1998">(<a href="#ref-nelder_generalized_1972" role="doc-biblioref">Nelder and Wedderburn 1972</a>; <a href="#ref-mccullagh_generalized_1998" role="doc-biblioref">McCullagh and Nelder 1998</a>)</span>, or <strong>GLM</strong>s, which allow for the estimation of a linear regression specification for outcomes that are not assumed to come from a Normal distribution. GLMs are a class of statistical models with three underlying components: A probability density appropriate to the outcome, a link function and a linear predictor. The <strong><em>link function</em></strong> is some mathematical function that links the mean of the specified probability distribution to the linear predictor of regression parameters and covariates. For example, the Normal distribution used by the OLS model has the mean, <span class="math inline">\(\mu\)</span>, which is typically estimated using the <strong><em>linear mean function</em></strong> : <span class="math inline">\(\mu = \beta_0 + \beta_1 x_1\)</span> Which describes the line that estimates the mean of the outcome variable as a linear function of <span class="math inline">\(\beta\)</span> parameters and the predictor variable <span class="math inline">\(x_1\)</span>. The OLS, or <em>Gaussian</em> GLM model uses an <strong><em>identity link</em></strong> meaning there is no transformation of the linear mean function as it is connected to the mean of the outcome. This can be written as:</p>
<p><span class="math display">\[g(u) = g(E(Y)) = \beta_0 + \beta_1 x_1\]</span></p>
<p>Where <span class="math inline">\(g()\)</span> is the link function, linking the mean of the Normal distribution to the linear mean function of the model. The equivalent GLM model to the <code>lm1</code> model from the previous section is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>glm1<span class="ot">&lt;-</span> <span class="fu">glm</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span>gaussian)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(texreg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Version:  1.38.6
Date:     2022-04-06
Author:   Philip Leifeld (University of Essex)

Consider submitting praise using the praise or praise_interactive functions.
Please cite the JSS article in your publications -- see citation("texreg").</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'texreg'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:tidyr':

    extract</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">texreg</span>(<span class="fu">list</span>(glm1, lm1), <span class="at">file =</span> <span class="st">"4_1.tex"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>The table was written to the file '4_1.tex'.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>lm1_t<span class="ot">&lt;-</span>lm1<span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>()</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>glm1_t<span class="ot">&lt;-</span>glm1<span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>()</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>t_m <span class="ot">&lt;-</span> <span class="fu">tbl_merge</span>(</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">tbls =</span> <span class="fu">list</span>(lm1_t, glm1_t),</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">tab_spanner =</span> <span class="fu">c</span>(<span class="st">"**OLS**"</span>, <span class="st">"**GLM**"</span>)</span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>t_m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="ueiyneebjy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ueiyneebjy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ueiyneebjy thead, #ueiyneebjy tbody, #ueiyneebjy tfoot, #ueiyneebjy tr, #ueiyneebjy td, #ueiyneebjy th {
  border-style: none;
}

#ueiyneebjy p {
  margin: 0;
  padding: 0;
}

#ueiyneebjy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ueiyneebjy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ueiyneebjy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ueiyneebjy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ueiyneebjy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ueiyneebjy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ueiyneebjy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ueiyneebjy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ueiyneebjy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ueiyneebjy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ueiyneebjy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ueiyneebjy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ueiyneebjy .gt_spanner_row {
  border-bottom-style: hidden;
}

#ueiyneebjy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ueiyneebjy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ueiyneebjy .gt_from_md > :first-child {
  margin-top: 0;
}

#ueiyneebjy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ueiyneebjy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ueiyneebjy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ueiyneebjy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ueiyneebjy .gt_row_group_first td {
  border-top-width: 2px;
}

#ueiyneebjy .gt_row_group_first th {
  border-top-width: 2px;
}

#ueiyneebjy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ueiyneebjy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ueiyneebjy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ueiyneebjy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ueiyneebjy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ueiyneebjy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ueiyneebjy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ueiyneebjy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ueiyneebjy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ueiyneebjy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ueiyneebjy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ueiyneebjy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ueiyneebjy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ueiyneebjy .gt_left {
  text-align: left;
}

#ueiyneebjy .gt_center {
  text-align: center;
}

#ueiyneebjy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ueiyneebjy .gt_font_normal {
  font-weight: normal;
}

#ueiyneebjy .gt_font_bold {
  font-weight: bold;
}

#ueiyneebjy .gt_font_italic {
  font-style: italic;
}

#ueiyneebjy .gt_super {
  font-size: 65%;
}

#ueiyneebjy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ueiyneebjy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ueiyneebjy .gt_indent_1 {
  text-indent: 5px;
}

#ueiyneebjy .gt_indent_2 {
  text-indent: 10px;
}

#ueiyneebjy .gt_indent_3 {
  text-indent: 15px;
}

#ueiyneebjy .gt_indent_4 {
  text-indent: 20px;
}

#ueiyneebjy .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings gt_spanner_row">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="<strong>OLS</strong>">
        <span class="gt_column_spanner"><strong>OLS</strong></span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="<strong>GLM</strong>">
        <span class="gt_column_spanner"><strong>GLM</strong></span>
      </th>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">% Families Below Poverty Level 2014-18</td>
<td headers="estimate_1" class="gt_row gt_center">2.3</td>
<td headers="ci_1" class="gt_row gt_center">2.1, 2.4</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">2.3</td>
<td headers="ci_2" class="gt_row gt_center">2.1, 2.4</td>
<td headers="p.value_2" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">rucc</td>
<td headers="estimate_1" class="gt_row gt_center"></td>
<td headers="ci_1" class="gt_row gt_center"></td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center"></td>
<td headers="ci_2" class="gt_row gt_center"></td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;01</td>
<td headers="estimate_1" class="gt_row gt_center">—</td>
<td headers="ci_1" class="gt_row gt_center">—</td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center">—</td>
<td headers="ci_2" class="gt_row gt_center">—</td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;02</td>
<td headers="estimate_1" class="gt_row gt_center">-1.9</td>
<td headers="ci_1" class="gt_row gt_center">-4.3, 0.44</td>
<td headers="p.value_1" class="gt_row gt_center">0.11</td>
<td headers="estimate_2" class="gt_row gt_center">-1.9</td>
<td headers="ci_2" class="gt_row gt_center">-4.3, 0.44</td>
<td headers="p.value_2" class="gt_row gt_center">0.11</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;03</td>
<td headers="estimate_1" class="gt_row gt_center">-3.4</td>
<td headers="ci_1" class="gt_row gt_center">-5.8, -0.93</td>
<td headers="p.value_1" class="gt_row gt_center">0.007</td>
<td headers="estimate_2" class="gt_row gt_center">-3.4</td>
<td headers="ci_2" class="gt_row gt_center">-5.8, -0.94</td>
<td headers="p.value_2" class="gt_row gt_center">0.007</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;04</td>
<td headers="estimate_1" class="gt_row gt_center">-6.7</td>
<td headers="ci_1" class="gt_row gt_center">-9.4, -3.9</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">-6.7</td>
<td headers="ci_2" class="gt_row gt_center">-9.4, -3.9</td>
<td headers="p.value_2" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;05</td>
<td headers="estimate_1" class="gt_row gt_center">-6.0</td>
<td headers="ci_1" class="gt_row gt_center">-9.8, -2.2</td>
<td headers="p.value_1" class="gt_row gt_center">0.002</td>
<td headers="estimate_2" class="gt_row gt_center">-6.0</td>
<td headers="ci_2" class="gt_row gt_center">-9.8, -2.2</td>
<td headers="p.value_2" class="gt_row gt_center">0.002</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;06</td>
<td headers="estimate_1" class="gt_row gt_center">-3.9</td>
<td headers="ci_1" class="gt_row gt_center">-6.2, -1.7</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">-3.9</td>
<td headers="ci_2" class="gt_row gt_center">-6.2, -1.7</td>
<td headers="p.value_2" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;07</td>
<td headers="estimate_1" class="gt_row gt_center">-4.0</td>
<td headers="ci_1" class="gt_row gt_center">-6.5, -1.5</td>
<td headers="p.value_1" class="gt_row gt_center">0.002</td>
<td headers="estimate_2" class="gt_row gt_center">-4.0</td>
<td headers="ci_2" class="gt_row gt_center">-6.5, -1.5</td>
<td headers="p.value_2" class="gt_row gt_center">0.002</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;08</td>
<td headers="estimate_1" class="gt_row gt_center">0.45</td>
<td headers="ci_1" class="gt_row gt_center">-3.7, 4.6</td>
<td headers="p.value_1" class="gt_row gt_center">0.8</td>
<td headers="estimate_2" class="gt_row gt_center">0.45</td>
<td headers="ci_2" class="gt_row gt_center">-3.7, 4.6</td>
<td headers="p.value_2" class="gt_row gt_center">0.8</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;09</td>
<td headers="estimate_1" class="gt_row gt_center">-3.9</td>
<td headers="ci_1" class="gt_row gt_center">-8.4, 0.61</td>
<td headers="p.value_1" class="gt_row gt_center">0.090</td>
<td headers="estimate_2" class="gt_row gt_center">-3.9</td>
<td headers="ci_2" class="gt_row gt_center">-8.4, 0.61</td>
<td headers="p.value_2" class="gt_row gt_center">0.090</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hpsa16</td>
<td headers="estimate_1" class="gt_row gt_center"></td>
<td headers="ci_1" class="gt_row gt_center"></td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center"></td>
<td headers="ci_2" class="gt_row gt_center"></td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no shortage</td>
<td headers="estimate_1" class="gt_row gt_center">—</td>
<td headers="ci_1" class="gt_row gt_center">—</td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center">—</td>
<td headers="ci_2" class="gt_row gt_center">—</td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;partial county shortage</td>
<td headers="estimate_1" class="gt_row gt_center">-0.66</td>
<td headers="ci_1" class="gt_row gt_center">-2.6, 1.3</td>
<td headers="p.value_1" class="gt_row gt_center">0.5</td>
<td headers="estimate_2" class="gt_row gt_center">-0.66</td>
<td headers="ci_2" class="gt_row gt_center">-2.6, 1.3</td>
<td headers="p.value_2" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;whole county shortage</td>
<td headers="estimate_1" class="gt_row gt_center">2.4</td>
<td headers="ci_1" class="gt_row gt_center">-0.10, 4.8</td>
<td headers="p.value_1" class="gt_row gt_center">0.060</td>
<td headers="estimate_2" class="gt_row gt_center">2.4</td>
<td headers="ci_2" class="gt_row gt_center">-0.09, 4.8</td>
<td headers="p.value_2" class="gt_row gt_center">0.060</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="7"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>Which shows the exact same output for both models, as it should be. The output shown by <code>summary(lm1)</code> and <code>summary(glm1)</code> is different though, but the same results can be recovered.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = lbrate1618 ~ fampov14 + rucc + hpsa16, family = gaussian, 
    data = ahrf_m)

Coefficients:
                              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                   62.26920    1.18901  52.371  &lt; 2e-16 ***
fampov14                       2.25805    0.06846  32.981  &lt; 2e-16 ***
rucc02                        -1.91854    1.20082  -1.598 0.110249    
rucc03                        -3.38658    1.25055  -2.708 0.006818 ** 
rucc04                        -6.65483    1.40639  -4.732 2.36e-06 ***
rucc05                        -5.96283    1.93739  -3.078 0.002110 ** 
rucc06                        -3.94180    1.14317  -3.448 0.000575 ***
rucc07                        -4.00730    1.28166  -3.127 0.001790 ** 
rucc08                         0.45112    2.11062   0.214 0.830770    
rucc09                        -3.88365    2.29118  -1.695 0.090202 .  
hpsa16partial county shortage -0.66219    1.00767  -0.657 0.511148    
hpsa16whole county shortage    2.36214    1.25335   1.885 0.059601 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for gaussian family taken to be 267.6184)

    Null deviance: 981607  on 2323  degrees of freedom
Residual deviance: 618734  on 2312  degrees of freedom
AIC: 19599

Number of Fisher Scoring iterations: 2</code></pre>
</div>
</div>
<p>This output shows the same coefficients, and hypothesis test results compared to <code>summary(lm1)</code>, but the residual variances are reported differently. The GLM summary reports the Null and Residual deviance instead of the Residual standard errors reported by <code>summary(lm1)</code>. If we take the residual deviance and divide it by the residual degrees of freedom, and take the square root, we get the residual standard error reported by <code>summary(lm1)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(glm1<span class="sc">$</span>deviance<span class="sc">/</span>glm1<span class="sc">$</span>df.residual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.35905</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lm1)<span class="sc">$</span>sigma</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 16.35905</code></pre>
</div>
</div>
<p>The deviance in the GLM model is calculated in the same way as the residual sums of squares:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>((<span class="fu">fitted</span>(lm1)<span class="sc">-</span>ahrf_m<span class="sc">$</span>lbrate1618 )<span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 618733.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>glm1<span class="sc">$</span>deviance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 618733.7</code></pre>
</div>
</div>
<p>We do not need to assume the identity function is the only one for the Gaussian GLM, for instance, the logarithmic link function can change the model to:</p>
<p><span class="math display">\[
ln(Y) = \beta_0 + \beta_1 x_1 \\
Y = exp(\beta_0 + \beta_1 x_1) \\
Y = exp(\beta_0) * exp(\beta_1 x_1)
\]</span> Which changes the model to no longer be additive in terms of the parameters for the logarithmic link function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>glm2<span class="ot">&lt;-</span> <span class="fu">glm</span>(lbrate1618 <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span><span class="fu">gaussian</span>(<span class="at">link =</span> <span class="st">"log"</span>))</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(glm1, glm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     df      AIC
glm1 13 19599.34
glm2 13 19687.44</code></pre>
</div>
</div>
<p>In this case, the identity link function is preferred because of the lower AIC.</p>
<p><strong>Different distributions have different link functions….</strong></p>
<p>The identity link function is appropriate for the Normal distribution, because this distribution can take any value from <span class="math inline">\(- \infty\)</span> to <span class="math inline">\(\infty\)</span>, and so the linear mean function can also take those values, theoretically. Other distributions may not have this wide of a numeric range, so appropriate link functions have to be used to transform the linear mean function to the scale of the mean of a particular distribution. The most common distributions for the generalized linear model and their common link functions are shown below, along with common expressions for the mean and variance of their respective distributions.</p>
<table class="table">
<colgroup>
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Distribution</th>
<th style="text-align: center;">Mean</th>
<th style="text-align: center;">Variance</th>
<th style="text-align: center;">Link Function</th>
<th style="text-align: center;">Range of Outcome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Gaussian</td>
<td style="text-align: center;"><span class="math inline">\(\mu\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sigma^2\)</span></td>
<td style="text-align: center;">Identity</td>
<td style="text-align: center;"><span class="math inline">\((-\infty , \infty)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Binomial</td>
<td style="text-align: center;"><span class="math inline">\(\pi\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n\pi(1-\pi)\)</span></td>
<td style="text-align: center;"><span class="math inline">\(log \left (\frac{\pi}{1-\pi} \right )\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{0,1,2,...n}{n}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Poisson</td>
<td style="text-align: center;"><span class="math inline">\(\lambda\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\lambda\)</span></td>
<td style="text-align: center;"><span class="math inline">\(log (\lambda)\)</span></td>
<td style="text-align: center;"><span class="math inline">\((0,1,2,...)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Gamma</td>
<td style="text-align: center;"><span class="math inline">\(\mu\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\phi \mu^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(log (\mu)\)</span></td>
<td style="text-align: center;"><span class="math inline">\((0, \infty)\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;">Negative Binomial</td>
<td style="text-align: center;"><span class="math inline">\(n(1-p)/p\)</span></td>
<td style="text-align: center;"><span class="math inline">\(n(1-p)/p^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(log (\mu)\)</span></td>
<td style="text-align: center;"><span class="math inline">\((0,1,2,...)\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;">Student-t</td>
<td style="text-align: center;"><span class="math inline">\(\mu\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{\sigma^2 \nu}{\nu-2}\)</span></td>
<td style="text-align: center;">Identity</td>
<td style="text-align: center;"><span class="math inline">\(-\infty , \infty\)</span></td>
</tr>
</tbody>
</table>
<p>While these are not all possible distributions for the GLM, these are distributions that are both widely used and commonly present not only in R but in other software as well. The <code>VGAM</code> package adds a much wider selection of both univariate and bivariate distributions for discrete and continuous outcomes.</p>
<section id="binomial-distribution" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="binomial-distribution"><span class="header-section-number">5.8.1</span> Binomial Distribution</h3>
<p>You have probably seen the binomial distribution in either a basic statistics course, remember the coin flips? Or in the context of a logistic regression model. There are two ways the binomial distribution is typically used, the first is the context of logistic regression, where a special case of the binomial is used, called the <strong><em>Bernoulli</em></strong> distribution. This is the case of the binomial when there is basically a single coin flip, and you’re trying to estimate the probability that it is heads (or tails). This is said to be a single <strong><em>trial</em></strong>, and the outcome is either 1 or 0 (heads or tails). We will spend time in chapter 5 discussing the logistic regression model in the context of individual level data.</p>
<p>The second way the binomial is used is when you have multiple trials, and you’re trying to estimate the probability of the event occurring over these trials. In this case, your number of trials, <span class="math inline">\(n\)</span> can be large, and your number of successes, <span class="math inline">\(y\)</span> is the random variable under consideration. This usage of the binomial has a wide applicability for place-based demographic analysis, as the basic distribution for a demographic rate. I will commonly refer to this as the <em>count-based binomial distribution</em>.</p>
<p>The mean of the binomial distribution is a proportion or a probability, <span class="math inline">\(\pi\)</span>, which tells you the probability of the event of interest occurs. Any model using the binomial distributor will be geared towards estimating this probability. The good thing is that, when we have count data, not just 1’s and 0’s, the same thing happens. The ratio or successes (<span class="math inline">\(y\)</span>) to trials (<span class="math inline">\(n\)</span>) is used to estimate <span class="math inline">\(\pi\)</span> and we build a model for that mean rate:</p>
<p><span class="math display">\[\text{Binomial} \binom{n}{y} = \frac{y}{n} = \pi = \text{some function of predictors}\]</span></p>
<p>The ratio <span class="math inline">\(\frac{y}{n}\)</span> is a rate or probability, and as such has very strict bounds. Probabilities cannot be less than 0 or greater than 1, so again, we should not use the Normal distribution here, since it is valid for all real numbers. Instead, we are using the binomial, but we still run into the problem of having a strictly bounded value, <span class="math inline">\(\pi\)</span> that we are trying to estimate with a linear function.</p>
<p>Enter the link function again.</p>
<p>The binomial distribution typically uses either a <a href="https://en.wikipedia.org/wiki/Logit">logit</a> or <a href="https://en.wikipedia.org/wiki/Probit">probit</a> link function, but others such as the <a href="http://data.princeton.edu/wws509/notes/c3s7.html">complementary log-log link function</a> are also used in certain circumstances. For now we will use the <em>logit</em> function.</p>
<p>The logit transforms the probability, <span class="math inline">\(\pi\)</span>, which is bound on the interval <span class="math inline">\([0,1]\)</span> into a new unbounded interval similar to the normal distribution of <span class="math inline">\([-\infty, \infty]\)</span>. The transformation is knows a the <em>log-odd</em>s transformation, or <em>logit</em> for short. The odds of an event happening are the probability that something happens, divided by the probability it does not happen, in this case:</p>
<p><span class="math display">\[\text{odds}({\pi}) = \frac{\pi}{(1-\pi)}\]</span></p>
<p>Which is bound on the interval <span class="math inline">\([0, \infty]\)</span>, when we take the natural log of the odds, the value is transformed into the linear space, of <span class="math inline">\([-\infty, \infty]\)</span>.</p>
<p><span class="math display">\[\text{log-odds }({\pi}) = log  \left ( \frac{\pi}{(1-\pi)}  \right) \]</span></p>
<p>This can be modeled using a linear function of covariates now, without worrying about the original boundary problem:</p>
<p><span class="math display">\[log  \left ( \frac{\pi}{1-\pi}  \right) = \beta_0 +\beta_1 x_1\]</span></p>
<p>or more compactly:</p>
<p><span class="math display">\[logit (\pi)  = \beta_0 +\beta_1 x_1\]</span></p>
<section id="binomial-regression" class="level4" data-number="5.8.1.1">
<h4 data-number="5.8.1.1" class="anchored" data-anchor-id="binomial-regression"><span class="header-section-number">5.8.1.1</span> Binomial regression</h4>
<p>The <code>glm()</code> function can estimate the count binomial model using the syntax <code>cbind( y, n-y)</code> in the outcome portion of the model formula.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>glmb<span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(lowbw1618, births1618<span class="sc">-</span>lowbw1618) <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> ahrf_m, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> binomial)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>glmb<span class="sc">%&gt;%</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="loatcfjjfo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#loatcfjjfo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#loatcfjjfo thead, #loatcfjjfo tbody, #loatcfjjfo tfoot, #loatcfjjfo tr, #loatcfjjfo td, #loatcfjjfo th {
  border-style: none;
}

#loatcfjjfo p {
  margin: 0;
  padding: 0;
}

#loatcfjjfo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#loatcfjjfo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#loatcfjjfo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#loatcfjjfo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#loatcfjjfo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#loatcfjjfo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#loatcfjjfo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#loatcfjjfo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#loatcfjjfo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#loatcfjjfo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#loatcfjjfo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#loatcfjjfo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#loatcfjjfo .gt_spanner_row {
  border-bottom-style: hidden;
}

#loatcfjjfo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#loatcfjjfo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#loatcfjjfo .gt_from_md > :first-child {
  margin-top: 0;
}

#loatcfjjfo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#loatcfjjfo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#loatcfjjfo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#loatcfjjfo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#loatcfjjfo .gt_row_group_first td {
  border-top-width: 2px;
}

#loatcfjjfo .gt_row_group_first th {
  border-top-width: 2px;
}

#loatcfjjfo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#loatcfjjfo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#loatcfjjfo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#loatcfjjfo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#loatcfjjfo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#loatcfjjfo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#loatcfjjfo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#loatcfjjfo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#loatcfjjfo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#loatcfjjfo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#loatcfjjfo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#loatcfjjfo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#loatcfjjfo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#loatcfjjfo .gt_left {
  text-align: left;
}

#loatcfjjfo .gt_center {
  text-align: center;
}

#loatcfjjfo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#loatcfjjfo .gt_font_normal {
  font-weight: normal;
}

#loatcfjjfo .gt_font_bold {
  font-weight: bold;
}

#loatcfjjfo .gt_font_italic {
  font-style: italic;
}

#loatcfjjfo .gt_super {
  font-size: 65%;
}

#loatcfjjfo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#loatcfjjfo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#loatcfjjfo .gt_indent_1 {
  text-indent: 5px;
}

#loatcfjjfo .gt_indent_2 {
  text-indent: 10px;
}

#loatcfjjfo .gt_indent_3 {
  text-indent: 15px;
}

#loatcfjjfo .gt_indent_4 {
  text-indent: 20px;
}

#loatcfjjfo .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>log(OR)</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>log(OR)</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">% Families Below Poverty Level 2014-18</td>
<td headers="estimate" class="gt_row gt_center">0.02</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.02</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">rucc</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;01</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;02</td>
<td headers="estimate" class="gt_row gt_center">-0.01</td>
<td headers="ci" class="gt_row gt_center">-0.02, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.003</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;03</td>
<td headers="estimate" class="gt_row gt_center">-0.02</td>
<td headers="ci" class="gt_row gt_center">-0.04, -0.01</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;04</td>
<td headers="estimate" class="gt_row gt_center">-0.06</td>
<td headers="ci" class="gt_row gt_center">-0.08, -0.04</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;05</td>
<td headers="estimate" class="gt_row gt_center">-0.04</td>
<td headers="ci" class="gt_row gt_center">-0.07, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.004</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;06</td>
<td headers="estimate" class="gt_row gt_center">-0.02</td>
<td headers="ci" class="gt_row gt_center">-0.04, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.014</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;07</td>
<td headers="estimate" class="gt_row gt_center">-0.03</td>
<td headers="ci" class="gt_row gt_center">-0.06, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.016</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;08</td>
<td headers="estimate" class="gt_row gt_center">0.04</td>
<td headers="ci" class="gt_row gt_center">-0.02, 0.10</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;09</td>
<td headers="estimate" class="gt_row gt_center">-0.03</td>
<td headers="ci" class="gt_row gt_center">-0.10, 0.03</td>
<td headers="p.value" class="gt_row gt_center">0.3</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hpsa16</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no shortage</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;partial county shortage</td>
<td headers="estimate" class="gt_row gt_center">-0.02</td>
<td headers="ci" class="gt_row gt_center">-0.03, 0.00</td>
<td headers="p.value" class="gt_row gt_center">0.011</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;whole county shortage</td>
<td headers="estimate" class="gt_row gt_center">0.00</td>
<td headers="ci" class="gt_row gt_center">-0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">0.8</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>The output above shows the results of the model. The coefficients are on the log-odds scale, and typically would be converted to an odds-ratio by exponentiating them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>glmb<span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exponentiate=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="ttzlywfyhl" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ttzlywfyhl table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ttzlywfyhl thead, #ttzlywfyhl tbody, #ttzlywfyhl tfoot, #ttzlywfyhl tr, #ttzlywfyhl td, #ttzlywfyhl th {
  border-style: none;
}

#ttzlywfyhl p {
  margin: 0;
  padding: 0;
}

#ttzlywfyhl .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ttzlywfyhl .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ttzlywfyhl .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ttzlywfyhl .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ttzlywfyhl .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ttzlywfyhl .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttzlywfyhl .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ttzlywfyhl .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ttzlywfyhl .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ttzlywfyhl .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ttzlywfyhl .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ttzlywfyhl .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ttzlywfyhl .gt_spanner_row {
  border-bottom-style: hidden;
}

#ttzlywfyhl .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ttzlywfyhl .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ttzlywfyhl .gt_from_md > :first-child {
  margin-top: 0;
}

#ttzlywfyhl .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ttzlywfyhl .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ttzlywfyhl .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ttzlywfyhl .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ttzlywfyhl .gt_row_group_first td {
  border-top-width: 2px;
}

#ttzlywfyhl .gt_row_group_first th {
  border-top-width: 2px;
}

#ttzlywfyhl .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttzlywfyhl .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ttzlywfyhl .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ttzlywfyhl .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttzlywfyhl .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttzlywfyhl .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ttzlywfyhl .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ttzlywfyhl .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ttzlywfyhl .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttzlywfyhl .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ttzlywfyhl .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttzlywfyhl .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ttzlywfyhl .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttzlywfyhl .gt_left {
  text-align: left;
}

#ttzlywfyhl .gt_center {
  text-align: center;
}

#ttzlywfyhl .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ttzlywfyhl .gt_font_normal {
  font-weight: normal;
}

#ttzlywfyhl .gt_font_bold {
  font-weight: bold;
}

#ttzlywfyhl .gt_font_italic {
  font-style: italic;
}

#ttzlywfyhl .gt_super {
  font-size: 65%;
}

#ttzlywfyhl .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ttzlywfyhl .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ttzlywfyhl .gt_indent_1 {
  text-indent: 5px;
}

#ttzlywfyhl .gt_indent_2 {
  text-indent: 10px;
}

#ttzlywfyhl .gt_indent_3 {
  text-indent: 15px;
}

#ttzlywfyhl .gt_indent_4 {
  text-indent: 20px;
}

#ttzlywfyhl .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">% Families Below Poverty Level 2014-18</td>
<td headers="estimate" class="gt_row gt_center">1.02</td>
<td headers="ci" class="gt_row gt_center">1.02, 1.02</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">rucc</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;01</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;02</td>
<td headers="estimate" class="gt_row gt_center">0.99</td>
<td headers="ci" class="gt_row gt_center">0.98, 1.0</td>
<td headers="p.value" class="gt_row gt_center">0.003</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;03</td>
<td headers="estimate" class="gt_row gt_center">0.98</td>
<td headers="ci" class="gt_row gt_center">0.96, 0.99</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;04</td>
<td headers="estimate" class="gt_row gt_center">0.95</td>
<td headers="ci" class="gt_row gt_center">0.93, 0.96</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;05</td>
<td headers="estimate" class="gt_row gt_center">0.96</td>
<td headers="ci" class="gt_row gt_center">0.93, 0.99</td>
<td headers="p.value" class="gt_row gt_center">0.004</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;06</td>
<td headers="estimate" class="gt_row gt_center">0.98</td>
<td headers="ci" class="gt_row gt_center">0.96, 1.0</td>
<td headers="p.value" class="gt_row gt_center">0.014</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;07</td>
<td headers="estimate" class="gt_row gt_center">0.97</td>
<td headers="ci" class="gt_row gt_center">0.94, 0.99</td>
<td headers="p.value" class="gt_row gt_center">0.016</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;08</td>
<td headers="estimate" class="gt_row gt_center">1.05</td>
<td headers="ci" class="gt_row gt_center">0.98, 1.11</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;09</td>
<td headers="estimate" class="gt_row gt_center">0.97</td>
<td headers="ci" class="gt_row gt_center">0.90, 1.03</td>
<td headers="p.value" class="gt_row gt_center">0.3</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hpsa16</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no shortage</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;partial county shortage</td>
<td headers="estimate" class="gt_row gt_center">0.98</td>
<td headers="ci" class="gt_row gt_center">0.97, 1.00</td>
<td headers="p.value" class="gt_row gt_center">0.011</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;whole county shortage</td>
<td headers="estimate" class="gt_row gt_center">1.00</td>
<td headers="ci" class="gt_row gt_center">0.98, 1.03</td>
<td headers="p.value" class="gt_row gt_center">0.8</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>In this case, the odds ratio interpretation is not as clear as in the case of the Bernoulli case, in the context of individuals. When I interpret the coefficients for the count binomial, I describe them as <em>percent changes in the mean</em>. For example, the <code>fampov14</code> odds ratio is 1.02, I describe this result as: The low birth weight rate increases by 2 percent for every 1 percentage point increase in the poverty rate. We can see this by using the fitted values from <code>emmeans</code>, here I generate two cases where <code>fampov14</code> is exactly 1 percentage point different, and you can see the difference in the estimated rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>rg <span class="ot">&lt;-</span> <span class="fu">ref_grid</span>(glmb,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">at=</span><span class="fu">list</span>( <span class="at">fampov14 =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>) ) ) </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">emmeans</span>(rg,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">specs =</span> <span class="st">"fampov14"</span>,</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> fampov14   prob       SE  df asymp.LCL asymp.UCL
        5 0.0735 0.000474 Inf    0.0726    0.0745
        6 0.0750 0.000470 Inf    0.0741    0.0760

Results are averaged over the levels of: rucc, hpsa16 
Confidence level used: 0.95 
Intervals are back-transformed from the logit scale </code></pre>
</div>
</div>
<p>We can calculate the percentage change in these two estimates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>(.<span class="dv">0750</span> <span class="sc">-</span> .<span class="dv">0735</span>)<span class="sc">/</span>.<span class="dv">0750</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.02</code></pre>
</div>
</div>
<p>and confirm that it is 2 percent.</p>
</section>
<section id="application-of-the-binomial-to-age-standardization" class="level4" data-number="5.8.1.2">
<h4 data-number="5.8.1.2" class="anchored" data-anchor-id="application-of-the-binomial-to-age-standardization"><span class="header-section-number">5.8.1.2</span> Application of the binomial to age standardization</h4>
<p>The Binomial is very useful for conducting standardization of rates between groups to measure the differences. To show an example of how to do age standardization, I use data from the <a href="https://wonder.cdc.gov/mortSQL.html">CDC Wonder Compressed Mortality file</a>. The data are for the states of Texas and California for the year 2016, and are the numbers of deaths and population at risk in 13 age groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>txca <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_delim</span>(<span class="st">"data/CMF_TX_CA_age.txt"</span>,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">delim =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">quote =</span> <span class="st">"</span><span class="sc">\"</span><span class="st">"</span>,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">skip=</span><span class="dv">1</span>,</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"State"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"State_Code"</span>,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Age_Group"</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Age_Group_Code"</span>,</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Deaths"</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Population"</span>,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">"Crude.Rate"</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>                          )<span class="sc">%&gt;%</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age_Group <span class="sc">!=</span> <span class="st">"Not Stated"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Population =</span> <span class="fu">as.numeric</span>(Population), <span class="at">Deaths =</span> <span class="fu">as.numeric</span>(Deaths))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 28 Columns: 7
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (7): State, State_Code, Age_Group, Age_Group_Code, Deaths, Population, C...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>txca<span class="sc">%&gt;%</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="ywxfzgsjfx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ywxfzgsjfx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ywxfzgsjfx thead, #ywxfzgsjfx tbody, #ywxfzgsjfx tfoot, #ywxfzgsjfx tr, #ywxfzgsjfx td, #ywxfzgsjfx th {
  border-style: none;
}

#ywxfzgsjfx p {
  margin: 0;
  padding: 0;
}

#ywxfzgsjfx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ywxfzgsjfx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ywxfzgsjfx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ywxfzgsjfx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ywxfzgsjfx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ywxfzgsjfx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ywxfzgsjfx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ywxfzgsjfx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ywxfzgsjfx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ywxfzgsjfx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ywxfzgsjfx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ywxfzgsjfx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ywxfzgsjfx .gt_spanner_row {
  border-bottom-style: hidden;
}

#ywxfzgsjfx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ywxfzgsjfx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ywxfzgsjfx .gt_from_md > :first-child {
  margin-top: 0;
}

#ywxfzgsjfx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ywxfzgsjfx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ywxfzgsjfx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ywxfzgsjfx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ywxfzgsjfx .gt_row_group_first td {
  border-top-width: 2px;
}

#ywxfzgsjfx .gt_row_group_first th {
  border-top-width: 2px;
}

#ywxfzgsjfx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ywxfzgsjfx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ywxfzgsjfx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ywxfzgsjfx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ywxfzgsjfx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ywxfzgsjfx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ywxfzgsjfx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ywxfzgsjfx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ywxfzgsjfx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ywxfzgsjfx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ywxfzgsjfx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ywxfzgsjfx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ywxfzgsjfx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ywxfzgsjfx .gt_left {
  text-align: left;
}

#ywxfzgsjfx .gt_center {
  text-align: center;
}

#ywxfzgsjfx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ywxfzgsjfx .gt_font_normal {
  font-weight: normal;
}

#ywxfzgsjfx .gt_font_bold {
  font-weight: bold;
}

#ywxfzgsjfx .gt_font_italic {
  font-style: italic;
}

#ywxfzgsjfx .gt_super {
  font-size: 65%;
}

#ywxfzgsjfx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ywxfzgsjfx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ywxfzgsjfx .gt_indent_1 {
  text-indent: 5px;
}

#ywxfzgsjfx .gt_indent_2 {
  text-indent: 10px;
}

#ywxfzgsjfx .gt_indent_3 {
  text-indent: 15px;
}

#ywxfzgsjfx .gt_indent_4 {
  text-indent: 20px;
}

#ywxfzgsjfx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="State">State</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="State_Code">State_Code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Age_Group">Age_Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Age_Group_Code">Age_Group_Code</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Deaths">Deaths</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Population">Population</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Crude.Rate">Crude.Rate</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">&lt; 1 year</td>
<td headers="Age_Group_Code" class="gt_row gt_right">1</td>
<td headers="Deaths" class="gt_row gt_right">2057</td>
<td headers="Population" class="gt_row gt_right">498832</td>
<td headers="Crude.Rate" class="gt_row gt_right">412.4</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">1-4 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">1-4</td>
<td headers="Deaths" class="gt_row gt_right">397</td>
<td headers="Population" class="gt_row gt_right">1988540</td>
<td headers="Crude.Rate" class="gt_row gt_right">20.0</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">5-9 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">5-9</td>
<td headers="Deaths" class="gt_row gt_right">253</td>
<td headers="Population" class="gt_row gt_right">2539626</td>
<td headers="Crude.Rate" class="gt_row gt_right">10.0</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">10-14 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">10-14</td>
<td headers="Deaths" class="gt_row gt_right">277</td>
<td headers="Population" class="gt_row gt_right">2522475</td>
<td headers="Crude.Rate" class="gt_row gt_right">11.0</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">15-19 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">15-19</td>
<td headers="Deaths" class="gt_row gt_right">1076</td>
<td headers="Population" class="gt_row gt_right">2579986</td>
<td headers="Crude.Rate" class="gt_row gt_right">41.7</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">20-24 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">20-24</td>
<td headers="Deaths" class="gt_row gt_right">2090</td>
<td headers="Population" class="gt_row gt_right">2812191</td>
<td headers="Crude.Rate" class="gt_row gt_right">74.3</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">25-34 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">25-34</td>
<td headers="Deaths" class="gt_row gt_right">5201</td>
<td headers="Population" class="gt_row gt_right">5917785</td>
<td headers="Crude.Rate" class="gt_row gt_right">87.9</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">35-44 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">35-44</td>
<td headers="Deaths" class="gt_row gt_right">7032</td>
<td headers="Population" class="gt_row gt_right">5159932</td>
<td headers="Crude.Rate" class="gt_row gt_right">136.3</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">45-54 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">45-54</td>
<td headers="Deaths" class="gt_row gt_right">16370</td>
<td headers="Population" class="gt_row gt_right">5195297</td>
<td headers="Crude.Rate" class="gt_row gt_right">315.1</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">55-64 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">55-64</td>
<td headers="Deaths" class="gt_row gt_right">34176</td>
<td headers="Population" class="gt_row gt_right">4688718</td>
<td headers="Crude.Rate" class="gt_row gt_right">728.9</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">65-74 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">65-74</td>
<td headers="Deaths" class="gt_row gt_right">45834</td>
<td headers="Population" class="gt_row gt_right">3089002</td>
<td headers="Crude.Rate" class="gt_row gt_right">1483.8</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">75-84 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">75-84</td>
<td headers="Deaths" class="gt_row gt_right">59121</td>
<td headers="Population" class="gt_row gt_right">1535300</td>
<td headers="Crude.Rate" class="gt_row gt_right">3850.8</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="State_Code" class="gt_row gt_right">06</td>
<td headers="Age_Group" class="gt_row gt_left">85+ years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">85+</td>
<td headers="Deaths" class="gt_row gt_right">88331</td>
<td headers="Population" class="gt_row gt_right">722333</td>
<td headers="Crude.Rate" class="gt_row gt_right">12228.6</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">&lt; 1 year</td>
<td headers="Age_Group_Code" class="gt_row gt_right">1</td>
<td headers="Deaths" class="gt_row gt_right">2287</td>
<td headers="Population" class="gt_row gt_right">405899</td>
<td headers="Crude.Rate" class="gt_row gt_right">563.4</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">1-4 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">1-4</td>
<td headers="Deaths" class="gt_row gt_right">433</td>
<td headers="Population" class="gt_row gt_right">1613272</td>
<td headers="Crude.Rate" class="gt_row gt_right">26.8</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">5-9 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">5-9</td>
<td headers="Deaths" class="gt_row gt_right">276</td>
<td headers="Population" class="gt_row gt_right">2038319</td>
<td headers="Crude.Rate" class="gt_row gt_right">13.5</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">10-14 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">10-14</td>
<td headers="Deaths" class="gt_row gt_right">319</td>
<td headers="Population" class="gt_row gt_right">2029062</td>
<td headers="Crude.Rate" class="gt_row gt_right">15.7</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">15-19 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">15-19</td>
<td headers="Deaths" class="gt_row gt_right">999</td>
<td headers="Population" class="gt_row gt_right">1970588</td>
<td headers="Crude.Rate" class="gt_row gt_right">50.7</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">20-24 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">20-24</td>
<td headers="Deaths" class="gt_row gt_right">1829</td>
<td headers="Population" class="gt_row gt_right">2005169</td>
<td headers="Crude.Rate" class="gt_row gt_right">91.2</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">25-34 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">25-34</td>
<td headers="Deaths" class="gt_row gt_right">4405</td>
<td headers="Population" class="gt_row gt_right">4085728</td>
<td headers="Crude.Rate" class="gt_row gt_right">107.8</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">35-44 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">35-44</td>
<td headers="Deaths" class="gt_row gt_right">6292</td>
<td headers="Population" class="gt_row gt_right">3726287</td>
<td headers="Crude.Rate" class="gt_row gt_right">168.9</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">45-54 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">45-54</td>
<td headers="Deaths" class="gt_row gt_right">13636</td>
<td headers="Population" class="gt_row gt_right">3519013</td>
<td headers="Crude.Rate" class="gt_row gt_right">387.5</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">55-64 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">55-64</td>
<td headers="Deaths" class="gt_row gt_right">28663</td>
<td headers="Population" class="gt_row gt_right">3116019</td>
<td headers="Crude.Rate" class="gt_row gt_right">919.9</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">65-74 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">65-74</td>
<td headers="Deaths" class="gt_row gt_right">37506</td>
<td headers="Population" class="gt_row gt_right">2008449</td>
<td headers="Crude.Rate" class="gt_row gt_right">1867.4</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">75-84 years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">75-84</td>
<td headers="Deaths" class="gt_row gt_right">44144</td>
<td headers="Population" class="gt_row gt_right">957001</td>
<td headers="Crude.Rate" class="gt_row gt_right">4612.7</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="State_Code" class="gt_row gt_right">48</td>
<td headers="Age_Group" class="gt_row gt_left">85+ years</td>
<td headers="Age_Group_Code" class="gt_row gt_right">85+</td>
<td headers="Deaths" class="gt_row gt_right">51173</td>
<td headers="Population" class="gt_row gt_right">387790</td>
<td headers="Crude.Rate" class="gt_row gt_right">13196.1</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>txca<span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State)<span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p_pop =</span> Population<span class="sc">/</span><span class="fu">sum</span>(Population ))<span class="sc">%&gt;%</span></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(txca<span class="sc">$</span>Age_Group,<span class="st">"&lt; 1 year"</span>,</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"1-4 years"</span>,</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"5-9 years"</span>,</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"10-14 years"</span>,</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"15-19 years"</span>,</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"20-24 years"</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"25-34 years"</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"35-44 years"</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"45-54 years"</span>,</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"55-64 years"</span>,</span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"65-74 years"</span>,</span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"75-84 years"</span>, <span class="st">"85+ years"</span></span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a>                                    ))<span class="sc">%&gt;%</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> p_pop,<span class="at">group=</span>State, <span class="at">color=</span> State))<span class="sc">+</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">lwd=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"% in Age"</span> )<span class="sc">+</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span> (<span class="st">"Age group"</span>)<span class="sc">+</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Age distribution in Texas and California"</span>)<span class="sc">+</span></span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in
dplyr 1.1.0.
ℹ Please use `reframe()` instead.
ℹ When switching from `summarise()` to `reframe()`, remember that `reframe()`
  always returns an ungrouped data frame and adjust accordingly.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'State'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see that the age distribution of Texas is slightly younger than California, also the large peak at 25-34 year age group is because the data adopt a 10 year age interval after age 25.</p>
<p>To do age standardization using the regression framework, we have to control for the differences in the age structure of the two populations (Texas and California) by regressing the mortality rate on the Age structure, the difference between the states after doing this is the difference in the age-standardized rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>txca<span class="ot">&lt;-</span> txca<span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age_Group =</span> forcats<span class="sc">::</span><span class="fu">fct_relevel</span>(txca<span class="sc">$</span>Age_Group,<span class="st">"&lt; 1 year"</span>,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"1-4 years"</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">"5-9 years"</span>,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"10-14 years"</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"15-19 years"</span>,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"20-24 years"</span>,</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"25-34 years"</span>,</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"35-44 years"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"45-54 years"</span>,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"55-64 years"</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"65-74 years"</span>,</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">"75-84 years"</span>, <span class="st">"85+ years"</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>                                    ))</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>glmb_s <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(Deaths, Population<span class="sc">-</span>Deaths) <span class="sc">~</span> <span class="fu">factor</span>(Age_Group)<span class="sc">+</span>State,</span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>txca,</span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>binomial)</span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>glmb_s<span class="sc">%&gt;%</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="nbmrvnfass" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nbmrvnfass table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nbmrvnfass thead, #nbmrvnfass tbody, #nbmrvnfass tfoot, #nbmrvnfass tr, #nbmrvnfass td, #nbmrvnfass th {
  border-style: none;
}

#nbmrvnfass p {
  margin: 0;
  padding: 0;
}

#nbmrvnfass .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nbmrvnfass .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nbmrvnfass .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nbmrvnfass .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nbmrvnfass .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nbmrvnfass .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbmrvnfass .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nbmrvnfass .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nbmrvnfass .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nbmrvnfass .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nbmrvnfass .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nbmrvnfass .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nbmrvnfass .gt_spanner_row {
  border-bottom-style: hidden;
}

#nbmrvnfass .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nbmrvnfass .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nbmrvnfass .gt_from_md > :first-child {
  margin-top: 0;
}

#nbmrvnfass .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nbmrvnfass .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nbmrvnfass .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nbmrvnfass .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nbmrvnfass .gt_row_group_first td {
  border-top-width: 2px;
}

#nbmrvnfass .gt_row_group_first th {
  border-top-width: 2px;
}

#nbmrvnfass .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbmrvnfass .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nbmrvnfass .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nbmrvnfass .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbmrvnfass .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbmrvnfass .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nbmrvnfass .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nbmrvnfass .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nbmrvnfass .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nbmrvnfass .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nbmrvnfass .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbmrvnfass .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nbmrvnfass .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nbmrvnfass .gt_left {
  text-align: left;
}

#nbmrvnfass .gt_center {
  text-align: center;
}

#nbmrvnfass .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nbmrvnfass .gt_font_normal {
  font-weight: normal;
}

#nbmrvnfass .gt_font_bold {
  font-weight: bold;
}

#nbmrvnfass .gt_font_italic {
  font-style: italic;
}

#nbmrvnfass .gt_super {
  font-size: 65%;
}

#nbmrvnfass .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nbmrvnfass .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nbmrvnfass .gt_indent_1 {
  text-indent: 5px;
}

#nbmrvnfass .gt_indent_2 {
  text-indent: 10px;
}

#nbmrvnfass .gt_indent_3 {
  text-indent: 15px;
}

#nbmrvnfass .gt_indent_4 {
  text-indent: 20px;
}

#nbmrvnfass .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>OR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>OR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(Age_Group)</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;&lt; 1 year</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1-4 years</td>
<td headers="estimate" class="gt_row gt_center">0.05</td>
<td headers="ci" class="gt_row gt_center">0.04, 0.05</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5-9 years</td>
<td headers="estimate" class="gt_row gt_center">0.02</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;10-14 years</td>
<td headers="estimate" class="gt_row gt_center">0.03</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;15-19 years</td>
<td headers="estimate" class="gt_row gt_center">0.09</td>
<td headers="ci" class="gt_row gt_center">0.09, 0.10</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-24 years</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">0.16, 0.18</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;25-34 years</td>
<td headers="estimate" class="gt_row gt_center">0.20</td>
<td headers="ci" class="gt_row gt_center">0.19, 0.21</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;35-44 years</td>
<td headers="estimate" class="gt_row gt_center">0.31</td>
<td headers="ci" class="gt_row gt_center">0.30, 0.32</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;45-54 years</td>
<td headers="estimate" class="gt_row gt_center">0.72</td>
<td headers="ci" class="gt_row gt_center">0.70, 0.75</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;55-64 years</td>
<td headers="estimate" class="gt_row gt_center">1.70</td>
<td headers="ci" class="gt_row gt_center">1.65, 1.75</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;65-74 years</td>
<td headers="estimate" class="gt_row gt_center">3.48</td>
<td headers="ci" class="gt_row gt_center">3.38, 3.59</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;75-84 years</td>
<td headers="estimate" class="gt_row gt_center">9.07</td>
<td headers="ci" class="gt_row gt_center">8.80, 9.35</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;85+ years</td>
<td headers="estimate" class="gt_row gt_center">30.4</td>
<td headers="ci" class="gt_row gt_center">29.5, 31.3</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">State</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;California</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Texas</td>
<td headers="estimate" class="gt_row gt_center">1.20</td>
<td headers="ci" class="gt_row gt_center">1.19, 1.21</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> OR = Odds Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>Which shows that Texas has a standardized mortality rate 20 percent higher than California.</p>
</section>
</section>
</section>
<section id="poisson-distribution" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="poisson-distribution"><span class="header-section-number">5.9</span> Poisson distribution</h2>
<p>Another distribution commonly used in the analysis of place-based data is the Poisson distribution. The Poisson is applicable to outcomes that are positive integers, and is commonly used in epidemiology as a model of relative risk of a disease or mortality. The Poisson has a single parameter, the mean, <span class="math inline">\(\lambda\)</span>, and it is really the average count for the outcome (<span class="math inline">\(y\)</span>). We have several ways of modeling a count outcome with the Poisson</p>
<ul>
<li><em>Pure count model</em> If each area or place has the same total area, risk set, or population size, then we can model the mean as-is. This would lead to a model that looks like:</li>
</ul>
<p><span class="math display">\[log(\lambda)= \beta_0 + \beta_1 x_1\]</span></p>
<p>When we see the <span class="math inline">\(\beta_1\)</span> parameter in this model in computer output, it is on the log-scale, since that is the scale of the outcome for the Poisson model. In order to interpret the <span class="math inline">\(\beta_1\)</span>, we have to <strong><em>exponentiate</em></strong> it. When we do this, the parameter is interpreted as the <em>percentage change in the mean of the outcome</em>, for a 1 unit change in <span class="math inline">\(x_1\)</span>. For instance if we estimate a model and see in the output that <span class="math inline">\(\beta_1 = \text{.025}\)</span>, then <span class="math inline">\(\exp(\beta_1) = \text{exp}(\text{.025}) = \text{1.025}\)</span>, or for a 1 unit increase in <span class="math inline">\(x_1\)</span>, the mean of <span class="math inline">\(y\)</span> increases by 1.025. So if the mean of <span class="math inline">\(y\)</span> is 10, when <span class="math inline">\(x_1\)</span> = 0, then the mean is <span class="math inline">\(10*(1.025*1)\)</span> or <span class="math inline">\(10.25\)</span> when <span class="math inline">\(x_1\)</span> = 1. This application of the Poisson is rare in demographic research because places rarely have either equal populations or areas, so the <em>Rate Model</em> or the <em>Relative Risk Model</em> are much more commonly used.</p>
<ul>
<li><em>Rate model</em> The second type of modeling strategy used in the Poisson model is for a rate of occurrence. This model includes an <strong><em>offset term</em></strong> in the model to incorporate unequal population sizes, this is the most common way the data are analyzed in demographic research. This offset term can be thought of as the denominator for the rate, and we can show how it is included in the model.</li>
</ul>
<p>If <span class="math inline">\(n\)</span> is the population size for each place, then, we want to do a regression on the rate of occurrence of our outcome. The rate is typically expressed as a proportion, or probability <span class="math inline">\(rate = \frac{y}{n}\)</span>, as seen in the Binomial distribution earlier:</p>
<p><span class="math display">\[
log(y/n)= \beta_0 + \beta_1 x_1 \\
log(y) - log(n)= \beta_0 + \beta_1 x_1\\
log(y)= \beta_0 + \beta_1 x_1 + log(n)
\]</span></p>
<p>Similar to the example from before, when interpreting the effect of <span class="math inline">\(\beta_1\)</span> in this model, we also have to exponentiate it. In this case, the interpretation would not be related to the overall count, but to the rate of occurrence. So, if as before, the <span class="math inline">\(\beta_1 = \text{.025}\)</span>, then <span class="math inline">\(\exp(\beta_1) = \text{exp}(\text{.025}) = \text{1.025}\)</span>, or for a 1 unit increase in <span class="math inline">\(x_1\)</span>, the <strong><em>rate</em></strong> of occurrence of <span class="math inline">\(y\)</span> increases by a factor of 1.025.</p>
<p>This model includes the natural log of the population size in the <code>offset()</code> function on the right side of the model formula. R will not estimate a regression coefficient for this term, and as in the equation above, the term just represents a scale factor for the outcome.</p>
<p><strong>Note on offsets</strong> It is important to ensure that all of the populations in a particular analysis have non-zero counts, because if the model sees <span class="math inline">\(log(0)\)</span> in data, it will generate an error, because this is not a number.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -Inf</code></pre>
</div>
</div>
<p>The Poisson model with a population offset is specified as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>glmp_s <span class="ot">&lt;-</span> <span class="fu">glm</span>(Deaths <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(Population)) <span class="sc">+</span> <span class="fu">factor</span>(Age_Group) <span class="sc">+</span> State,</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>txca,</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>poisson)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>glmp_s<span class="sc">%&gt;%</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="hfwlfhgkqd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hfwlfhgkqd table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hfwlfhgkqd thead, #hfwlfhgkqd tbody, #hfwlfhgkqd tfoot, #hfwlfhgkqd tr, #hfwlfhgkqd td, #hfwlfhgkqd th {
  border-style: none;
}

#hfwlfhgkqd p {
  margin: 0;
  padding: 0;
}

#hfwlfhgkqd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hfwlfhgkqd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hfwlfhgkqd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hfwlfhgkqd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hfwlfhgkqd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfwlfhgkqd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfwlfhgkqd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hfwlfhgkqd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hfwlfhgkqd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hfwlfhgkqd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hfwlfhgkqd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hfwlfhgkqd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hfwlfhgkqd .gt_spanner_row {
  border-bottom-style: hidden;
}

#hfwlfhgkqd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hfwlfhgkqd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hfwlfhgkqd .gt_from_md > :first-child {
  margin-top: 0;
}

#hfwlfhgkqd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hfwlfhgkqd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hfwlfhgkqd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hfwlfhgkqd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hfwlfhgkqd .gt_row_group_first td {
  border-top-width: 2px;
}

#hfwlfhgkqd .gt_row_group_first th {
  border-top-width: 2px;
}

#hfwlfhgkqd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfwlfhgkqd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hfwlfhgkqd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hfwlfhgkqd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfwlfhgkqd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfwlfhgkqd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hfwlfhgkqd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hfwlfhgkqd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hfwlfhgkqd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hfwlfhgkqd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfwlfhgkqd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfwlfhgkqd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hfwlfhgkqd .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hfwlfhgkqd .gt_left {
  text-align: left;
}

#hfwlfhgkqd .gt_center {
  text-align: center;
}

#hfwlfhgkqd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hfwlfhgkqd .gt_font_normal {
  font-weight: normal;
}

#hfwlfhgkqd .gt_font_bold {
  font-weight: bold;
}

#hfwlfhgkqd .gt_font_italic {
  font-style: italic;
}

#hfwlfhgkqd .gt_super {
  font-size: 65%;
}

#hfwlfhgkqd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hfwlfhgkqd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hfwlfhgkqd .gt_indent_1 {
  text-indent: 5px;
}

#hfwlfhgkqd .gt_indent_2 {
  text-indent: 10px;
}

#hfwlfhgkqd .gt_indent_3 {
  text-indent: 15px;
}

#hfwlfhgkqd .gt_indent_4 {
  text-indent: 20px;
}

#hfwlfhgkqd .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>IRR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>IRR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(Age_Group)</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;&lt; 1 year</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1-4 years</td>
<td headers="estimate" class="gt_row gt_center">0.05</td>
<td headers="ci" class="gt_row gt_center">0.04, 0.05</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5-9 years</td>
<td headers="estimate" class="gt_row gt_center">0.02</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;10-14 years</td>
<td headers="estimate" class="gt_row gt_center">0.03</td>
<td headers="ci" class="gt_row gt_center">0.03, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;15-19 years</td>
<td headers="estimate" class="gt_row gt_center">0.10</td>
<td headers="ci" class="gt_row gt_center">0.09, 0.10</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-24 years</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">0.16, 0.18</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;25-34 years</td>
<td headers="estimate" class="gt_row gt_center">0.20</td>
<td headers="ci" class="gt_row gt_center">0.19, 0.21</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;35-44 years</td>
<td headers="estimate" class="gt_row gt_center">0.31</td>
<td headers="ci" class="gt_row gt_center">0.30, 0.32</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;45-54 years</td>
<td headers="estimate" class="gt_row gt_center">0.72</td>
<td headers="ci" class="gt_row gt_center">0.70, 0.75</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;55-64 years</td>
<td headers="estimate" class="gt_row gt_center">1.69</td>
<td headers="ci" class="gt_row gt_center">1.64, 1.74</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;65-74 years</td>
<td headers="estimate" class="gt_row gt_center">3.44</td>
<td headers="ci" class="gt_row gt_center">3.33, 3.54</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;75-84 years</td>
<td headers="estimate" class="gt_row gt_center">8.73</td>
<td headers="ci" class="gt_row gt_center">8.47, 9.00</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;85+ years</td>
<td headers="estimate" class="gt_row gt_center">26.6</td>
<td headers="ci" class="gt_row gt_center">25.8, 27.4</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">State</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;California</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Texas</td>
<td headers="estimate" class="gt_row gt_center">1.19</td>
<td headers="ci" class="gt_row gt_center">1.18, 1.19</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>This result is very close to that from the Binomial model, where we see after age standardization, Texas has a 19 percent higher mortality rate overall than California.</p>
</section>
<section id="relative-risk-analysis" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="relative-risk-analysis"><span class="header-section-number">5.10</span> Relative risk analysis</h2>
<p>The third type of model for the Poisson distribution focuses on the idea of the relative risk of an event, and uses the <strong><em>Standardized risk ratio</em></strong> as its currency.</p>
<ul>
<li>The <em>Standardized risk ratio</em> incorporates differential exposure due to population size as an <strong><em>expected count</em></strong> of the outcome in the offset term, and are typically seen in epidemiological studies. The expected count <span class="math inline">\(E\)</span>, incorporates the different population sizes of each area by estimating the number of events that <strong>should occur</strong>, if the area followed a given rate of occurrence. The expected count is calculated by multiplying the average rate of occurrence, <span class="math inline">\(r\)</span>, by the population size, <span class="math inline">\(n\)</span>: <span class="math inline">\(E_i = r * n_i\)</span>, where <span class="math inline">\(r = \frac{\sum y_i}{\sum n_i}\)</span>, is the overall rate in the population. This method is commonly referred to as <strong><em>internal standardization</em></strong> because we are using the data at hand to estimate the overall rate of occurrence, versus using a rate from some other published source.</li>
</ul>
<p>The model for the mean of the outcome would look like this:</p>
<p><span class="math display">\[log(y)= \beta_0 + \beta_1 x_1  + log(E)\]</span>.</p>
<p>And is specified very similarly to the rate model above. First, I show how to calculate the expected number of deaths in the data. A naive method of calculating the expected counts is to use the crude death rate as <span class="math inline">\(r\)</span>, or we can use an age-specific death rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">#crude death rate</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>txca<span class="sc">$</span>E<span class="ot">&lt;-</span> txca<span class="sc">$</span>Population<span class="sc">*</span>(<span class="fu">sum</span>(txca<span class="sc">$</span>Deaths<span class="sc">/</span><span class="fu">sum</span>(txca<span class="sc">$</span>Population)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this calculation, the <code>Population</code> variable is multiplied by <span class="math inline">\(r\)</span>, which is the sum of all deaths, divided by all populations.</p>
<p>The age-specific expected count is a little more involved. We first have to sum all deaths and populations by age, then calculate the age specific rate, then join this back to the original data based on the <code>Age_Group</code> variable. Is this the only way to do this, no, but it works in this example. Alternatively, we could get another age schedule of mortality rates and merge it to these data and standardize our data to that mortality schedule.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Age specific death rate</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>txca2<span class="ot">&lt;-</span> txca<span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age_Group)<span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">ndeaths =</span> <span class="fu">sum</span>(Deaths), <span class="at">npop=</span><span class="fu">sum</span>(Population))<span class="sc">%&gt;%</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_age =</span> ndeaths<span class="sc">/</span>npop)<span class="sc">%&gt;%</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()<span class="sc">%&gt;%</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., txca, <span class="at">by =</span> <span class="st">"Age_Group"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(State, Age_Group)<span class="sc">%&gt;%</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">E_age =</span> Population <span class="sc">*</span> r_age)</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>txca2<span class="sc">%&gt;%</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(State, Age_Group, Deaths, Population, E, E_age)<span class="sc">%&gt;%</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="mhypywntgm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mhypywntgm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mhypywntgm thead, #mhypywntgm tbody, #mhypywntgm tfoot, #mhypywntgm tr, #mhypywntgm td, #mhypywntgm th {
  border-style: none;
}

#mhypywntgm p {
  margin: 0;
  padding: 0;
}

#mhypywntgm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mhypywntgm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mhypywntgm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mhypywntgm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mhypywntgm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mhypywntgm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mhypywntgm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mhypywntgm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mhypywntgm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mhypywntgm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mhypywntgm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mhypywntgm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mhypywntgm .gt_spanner_row {
  border-bottom-style: hidden;
}

#mhypywntgm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mhypywntgm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mhypywntgm .gt_from_md > :first-child {
  margin-top: 0;
}

#mhypywntgm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mhypywntgm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mhypywntgm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mhypywntgm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mhypywntgm .gt_row_group_first td {
  border-top-width: 2px;
}

#mhypywntgm .gt_row_group_first th {
  border-top-width: 2px;
}

#mhypywntgm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mhypywntgm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mhypywntgm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mhypywntgm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mhypywntgm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mhypywntgm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mhypywntgm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mhypywntgm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mhypywntgm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mhypywntgm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mhypywntgm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mhypywntgm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mhypywntgm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mhypywntgm .gt_left {
  text-align: left;
}

#mhypywntgm .gt_center {
  text-align: center;
}

#mhypywntgm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mhypywntgm .gt_font_normal {
  font-weight: normal;
}

#mhypywntgm .gt_font_bold {
  font-weight: bold;
}

#mhypywntgm .gt_font_italic {
  font-style: italic;
}

#mhypywntgm .gt_super {
  font-size: 65%;
}

#mhypywntgm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mhypywntgm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mhypywntgm .gt_indent_1 {
  text-indent: 5px;
}

#mhypywntgm .gt_indent_2 {
  text-indent: 10px;
}

#mhypywntgm .gt_indent_3 {
  text-indent: 15px;
}

#mhypywntgm .gt_indent_4 {
  text-indent: 20px;
}

#mhypywntgm .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="State">State</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="Age_Group">Age_Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Deaths">Deaths</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Population">Population</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="E">E</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="E_age">E_age</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">&lt; 1 year</td>
<td headers="Deaths" class="gt_row gt_right">2057</td>
<td headers="Population" class="gt_row gt_right">498832</td>
<td headers="E" class="gt_row gt_right">3375.789</td>
<td headers="E_age" class="gt_row gt_right">2395.1055</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">1-4 years</td>
<td headers="Deaths" class="gt_row gt_right">397</td>
<td headers="Population" class="gt_row gt_right">1988540</td>
<td headers="E" class="gt_row gt_right">13457.219</td>
<td headers="E_age" class="gt_row gt_right">458.2383</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">5-9 years</td>
<td headers="Deaths" class="gt_row gt_right">253</td>
<td headers="Population" class="gt_row gt_right">2539626</td>
<td headers="E" class="gt_row gt_right">17186.631</td>
<td headers="E_age" class="gt_row gt_right">293.4640</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">10-14 years</td>
<td headers="Deaths" class="gt_row gt_right">277</td>
<td headers="Population" class="gt_row gt_right">2522475</td>
<td headers="E" class="gt_row gt_right">17070.564</td>
<td headers="E_age" class="gt_row gt_right">330.3049</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">15-19 years</td>
<td headers="Deaths" class="gt_row gt_right">1076</td>
<td headers="Population" class="gt_row gt_right">2579986</td>
<td headers="E" class="gt_row gt_right">17459.763</td>
<td headers="E_age" class="gt_row gt_right">1176.4386</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">20-24 years</td>
<td headers="Deaths" class="gt_row gt_right">2090</td>
<td headers="Population" class="gt_row gt_right">2812191</td>
<td headers="E" class="gt_row gt_right">19031.184</td>
<td headers="E_age" class="gt_row gt_right">2287.7627</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">25-34 years</td>
<td headers="Deaths" class="gt_row gt_right">5201</td>
<td headers="Population" class="gt_row gt_right">5917785</td>
<td headers="E" class="gt_row gt_right">40047.939</td>
<td headers="E_age" class="gt_row gt_right">5682.6280</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">35-44 years</td>
<td headers="Deaths" class="gt_row gt_right">7032</td>
<td headers="Population" class="gt_row gt_right">5159932</td>
<td headers="E" class="gt_row gt_right">34919.255</td>
<td headers="E_age" class="gt_row gt_right">7736.8039</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">45-54 years</td>
<td headers="Deaths" class="gt_row gt_right">16370</td>
<td headers="Population" class="gt_row gt_right">5195297</td>
<td headers="E" class="gt_row gt_right">35158.583</td>
<td headers="E_age" class="gt_row gt_right">17888.9759</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">55-64 years</td>
<td headers="Deaths" class="gt_row gt_right">34176</td>
<td headers="Population" class="gt_row gt_right">4688718</td>
<td headers="E" class="gt_row gt_right">31730.368</td>
<td headers="E_age" class="gt_row gt_right">37750.7084</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">65-74 years</td>
<td headers="Deaths" class="gt_row gt_right">45834</td>
<td headers="Population" class="gt_row gt_right">3089002</td>
<td headers="E" class="gt_row gt_right">20904.471</td>
<td headers="E_age" class="gt_row gt_right">50503.1685</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">75-84 years</td>
<td headers="Deaths" class="gt_row gt_right">59121</td>
<td headers="Population" class="gt_row gt_right">1535300</td>
<td headers="E" class="gt_row gt_right">10389.969</td>
<td headers="E_age" class="gt_row gt_right">63613.0044</td></tr>
    <tr><td headers="State" class="gt_row gt_left">California</td>
<td headers="Age_Group" class="gt_row gt_center">85+ years</td>
<td headers="Deaths" class="gt_row gt_right">88331</td>
<td headers="Population" class="gt_row gt_right">722333</td>
<td headers="E" class="gt_row gt_right">4888.307</td>
<td headers="E_age" class="gt_row gt_right">90772.2323</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">&lt; 1 year</td>
<td headers="Deaths" class="gt_row gt_right">2287</td>
<td headers="Population" class="gt_row gt_right">405899</td>
<td headers="E" class="gt_row gt_right">2746.875</td>
<td headers="E_age" class="gt_row gt_right">1948.8945</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">1-4 years</td>
<td headers="Deaths" class="gt_row gt_right">433</td>
<td headers="Population" class="gt_row gt_right">1613272</td>
<td headers="E" class="gt_row gt_right">10917.635</td>
<td headers="E_age" class="gt_row gt_right">371.7617</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">5-9 years</td>
<td headers="Deaths" class="gt_row gt_right">276</td>
<td headers="Population" class="gt_row gt_right">2038319</td>
<td headers="E" class="gt_row gt_right">13794.093</td>
<td headers="E_age" class="gt_row gt_right">235.5360</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">10-14 years</td>
<td headers="Deaths" class="gt_row gt_right">319</td>
<td headers="Population" class="gt_row gt_right">2029062</td>
<td headers="E" class="gt_row gt_right">13731.447</td>
<td headers="E_age" class="gt_row gt_right">265.6951</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">15-19 years</td>
<td headers="Deaths" class="gt_row gt_right">999</td>
<td headers="Population" class="gt_row gt_right">1970588</td>
<td headers="E" class="gt_row gt_right">13335.731</td>
<td headers="E_age" class="gt_row gt_right">898.5614</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">20-24 years</td>
<td headers="Deaths" class="gt_row gt_right">1829</td>
<td headers="Population" class="gt_row gt_right">2005169</td>
<td headers="E" class="gt_row gt_right">13569.754</td>
<td headers="E_age" class="gt_row gt_right">1631.2373</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">25-34 years</td>
<td headers="Deaths" class="gt_row gt_right">4405</td>
<td headers="Population" class="gt_row gt_right">4085728</td>
<td headers="E" class="gt_row gt_right">27649.701</td>
<td headers="E_age" class="gt_row gt_right">3923.3720</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">35-44 years</td>
<td headers="Deaths" class="gt_row gt_right">6292</td>
<td headers="Population" class="gt_row gt_right">3726287</td>
<td headers="E" class="gt_row gt_right">25217.225</td>
<td headers="E_age" class="gt_row gt_right">5587.1961</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">45-54 years</td>
<td headers="Deaths" class="gt_row gt_right">13636</td>
<td headers="Population" class="gt_row gt_right">3519013</td>
<td headers="E" class="gt_row gt_right">23814.522</td>
<td headers="E_age" class="gt_row gt_right">12117.0241</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">55-64 years</td>
<td headers="Deaths" class="gt_row gt_right">28663</td>
<td headers="Population" class="gt_row gt_right">3116019</td>
<td headers="E" class="gt_row gt_right">21087.305</td>
<td headers="E_age" class="gt_row gt_right">25088.2916</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">65-74 years</td>
<td headers="Deaths" class="gt_row gt_right">37506</td>
<td headers="Population" class="gt_row gt_right">2008449</td>
<td headers="E" class="gt_row gt_right">13591.951</td>
<td headers="E_age" class="gt_row gt_right">32836.8315</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">75-84 years</td>
<td headers="Deaths" class="gt_row gt_right">44144</td>
<td headers="Population" class="gt_row gt_right">957001</td>
<td headers="E" class="gt_row gt_right">6476.396</td>
<td headers="E_age" class="gt_row gt_right">39651.9956</td></tr>
    <tr><td headers="State" class="gt_row gt_left">Texas</td>
<td headers="Age_Group" class="gt_row gt_center">85+ years</td>
<td headers="Deaths" class="gt_row gt_right">51173</td>
<td headers="Population" class="gt_row gt_right">387790</td>
<td headers="E" class="gt_row gt_right">2624.325</td>
<td headers="E_age" class="gt_row gt_right">48731.7677</td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<p>In this table, you can see the age-specific expected counts of deaths are much more in line with the age-specific mortality rate, and the numbers of expected deaths are much more similar to the observed pattern of deaths, when compared to the expected counts derived from the crude death rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>glmp_E <span class="ot">&lt;-</span> <span class="fu">glm</span>(Deaths <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(E)) <span class="sc">+</span> <span class="fu">factor</span>(Age_Group)<span class="sc">+</span>State,</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>txca2,</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>poisson)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>glmp_Eage <span class="ot">&lt;-</span> <span class="fu">glm</span>(Deaths <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(E_age)) <span class="sc">+</span> <span class="fu">factor</span>(Age_Group)<span class="sc">+</span>State,</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>txca2,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>poisson)</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> glmp_E<span class="sc">%&gt;%</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> T)</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> glmp_Eage<span class="sc">%&gt;%</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> T)</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>m_all <span class="ot">&lt;-</span> <span class="fu">tbl_merge</span>(<span class="fu">list</span>(m1, m2))</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>m_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="vlpamufqig" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vlpamufqig table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vlpamufqig thead, #vlpamufqig tbody, #vlpamufqig tfoot, #vlpamufqig tr, #vlpamufqig td, #vlpamufqig th {
  border-style: none;
}

#vlpamufqig p {
  margin: 0;
  padding: 0;
}

#vlpamufqig .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vlpamufqig .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vlpamufqig .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vlpamufqig .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vlpamufqig .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlpamufqig .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlpamufqig .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vlpamufqig .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vlpamufqig .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vlpamufqig .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vlpamufqig .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vlpamufqig .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vlpamufqig .gt_spanner_row {
  border-bottom-style: hidden;
}

#vlpamufqig .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vlpamufqig .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vlpamufqig .gt_from_md > :first-child {
  margin-top: 0;
}

#vlpamufqig .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vlpamufqig .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vlpamufqig .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vlpamufqig .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vlpamufqig .gt_row_group_first td {
  border-top-width: 2px;
}

#vlpamufqig .gt_row_group_first th {
  border-top-width: 2px;
}

#vlpamufqig .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlpamufqig .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vlpamufqig .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vlpamufqig .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlpamufqig .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlpamufqig .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vlpamufqig .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vlpamufqig .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vlpamufqig .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vlpamufqig .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlpamufqig .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlpamufqig .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vlpamufqig .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vlpamufqig .gt_left {
  text-align: left;
}

#vlpamufqig .gt_center {
  text-align: center;
}

#vlpamufqig .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vlpamufqig .gt_font_normal {
  font-weight: normal;
}

#vlpamufqig .gt_font_bold {
  font-weight: bold;
}

#vlpamufqig .gt_font_italic {
  font-style: italic;
}

#vlpamufqig .gt_super {
  font-size: 65%;
}

#vlpamufqig .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vlpamufqig .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vlpamufqig .gt_indent_1 {
  text-indent: 5px;
}

#vlpamufqig .gt_indent_2 {
  text-indent: 10px;
}

#vlpamufqig .gt_indent_3 {
  text-indent: 15px;
}

#vlpamufqig .gt_indent_4 {
  text-indent: 20px;
}

#vlpamufqig .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings gt_spanner_row">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="2" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="<strong>Table 1</strong>">
        <span class="gt_column_spanner"><strong>Table 1</strong></span>
      </th>
      <th class="gt_center gt_columns_top_border gt_column_spanner_outer" rowspan="1" colspan="3" scope="colgroup" id="<strong>Table 2</strong>">
        <span class="gt_column_spanner"><strong>Table 2</strong></span>
      </th>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>IRR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>IRR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>IRR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>IRR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(Age_Group)</td>
<td headers="estimate_1" class="gt_row gt_center"></td>
<td headers="ci_1" class="gt_row gt_center"></td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center"></td>
<td headers="ci_2" class="gt_row gt_center"></td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;&lt; 1 year</td>
<td headers="estimate_1" class="gt_row gt_center">—</td>
<td headers="ci_1" class="gt_row gt_center">—</td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center">—</td>
<td headers="ci_2" class="gt_row gt_center">—</td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1-4 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.05</td>
<td headers="ci_1" class="gt_row gt_center">0.04, 0.05</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.00</td>
<td headers="ci_2" class="gt_row gt_center">0.93, 1.08</td>
<td headers="p.value_2" class="gt_row gt_center">&gt;0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5-9 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.02</td>
<td headers="ci_1" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.00</td>
<td headers="ci_2" class="gt_row gt_center">0.91, 1.09</td>
<td headers="p.value_2" class="gt_row gt_center">&gt;0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;10-14 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.03</td>
<td headers="ci_1" class="gt_row gt_center">0.03, 0.03</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.00</td>
<td headers="ci_2" class="gt_row gt_center">0.92, 1.09</td>
<td headers="p.value_2" class="gt_row gt_center">&gt;0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;15-19 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.10</td>
<td headers="ci_1" class="gt_row gt_center">0.09, 0.10</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.00</td>
<td headers="ci_2" class="gt_row gt_center">0.95, 1.06</td>
<td headers="p.value_2" class="gt_row gt_center">&gt;0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-24 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.17</td>
<td headers="ci_1" class="gt_row gt_center">0.16, 0.18</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.96, 1.05</td>
<td headers="p.value_2" class="gt_row gt_center">0.8</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;25-34 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.20</td>
<td headers="ci_1" class="gt_row gt_center">0.19, 0.21</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.97, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.7</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;35-44 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.31</td>
<td headers="ci_1" class="gt_row gt_center">0.30, 0.32</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.97, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.8</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;45-54 years</td>
<td headers="estimate_1" class="gt_row gt_center">0.72</td>
<td headers="ci_1" class="gt_row gt_center">0.70, 0.75</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.98, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.6</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;55-64 years</td>
<td headers="estimate_1" class="gt_row gt_center">1.69</td>
<td headers="ci_1" class="gt_row gt_center">1.64, 1.74</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.98, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.6</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;65-74 years</td>
<td headers="estimate_1" class="gt_row gt_center">3.44</td>
<td headers="ci_1" class="gt_row gt_center">3.33, 3.54</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.98, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;75-84 years</td>
<td headers="estimate_1" class="gt_row gt_center">8.73</td>
<td headers="ci_1" class="gt_row gt_center">8.47, 9.00</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.01</td>
<td headers="ci_2" class="gt_row gt_center">0.98, 1.04</td>
<td headers="p.value_2" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;85+ years</td>
<td headers="estimate_1" class="gt_row gt_center">26.6</td>
<td headers="ci_1" class="gt_row gt_center">25.8, 27.4</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.02</td>
<td headers="ci_2" class="gt_row gt_center">0.99, 1.05</td>
<td headers="p.value_2" class="gt_row gt_center">0.3</td></tr>
    <tr><td headers="label" class="gt_row gt_left">State</td>
<td headers="estimate_1" class="gt_row gt_center"></td>
<td headers="ci_1" class="gt_row gt_center"></td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center"></td>
<td headers="ci_2" class="gt_row gt_center"></td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;California</td>
<td headers="estimate_1" class="gt_row gt_center">—</td>
<td headers="ci_1" class="gt_row gt_center">—</td>
<td headers="p.value_1" class="gt_row gt_center"></td>
<td headers="estimate_2" class="gt_row gt_center">—</td>
<td headers="ci_2" class="gt_row gt_center">—</td>
<td headers="p.value_2" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Texas</td>
<td headers="estimate_1" class="gt_row gt_center">1.19</td>
<td headers="ci_1" class="gt_row gt_center">1.18, 1.19</td>
<td headers="p.value_1" class="gt_row gt_center">&lt;0.001</td>
<td headers="estimate_2" class="gt_row gt_center">1.19</td>
<td headers="ci_2" class="gt_row gt_center">1.18, 1.19</td>
<td headers="p.value_2" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="7"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>This result is identical in terms of the difference between states, as the rate model above, and the results are invariant to the choice of the standard used, although when the age-specific expected count is used, the overall mortality pattern becomes insignificant in the model. This is an example of, despite different denominator/offset terms, we can achieve the same comparison from either the rate model or the model for relative risks.</p>
</section>
<section id="overdispersion" class="level2" data-number="5.11">
<h2 data-number="5.11" class="anchored" data-anchor-id="overdispersion"><span class="header-section-number">5.11</span> Overdispersion</h2>
<p>When using the Poisson GLM, you often run into <em>overdispersion</em>. What’s overdispersion you might ask? For the Poisson distribution, the mean and the variance are functions of one another (variance = mean for Poisson). So when you have more variability than you expect in your data, you have overdispersion. This basically says that your data do not fit your model, and is a problem because overdispersion leads to standard errors for our model parameters that are too small typically. But, we can fit other models that do not make such assumptions, or allow there to be more variability.</p>
<section id="checking-for-overdispersion" class="level4" data-number="5.11.0.1">
<h4 data-number="5.11.0.1" class="anchored" data-anchor-id="checking-for-overdispersion"><span class="header-section-number">5.11.0.1</span> Checking for overdispersion</h4>
<p>An easy check on this is to compare the residual deviance to the residual degrees of freedom. They ratio should be 1 if the model fits the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>scale<span class="ot">&lt;-</span><span class="fu">sqrt</span>(glmp_E<span class="sc">$</span>deviance<span class="sc">/</span>glmp_E<span class="sc">$</span>df.residual)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>scale</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, we see for the Poisson model, the scale factor is over 6, which shows evidence of overdispersion in the data. The residual deviance can also be used as a goodness of fit test for the model, because the deviance has been shown to be distributed as a <span class="math inline">\(\chi^2\)</span> distribution, with degrees of freedom equal to the residual d.f. (n-p):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pchisq</span>(glmp_E<span class="sc">$</span>deviance,</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">df =</span> glmp_E<span class="sc">$</span>df.residual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So, this p value is 0, which means the model does not fit the data. If the goodness of fit test had a p-value over 5 percent, we could conclude that the model in fact did fit the data.</p>
</section>
</section>
<section id="modeling-overdispersion-via-a-quasi-distribution" class="level2" data-number="5.12">
<h2 data-number="5.12" class="anchored" data-anchor-id="modeling-overdispersion-via-a-quasi-distribution"><span class="header-section-number">5.12</span> Modeling Overdispersion via a Quasi distribution</h2>
<p>For the Poisson and the Binomial, we can fit a “quasi” distribution that adds an extra parameter to allow the mean-variance relationship to not be constant. For Poisson we get:</p>
<p><span class="math inline">\(Var(Y) = \lambda * \phi\)</span>, instead of <span class="math inline">\(Var(Y) = \lambda\)</span></p>
<p>This accessory parameter <span class="math inline">\(\phi\)</span> allows us to include a rough proxy for a dispersion parameter for the distribution. Naturally this is fixed at 1 for the normal Poisson model, and estimated in the quasi models, we can look to see if is much bigger than 1. If overdispersion is present and not accounted for you could identify a relationship as being significant when it is not!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>glmqp <span class="ot">&lt;-</span> <span class="fu">glm</span>(Deaths <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(E)) <span class="sc">+</span> <span class="fu">factor</span>(Age_Group)<span class="sc">+</span>State,</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>txca,</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family=</span>quasipoisson)</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>glmqp<span class="sc">%&gt;%</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="wsvrzpkjgs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wsvrzpkjgs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wsvrzpkjgs thead, #wsvrzpkjgs tbody, #wsvrzpkjgs tfoot, #wsvrzpkjgs tr, #wsvrzpkjgs td, #wsvrzpkjgs th {
  border-style: none;
}

#wsvrzpkjgs p {
  margin: 0;
  padding: 0;
}

#wsvrzpkjgs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wsvrzpkjgs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wsvrzpkjgs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wsvrzpkjgs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wsvrzpkjgs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wsvrzpkjgs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsvrzpkjgs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wsvrzpkjgs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wsvrzpkjgs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wsvrzpkjgs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wsvrzpkjgs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wsvrzpkjgs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wsvrzpkjgs .gt_spanner_row {
  border-bottom-style: hidden;
}

#wsvrzpkjgs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wsvrzpkjgs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wsvrzpkjgs .gt_from_md > :first-child {
  margin-top: 0;
}

#wsvrzpkjgs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wsvrzpkjgs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wsvrzpkjgs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wsvrzpkjgs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wsvrzpkjgs .gt_row_group_first td {
  border-top-width: 2px;
}

#wsvrzpkjgs .gt_row_group_first th {
  border-top-width: 2px;
}

#wsvrzpkjgs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsvrzpkjgs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wsvrzpkjgs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wsvrzpkjgs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsvrzpkjgs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsvrzpkjgs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wsvrzpkjgs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wsvrzpkjgs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wsvrzpkjgs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wsvrzpkjgs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wsvrzpkjgs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsvrzpkjgs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wsvrzpkjgs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wsvrzpkjgs .gt_left {
  text-align: left;
}

#wsvrzpkjgs .gt_center {
  text-align: center;
}

#wsvrzpkjgs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wsvrzpkjgs .gt_font_normal {
  font-weight: normal;
}

#wsvrzpkjgs .gt_font_bold {
  font-weight: bold;
}

#wsvrzpkjgs .gt_font_italic {
  font-style: italic;
}

#wsvrzpkjgs .gt_super {
  font-size: 65%;
}

#wsvrzpkjgs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wsvrzpkjgs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wsvrzpkjgs .gt_indent_1 {
  text-indent: 5px;
}

#wsvrzpkjgs .gt_indent_2 {
  text-indent: 10px;
}

#wsvrzpkjgs .gt_indent_3 {
  text-indent: 15px;
}

#wsvrzpkjgs .gt_indent_4 {
  text-indent: 20px;
}

#wsvrzpkjgs .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>IRR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>IRR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(Age_Group)</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;&lt; 1 year</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1-4 years</td>
<td headers="estimate" class="gt_row gt_center">0.05</td>
<td headers="ci" class="gt_row gt_center">0.03, 0.07</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5-9 years</td>
<td headers="estimate" class="gt_row gt_center">0.02</td>
<td headers="ci" class="gt_row gt_center">0.01, 0.04</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;10-14 years</td>
<td headers="estimate" class="gt_row gt_center">0.03</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.05</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;15-19 years</td>
<td headers="estimate" class="gt_row gt_center">0.10</td>
<td headers="ci" class="gt_row gt_center">0.07, 0.13</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-24 years</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">0.13, 0.22</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;25-34 years</td>
<td headers="estimate" class="gt_row gt_center">0.20</td>
<td headers="ci" class="gt_row gt_center">0.16, 0.25</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;35-44 years</td>
<td headers="estimate" class="gt_row gt_center">0.31</td>
<td headers="ci" class="gt_row gt_center">0.25, 0.39</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;45-54 years</td>
<td headers="estimate" class="gt_row gt_center">0.72</td>
<td headers="ci" class="gt_row gt_center">0.59, 0.89</td>
<td headers="p.value" class="gt_row gt_center">0.008</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;55-64 years</td>
<td headers="estimate" class="gt_row gt_center">1.69</td>
<td headers="ci" class="gt_row gt_center">1.40, 2.06</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;65-74 years</td>
<td headers="estimate" class="gt_row gt_center">3.44</td>
<td headers="ci" class="gt_row gt_center">2.85, 4.19</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;75-84 years</td>
<td headers="estimate" class="gt_row gt_center">8.73</td>
<td headers="ci" class="gt_row gt_center">7.25, 10.6</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;85+ years</td>
<td headers="estimate" class="gt_row gt_center">26.6</td>
<td headers="ci" class="gt_row gt_center">22.1, 32.4</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">State</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;California</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Texas</td>
<td headers="estimate" class="gt_row gt_center">1.19</td>
<td headers="ci" class="gt_row gt_center">1.14, 1.23</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>While the overall pattern and substantive interpretation of the regular Poisson and the quasiPoisson models are identical, the standard errors of the parameters are not. We can see this by forming their ratios. The standard errors of the model parameters can be extracted from the <code>summary()$coefficients</code> of a model, specifically the second column of this table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>sum1<span class="ot">&lt;-</span> <span class="fu">summary</span>(glmp_E)<span class="sc">$</span>coef[, <span class="dv">2</span>]</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>sum2<span class="ot">&lt;-</span> <span class="fu">summary</span>(glmqp)<span class="sc">$</span>coef[, <span class="dv">2</span>]</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Poisson =</span> sum1,</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">QPoisson=</span> sum2,</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">coef =</span> <span class="fu">names</span>(<span class="fu">coef</span>(glmp_E)))<span class="sc">%&gt;%</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> QPoisson<span class="sc">/</span>Poisson, <span class="at">x=</span> coef))<span class="sc">+</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Ratio of Standard Errors"</span> )<span class="sc">+</span></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span> (<span class="st">"Parameter"</span>)<span class="sc">+</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Ratio of Standard Errors in Poisson and QuasiPoisson Models"</span>)<span class="sc">+</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This <strong>highly meaningful</strong> plot shows the ratio of all the standard errors is the same and is equal to the square root of the quasiPoisson dispersion parameter <span class="math inline">\(\phi\)</span>, which can be seen in <code>summary(glmqp)$dispersion</code>, in this case it is 6.3079315, which is extremely close to the <code>scale</code> we calculated earlier. The quasiPoisson model has a disadvantage however, in that, per the <code>?glm</code> documentation, is fit via quasi-likelihood methods and as such cannot be compared using AIC to other models.</p>
<section id="modeling-dispersion-properly" class="level3" data-number="5.12.1">
<h3 data-number="5.12.1" class="anchored" data-anchor-id="modeling-dispersion-properly"><span class="header-section-number">5.12.1</span> Modeling dispersion properly</h3>
<p>The <code>dispmod</code> package implements the method of Breslow <span class="citation" data-cites="breslow_extra-poisson_1984">(<a href="#ref-breslow_extra-poisson_1984" role="doc-biblioref">1984</a>)</span> which adds an extra parameter to account for the overdispersion in the Poisson, and is fit via regular maximum likelihood, so it is comparable to other models. Effectively, this takes either a model fit via <code>glm()</code> with either a Binomial or Poisson family, and performs a re-weighted estimate of the model parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dispmod)</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>glmp_d <span class="ot">&lt;-</span> <span class="fu">glm.poisson.disp</span>(glmp_E,</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">verbose =</span> F)</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>glmp_d<span class="sc">%&gt;%</span></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>(<span class="at">exp =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="bjakzozxjp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bjakzozxjp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bjakzozxjp thead, #bjakzozxjp tbody, #bjakzozxjp tfoot, #bjakzozxjp tr, #bjakzozxjp td, #bjakzozxjp th {
  border-style: none;
}

#bjakzozxjp p {
  margin: 0;
  padding: 0;
}

#bjakzozxjp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bjakzozxjp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bjakzozxjp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bjakzozxjp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bjakzozxjp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bjakzozxjp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bjakzozxjp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bjakzozxjp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bjakzozxjp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bjakzozxjp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bjakzozxjp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bjakzozxjp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bjakzozxjp .gt_spanner_row {
  border-bottom-style: hidden;
}

#bjakzozxjp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bjakzozxjp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bjakzozxjp .gt_from_md > :first-child {
  margin-top: 0;
}

#bjakzozxjp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bjakzozxjp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bjakzozxjp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bjakzozxjp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bjakzozxjp .gt_row_group_first td {
  border-top-width: 2px;
}

#bjakzozxjp .gt_row_group_first th {
  border-top-width: 2px;
}

#bjakzozxjp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bjakzozxjp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bjakzozxjp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bjakzozxjp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bjakzozxjp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bjakzozxjp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bjakzozxjp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bjakzozxjp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bjakzozxjp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bjakzozxjp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bjakzozxjp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bjakzozxjp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bjakzozxjp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bjakzozxjp .gt_left {
  text-align: left;
}

#bjakzozxjp .gt_center {
  text-align: center;
}

#bjakzozxjp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bjakzozxjp .gt_font_normal {
  font-weight: normal;
}

#bjakzozxjp .gt_font_bold {
  font-weight: bold;
}

#bjakzozxjp .gt_font_italic {
  font-style: italic;
}

#bjakzozxjp .gt_super {
  font-size: 65%;
}

#bjakzozxjp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bjakzozxjp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bjakzozxjp .gt_indent_1 {
  text-indent: 5px;
}

#bjakzozxjp .gt_indent_2 {
  text-indent: 10px;
}

#bjakzozxjp .gt_indent_3 {
  text-indent: 15px;
}

#bjakzozxjp .gt_indent_4 {
  text-indent: 20px;
}

#bjakzozxjp .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>IRR</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>IRR</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">factor(Age_Group)</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;&lt; 1 year</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;1-4 years</td>
<td headers="estimate" class="gt_row gt_center">0.05</td>
<td headers="ci" class="gt_row gt_center">0.04, 0.05</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;5-9 years</td>
<td headers="estimate" class="gt_row gt_center">0.02</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;10-14 years</td>
<td headers="estimate" class="gt_row gt_center">0.03</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;15-19 years</td>
<td headers="estimate" class="gt_row gt_center">0.10</td>
<td headers="ci" class="gt_row gt_center">0.09, 0.10</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;20-24 years</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">0.16, 0.19</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;25-34 years</td>
<td headers="estimate" class="gt_row gt_center">0.20</td>
<td headers="ci" class="gt_row gt_center">0.18, 0.22</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;35-44 years</td>
<td headers="estimate" class="gt_row gt_center">0.31</td>
<td headers="ci" class="gt_row gt_center">0.29, 0.34</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;45-54 years</td>
<td headers="estimate" class="gt_row gt_center">0.72</td>
<td headers="ci" class="gt_row gt_center">0.66, 0.79</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;55-64 years</td>
<td headers="estimate" class="gt_row gt_center">1.70</td>
<td headers="ci" class="gt_row gt_center">1.56, 1.85</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;65-74 years</td>
<td headers="estimate" class="gt_row gt_center">3.45</td>
<td headers="ci" class="gt_row gt_center">3.16, 3.76</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;75-84 years</td>
<td headers="estimate" class="gt_row gt_center">8.73</td>
<td headers="ci" class="gt_row gt_center">8.01, 9.52</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;85+ years</td>
<td headers="estimate" class="gt_row gt_center">26.4</td>
<td headers="ci" class="gt_row gt_center">24.2, 28.8</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">State</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;California</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;Texas</td>
<td headers="estimate" class="gt_row gt_center">1.24</td>
<td headers="ci" class="gt_row gt_center">1.20, 1.29</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>In this example the difference between California and Texas is now larger at a 24% higher mortality rate in Texas. How does this model compare to the regular Poisson model?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(glmp_E, glmp_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       df      AIC
glmp_E 14 773.7668
glmp_d 14  90.3267</code></pre>
</div>
</div>
<p>The dispersed model shows a much lower AIC suggesting that the dispersion accounted for in the the Breslow model is likely important. We can see how the dispersed Poisson model’s standard errors compare to those of the regular Poisson using the same plot we saw earlier:</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="macro_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In this case, the standard errors are not just a monotone transformation of the Poisson model errors, they each have their own scaling, which shows the dispersed Poisson model is doing something different compared to the quasiPoisson model by not using a single scaling factor for all the standard errors.</p>
</section>
</section>
<section id="other-count-models" class="level2" data-number="5.13">
<h2 data-number="5.13" class="anchored" data-anchor-id="other-count-models"><span class="header-section-number">5.13</span> Other count models</h2>
<p>The Poisson and Binomial models are probably the most commonly used models for rates and proportions, but other models exist that offer more flexibility. Specifically the Beta distribution and the Negative Binomial distribution.</p>
<section id="beta-distribution-model" class="level3" data-number="5.13.1">
<h3 data-number="5.13.1" class="anchored" data-anchor-id="beta-distribution-model"><span class="header-section-number">5.13.1</span> Beta distribution model</h3>
<p>The Beta distribution is a commonly used model for the prior distribution for the mean of the Binomial, as it has values between 0 and 1, but it is not used as often as an outcome distribution. It is indeed quite flexible as an outcome distribution for proportions because of its range of support, but also because it has an additional dispersion parameter, unlike the Binomial, so the pitfalls of overdispersion often present in the Binomial can be avoided. The <code>betareg</code> package <span class="citation" data-cites="betareg">(<a href="#ref-betareg" role="doc-biblioref">Grün, Kosmidis, and Zeileis 2012</a>)</span> implements the Beta regression model. The distribution has density:</p>
<p><span class="math display">\[
f(y:p,q) = \frac{\Gamma(p +
q)}{\Gamma(p)\Gamma(q)}x^{p - 1}(1 - x)^{q - 1}
\]</span> Where <span class="math inline">\(\Gamma\)</span> is the Gamma function. The distribution, as parameterized in <code>betareg</code> has mean and variance:</p>
<p><span class="math display">\[
\mu = p/(p+q) \\
Var = \mu (1-\mu)/ (1+\phi)
\]</span></p>
<p>Where <span class="math inline">\(phi\)</span> is a precision parameter. The model is linked to the linear predictor using one of the same link functions as the Binomial model: Logit, Probit or Complementary Log-Log.</p>
<p><span class="math display">\[g(\mu_i) = X'\beta = \eta_i\]</span> The Logit link is parameterized as:</p>
<p><span class="math display">\[logit(g(\mu)) = log(\mu / (1-\mu))\]</span> As described in their article on the <code>betareg</code> package <span class="citation" data-cites="cribari-neto_beta_2010">(<a href="#ref-cribari-neto_beta_2010" role="doc-biblioref">Cribari-Neto and Zeileis 2010</a>)</span>, the model can also include a separate model for dispersion, so you can model the variance in the data as well as the mean.</p>
<p>The <code>betareg::betareg()</code> function implements model, and here is an application of the model to the low birth weight data used earlier:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(betareg)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>glm_beta<span class="ot">&lt;-</span><span class="fu">betareg</span>(<span class="fu">I</span>(lbrate1618<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16, </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>ahrf_m)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_beta)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
betareg(formula = I(lbrate1618/1000) ~ fampov14 + rucc + hpsa16, data = ahrf_m)

Standardized weighted residuals 2:
    Min      1Q  Median      3Q     Max 
-7.0393 -0.6234 -0.0110  0.6338  3.7500 

Coefficients (mean model with logit link):
                                Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept)                   -2.6387868  0.0150612 -175.204  &lt; 2e-16 ***
fampov14                       0.0252868  0.0007936   31.862  &lt; 2e-16 ***
rucc02                        -0.0188140  0.0150716   -1.248 0.211917    
rucc03                        -0.0400036  0.0157581   -2.539 0.011129 *  
rucc04                        -0.0798596  0.0177856   -4.490 7.12e-06 ***
rucc05                        -0.0734111  0.0242750   -3.024 0.002493 ** 
rucc06                        -0.0494087  0.0142816   -3.460 0.000541 ***
rucc07                        -0.0498176  0.0159746   -3.119 0.001817 ** 
rucc08                         0.0038585  0.0252486    0.153 0.878541    
rucc09                        -0.0636793  0.0274465   -2.320 0.020334 *  
hpsa16partial county shortage -0.0019801  0.0128139   -0.155 0.877196    
hpsa16whole county shortage    0.0278359  0.0156183    1.782 0.074706 .  

Phi coefficients (precision model with identity link):
      Estimate Std. Error z value Pr(&gt;|z|)    
(phi)  304.733      8.948   34.06   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood:  6347 on 13 Df
Pseudo R-squared: 0.355
Number of iterations: 23 (BFGS) + 3 (Fisher scoring) </code></pre>
</div>
</div>
<p>And the model with a separate model for the dispersion can be estimated by including a second formula separated by a <code>|</code> as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(betareg)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>glm_beta_o<span class="ot">&lt;-</span><span class="fu">betareg</span>(<span class="fu">I</span>(lbrate1618<span class="sc">/</span><span class="dv">1000</span>) <span class="sc">~</span>  fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16 <span class="sc">|</span> <span class="fu">scale</span>(popn), </span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>ahrf_m)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glm_beta_o)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
betareg(formula = I(lbrate1618/1000) ~ fampov14 + rucc + hpsa16 | scale(popn), 
    data = ahrf_m)

Standardized weighted residuals 2:
    Min      1Q  Median      3Q     Max 
-6.9251 -0.6169 -0.0023  0.6500  3.7111 

Coefficients (mean model with logit link):
                                Estimate Std. Error  z value Pr(&gt;|z|)    
(Intercept)                   -2.6421609  0.0149203 -177.085  &lt; 2e-16 ***
fampov14                       0.0251141  0.0007938   31.639  &lt; 2e-16 ***
rucc02                        -0.0124912  0.0146382   -0.853  0.39348    
rucc03                        -0.0327516  0.0154238   -2.123  0.03372 *  
rucc04                        -0.0721414  0.0175194   -4.118 3.83e-05 ***
rucc05                        -0.0655256  0.0241470   -2.714  0.00666 ** 
rucc06                        -0.0415704  0.0139537   -2.979  0.00289 ** 
rucc07                        -0.0417441  0.0156940   -2.660  0.00782 ** 
rucc08                         0.0118585  0.0252317    0.470  0.63837    
rucc09                        -0.0550535  0.0274518   -2.005  0.04491 *  
hpsa16partial county shortage -0.0048007  0.0127864   -0.375  0.70733    
hpsa16whole county shortage    0.0270952  0.0156837    1.728  0.08406 .  

Phi coefficients (precision model with log link):
            Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  5.72714    0.02936 195.063  &lt; 2e-16 ***
scale(popn)  0.08419    0.02929   2.874  0.00405 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 

Type of estimator: ML (maximum likelihood)
Log-likelihood:  6355 on 14 Df
Pseudo R-squared: 0.3548
Number of iterations: 21 (BFGS) + 5 (Fisher scoring) </code></pre>
</div>
</div>
<p>The AIC can be used to determine if the dispersion model is preferred to the regular beta regression.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(glm_beta, glm_beta_o)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           df       AIC
glm_beta   13 -12668.24
glm_beta_o 14 -12682.02</code></pre>
</div>
</div>
<p>In this case, the dispersion model is preferred since the AIC is 13.78 points lower for the dispersion model.</p>
</section>
<section id="negative-binomial-model" class="level3" data-number="5.13.2">
<h3 data-number="5.13.2" class="anchored" data-anchor-id="negative-binomial-model"><span class="header-section-number">5.13.2</span> Negative binomial model</h3>
<p>When overdispersion is present, many researchers will automatically turn to the Negative Binomial as an alternative. The Negative Binomial sounds like it is some alternative to the Binomial distribution, but it is more like the Poisson. It effectively adds a second parameter to a model for integer counts. The model has been parameterized in several ways. The most common are the NB1 and NB2 models. The difference is how the model allows the variance to increase with the mean. The NB1 model allows for variance to increase linearly with the mean:</p>
<p><span class="math display">\[
Y \sim NB (\lambda, \lambda+ \theta \lambda) \\
E(Y) = \lambda \\
\text{   } var(Y) = \lambda+\theta\lambda \\
\lambda = log(\eta) \\
\eta = \beta_0 + \beta_1 x_1+ log(n)
\]</span> The NB2 model, which is the most commonly implemented in software, allows the variance to increase as a square with the mean.</p>
<p><span class="math display">\[
Y \sim NB (\lambda, \lambda+ \theta \lambda^2) \\
E(Y) = \lambda \\
\text{   } var(Y) = \lambda+ \theta \lambda^2 \\
\lambda = log(\eta) \\
\eta = \beta_0 + \beta_1 x_1+ log(n)
\]</span></p>
<p>The base R <code>glm()</code> does not offer the NB1 model by default, but the standard <code>MASS</code> package <span class="citation" data-cites="venables_ripley">(<a href="#ref-venables_ripley" role="doc-biblioref">Venables and Ripley 2002</a>)</span> has the <code>glm.nb()</code> function. An alternative is the highly flexible <code>gamlss</code> package<span class="citation" data-cites="gamlss">(<a href="#ref-gamlss" role="doc-biblioref">Rigby and Stasinopoulos 2005</a>)</span>, which includes the NB2 model, as well as a host of other distributions, plus the ability to model mean and variance, similar to how <code>betareg()</code> was achieving for the Beta distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:gtsummary':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>glmnb<span class="ot">&lt;-</span> <span class="fu">glm.nb</span>(lowbw1618 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(births1618)) <span class="sc">+</span> fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16 ,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>ahrf_m)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>glmnb<span class="sc">%&gt;%</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tbl_regression</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div id="ulgxuvhasz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ulgxuvhasz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ulgxuvhasz thead, #ulgxuvhasz tbody, #ulgxuvhasz tfoot, #ulgxuvhasz tr, #ulgxuvhasz td, #ulgxuvhasz th {
  border-style: none;
}

#ulgxuvhasz p {
  margin: 0;
  padding: 0;
}

#ulgxuvhasz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ulgxuvhasz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ulgxuvhasz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ulgxuvhasz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ulgxuvhasz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ulgxuvhasz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulgxuvhasz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ulgxuvhasz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ulgxuvhasz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ulgxuvhasz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ulgxuvhasz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ulgxuvhasz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ulgxuvhasz .gt_spanner_row {
  border-bottom-style: hidden;
}

#ulgxuvhasz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ulgxuvhasz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ulgxuvhasz .gt_from_md > :first-child {
  margin-top: 0;
}

#ulgxuvhasz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ulgxuvhasz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ulgxuvhasz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ulgxuvhasz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ulgxuvhasz .gt_row_group_first td {
  border-top-width: 2px;
}

#ulgxuvhasz .gt_row_group_first th {
  border-top-width: 2px;
}

#ulgxuvhasz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulgxuvhasz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ulgxuvhasz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ulgxuvhasz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulgxuvhasz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulgxuvhasz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ulgxuvhasz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ulgxuvhasz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ulgxuvhasz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ulgxuvhasz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ulgxuvhasz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulgxuvhasz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ulgxuvhasz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ulgxuvhasz .gt_left {
  text-align: left;
}

#ulgxuvhasz .gt_center {
  text-align: center;
}

#ulgxuvhasz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ulgxuvhasz .gt_font_normal {
  font-weight: normal;
}

#ulgxuvhasz .gt_font_bold {
  font-weight: bold;
}

#ulgxuvhasz .gt_font_italic {
  font-style: italic;
}

#ulgxuvhasz .gt_super {
  font-size: 65%;
}

#ulgxuvhasz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ulgxuvhasz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ulgxuvhasz .gt_indent_1 {
  text-indent: 5px;
}

#ulgxuvhasz .gt_indent_2 {
  text-indent: 10px;
}

#ulgxuvhasz .gt_indent_3 {
  text-indent: 15px;
}

#ulgxuvhasz .gt_indent_4 {
  text-indent: 20px;
}

#ulgxuvhasz .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>log(IRR)</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>log(IRR)</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>"><strong>95% CI</strong><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left">% Families Below Poverty Level 2014-18</td>
<td headers="estimate" class="gt_row gt_center">0.03</td>
<td headers="ci" class="gt_row gt_center">0.02, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">rucc</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;01</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;02</td>
<td headers="estimate" class="gt_row gt_center">-0.02</td>
<td headers="ci" class="gt_row gt_center">-0.04, 0.01</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;03</td>
<td headers="estimate" class="gt_row gt_center">-0.04</td>
<td headers="ci" class="gt_row gt_center">-0.07, -0.02</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;04</td>
<td headers="estimate" class="gt_row gt_center">-0.08</td>
<td headers="ci" class="gt_row gt_center">-0.11, -0.05</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;05</td>
<td headers="estimate" class="gt_row gt_center">-0.07</td>
<td headers="ci" class="gt_row gt_center">-0.12, -0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;06</td>
<td headers="estimate" class="gt_row gt_center">-0.06</td>
<td headers="ci" class="gt_row gt_center">-0.08, -0.03</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;07</td>
<td headers="estimate" class="gt_row gt_center">-0.07</td>
<td headers="ci" class="gt_row gt_center">-0.10, -0.04</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;08</td>
<td headers="estimate" class="gt_row gt_center">-0.01</td>
<td headers="ci" class="gt_row gt_center">-0.07, 0.06</td>
<td headers="p.value" class="gt_row gt_center">0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;09</td>
<td headers="estimate" class="gt_row gt_center">-0.09</td>
<td headers="ci" class="gt_row gt_center">-0.16, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.021</td></tr>
    <tr><td headers="label" class="gt_row gt_left">hpsa16</td>
<td headers="estimate" class="gt_row gt_center"></td>
<td headers="ci" class="gt_row gt_center"></td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;no shortage</td>
<td headers="estimate" class="gt_row gt_center">—</td>
<td headers="ci" class="gt_row gt_center">—</td>
<td headers="p.value" class="gt_row gt_center"></td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;partial county shortage</td>
<td headers="estimate" class="gt_row gt_center">-0.01</td>
<td headers="ci" class="gt_row gt_center">-0.03, 0.01</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left">&nbsp;&nbsp;&nbsp;&nbsp;whole county shortage</td>
<td headers="estimate" class="gt_row gt_center">0.00</td>
<td headers="ci" class="gt_row gt_center">-0.03, 0.03</td>
<td headers="p.value" class="gt_row gt_center">&gt;0.9</td></tr>
  </tbody>
  
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> IRR = Incidence Rate Ratio, CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
</div>
</div>
<p>The NB2 version of the model can be estimated using <code>gamlss()</code> with <code>family=NBII</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gamlss.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gamlss.data'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:datasets':

    sleep</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gamlss.dist</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: parallel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'gamlss':
  method   from
  print.ri bit </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code> **********   GAMLSS Version 5.4-12  ********** </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>For more on GAMLSS look at https://www.gamlss.com/</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type gamlssNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>glmnb2<span class="ot">&lt;-</span><span class="fu">gamlss</span>(lowbw1618 <span class="sc">~</span> <span class="fu">offset</span>(<span class="fu">log</span>(births1618)) <span class="sc">+</span> fampov14 <span class="sc">+</span> rucc <span class="sc">+</span> hpsa16,</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> NBII,</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data=</span>ahrf_m)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAMLSS-RS iteration 1: Global Deviance = 27778.63 
GAMLSS-RS iteration 2: Global Deviance = 26730.85 
GAMLSS-RS iteration 3: Global Deviance = 25316.94 
GAMLSS-RS iteration 4: Global Deviance = 23326.65 
GAMLSS-RS iteration 5: Global Deviance = 20580.7 
GAMLSS-RS iteration 6: Global Deviance = 18480.22 
GAMLSS-RS iteration 7: Global Deviance = 18277.94 
GAMLSS-RS iteration 8: Global Deviance = 18277.03 
GAMLSS-RS iteration 9: Global Deviance = 18277.03 
GAMLSS-RS iteration 10: Global Deviance = 18277.03 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glmnb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>******************************************************************
Family:  c("NBII", "Negative Binomial type II") 

Call:  gamlss(formula = lowbw1618 ~ offset(log(births1618)) +  
    fampov14 + rucc + hpsa16, family = NBII, data = ahrf_m) 

Fitting method: RS() 

------------------------------------------------------------------
Mu link function:  log
Mu Coefficients:
                                Estimate Std. Error  t value Pr(&gt;|t|)    
(Intercept)                   -2.6762604  0.0122536 -218.407   &lt;2e-16 ***
fampov14                       0.0189986  0.0006901   27.532   &lt;2e-16 ***
rucc02                        -0.0124200  0.0080482   -1.543   0.1229    
rucc03                        -0.0166503  0.0113856   -1.462   0.1438    
rucc04                        -0.0401176  0.0163552   -2.453   0.0142 *  
rucc05                        -0.0291354  0.0254089   -1.147   0.2516    
rucc06                         0.0058763  0.0161169    0.365   0.7154    
rucc07                         0.0068020  0.0211064    0.322   0.7473    
rucc08                         0.0941871  0.0493463    1.909   0.0564 .  
rucc09                         0.0208654  0.0546114    0.382   0.7024    
hpsa16partial county shortage -0.0203470  0.0117608   -1.730   0.0838 .  
hpsa16whole county shortage    0.0082867  0.0195254    0.424   0.6713    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
Sigma link function:  log
Sigma Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.72887    0.04354   16.74   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

------------------------------------------------------------------
No. of observations in the fit:  2324 
Degrees of Freedom for the fit:  13
      Residual Deg. of Freedom:  2311 
                      at cycle:  10 
 
Global Deviance:     18277.03 
            AIC:     18303.03 
            SBC:     18377.79 
******************************************************************</code></pre>
</div>
</div>
<p>Again, between these two different specifications, we see very similar results. We can compare each of the models, starting with the Gaussian model and proceeding through the NB2 model above (although the Beta regression appears to be on a different scale since the outcome is specified as probability, versus a count, so it is not comparable to the rest) using the <code>AIC()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(glm1, glmb, glmp_b, glmnb, glmnb2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       df      AIC
glm1   13 19599.34
glmb   12 20980.41
glmp_b 12 20517.93
glmnb  13 16866.26
glmnb2 13 18303.03</code></pre>
</div>
</div>
<p>We see that among these five model specifications, the Binomial fits the worst and the NB1 model, estimated by <code>glm.nb()</code> fits the best, with the lowest AIC among these five models.</p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-anselin_spatial_1988" class="csl-entry" role="listitem">
Anselin, Luc. 1988. <em>Spatial <span>Econometrics</span>: <span>Methods</span> and <span>Models</span>.</em> Dordrecht: Springer Netherlands.
</div>
<div id="ref-breslow_extra-poisson_1984" class="csl-entry" role="listitem">
Breslow, N. E. 1984. <span>“Extra-<span>Poisson</span> <span>Variation</span> in <span>Log</span>-<span>Linear</span> <span>Models</span>.”</span> <em>Applied Statistics</em> 33 (1): 38. <a href="https://doi.org/10.2307/2347661">https://doi.org/10.2307/2347661</a>.
</div>
<div id="ref-us_census_bureau_worked_nodate" class="csl-entry" role="listitem">
Bureau, US Census. 2019. <span>“Worked <span>Examples</span> for <span>Approximating</span> <span>Standard</span> <span>Errors</span> <span>Using</span> <span>American</span> <span>Community</span> <span>Survey</span> <span>Data</span>.”</span> <a href="https://www2.census.gov/programs-surveys/acs/tech_docs/accuracy/2018_ACS_Accuracy_Document_Worked_Examples.pdf">https://www2.census.gov/programs-surveys/acs/tech_docs/accuracy/2018_ACS_Accuracy_Document_Worked_Examples.pdf</a>.
</div>
<div id="ref-chi_spatial_2020" class="csl-entry" role="listitem">
Chi, Guangqing, and Jun Zhu. 2020. <em>Spatial Regression Models for the Social Sciences</em>. Los Angeles: SAGE.
</div>
<div id="ref-courtemanche2019" class="csl-entry" role="listitem">
Courtemanche, Charles, James Marton, Benjamin Ukert, Aaron Yelowitz, and Daniela Zapata. 2019. <span>“Effects of the Affordable Care Act on Health Behaviors After 3&nbsp;Years.”</span> <em>Eastern Economic Journal</em> 45 (1): 7–33. <a href="https://doi.org/10.1057/s41302-018-0119-4">https://doi.org/10.1057/s41302-018-0119-4</a>.
</div>
<div id="ref-cribari-neto_beta_2010" class="csl-entry" role="listitem">
Cribari-Neto, Francisco, and Achim Zeileis. 2010. <span>“Beta <span>Regression</span> in <em>r</em>.”</span> <em>Journal of Statistical Software</em> 34 (2). <a href="https://doi.org/10.18637/jss.v034.i02">https://doi.org/10.18637/jss.v034.i02</a>.
</div>
<div id="ref-united_nations_population_division_manual_1983" class="csl-entry" role="listitem">
Division, United Nations Population. 1983. <span>“Manual <span>X</span>: <span>Indirect</span> <span>Techniques</span> for <span>Demographic</span> <span>Estimation</span>.”</span> New York, NY. <a href="https://www.un.org/en/development/desa/population/publications/manual/estimate/demographic-estimation.asp">https://www.un.org/en/development/desa/population/publications/manual/estimate/demographic-estimation.asp</a>.
</div>
<div id="ref-elhorst_spatial_2014" class="csl-entry" role="listitem">
Elhorst, J. Paul. 2014. <em>Spatial <span>Econometrics</span>: <span>From</span> <span>Cross</span>-<span>Sectional</span> <span>Data</span> to <span>Spatial</span> <span>Panels</span></em>. 1st ed. 2014. <span>SpringerBriefs</span> in <span>Regional</span> <span>Science</span>. Berlin, Heidelberg: Springer Berlin Heidelberg : Imprint: Springer. <a href="https://doi.org/10.1007/978-3-642-40340-8">https://doi.org/10.1007/978-3-642-40340-8</a>.
</div>
<div id="ref-fox_applied_2016" class="csl-entry" role="listitem">
Fox, John. 2016. <em>Applied Regression Analysis and Generalized Linear Models</em>. Third Edition. Los Angeles: SAGE.
</div>
<div id="ref-betareg" class="csl-entry" role="listitem">
Grün, Bettina, Ioannis Kosmidis, and Achim Zeileis. 2012. <span>“Extended Beta Regression in <span>R</span>: Shaken, Stirred, Mixed, and Partitioned.”</span> <em>Journal of Statistical Software</em> 48 (11): 1–25. <a href="https://doi.org/10.18637/jss.v048.i11">https://doi.org/10.18637/jss.v048.i11</a>.
</div>
<div id="ref-keyfitz_introduction_1968" class="csl-entry" role="listitem">
Keyfitz, Nathan. 1968. <em>Introduction to the <span>Mathematics</span> of <span>Population</span></em>. Addison-Wesley Publishing Company.
</div>
<div id="ref-lesage_introduction_2009" class="csl-entry" role="listitem">
LeSage, James P., and R. Kelley Pace. 2009. <em>Introduction to Spatial Econometrics</em>. Statistics, Textbooks and Monographs. Boca Raton: CRC Press.
</div>
<div id="ref-long_using_2000" class="csl-entry" role="listitem">
Long, J. Scott, and Laurie H. Ervin. 2000. <span>“Using <span>Heteroscedasticity</span> <span>Consistent</span> <span>Standard</span> <span>Errors</span> in the <span>Linear</span> <span>Regression</span> <span>Model</span>.”</span> <em>The American Statistician</em> 54 (3): 217–24. <a href="https://doi.org/10.1080/00031305.2000.10474549">https://doi.org/10.1080/00031305.2000.10474549</a>.
</div>
<div id="ref-mackinnon_white_1985" class="csl-entry" role="listitem">
MacKinnon, James G, and Halbert White. 1985. <span>“Some Heteroskedasticity-Consistent Covariance Matrix Estimators with Improved Finite Sample Properties.”</span> <em>Journal of Econometrics</em> 29 (3): 305–25. <a href="https://doi.org/10.1016/0304-4076(85)90158-7">https://doi.org/10.1016/0304-4076(85)90158-7</a>.
</div>
<div id="ref-nhgis" class="csl-entry" role="listitem">
Manson, Steven, Jonathan Schroeder, David Van Riper, Tracy Kugler, and Steven Ruggles. 2021. <em>IPUMS National Historical Geographic Information System: Version 16.0 [Dataset]</em>. https://doi.org/<a href="http://doi.org/10.18128/D050.V16.0">http://doi.org/10.18128/D050.V16.0</a>.
</div>
<div id="ref-mccullagh_generalized_1998" class="csl-entry" role="listitem">
McCullagh, P., and John A. Nelder. 1998. <em>Generalized Linear Models</em>. 2nd ed. Monographs on Statistics and Applied Probability 37. Boca Raton: Chapman &amp; Hall/CRC.
</div>
<div id="ref-mclaughlin_differential_2007" class="csl-entry" role="listitem">
McLaughlin, Diane K., C. Shannon Stokes, P. Johnelle Smith, and A Nonoyama. 2007. <span>“Differential Mortality Across the <span>United</span> <span>States</span>: The Influence of Place-Based Inequality.”</span> In <em>Sociology of <span>Spatial</span> <span>Inequality</span></em>, 141–62. State University of New York Press.
</div>
<div id="ref-nelder_generalized_1972" class="csl-entry" role="listitem">
Nelder, J. A., and R. W. M. Wedderburn. 1972. <span>“Generalized <span>Linear</span> <span>Models</span>.”</span> <em>Journal of the Royal Statistical Society: Series A (General)</em> 135 (3): 370–84. <a href="https://doi.org/10.2307/2344614">https://doi.org/10.2307/2344614</a>.
</div>
<div id="ref-pinheiro_mixed-effects_2000" class="csl-entry" role="listitem">
Pinheiro, José C., and Douglas M. Bates. 2000. <em>Mixed-Effects Models in <span>S</span> and <span>S</span>-<span>PLUS</span></em>. Statistics and Computing. New York: Springer.
</div>
<div id="ref-gamlss" class="csl-entry" role="listitem">
Rigby, R. A., and D. M. Stasinopoulos. 2005. <span>“Generalized Additive Models for Location, Scale and Shape,(with Discussion).”</span> <em>Applied Statistics</em> 54.3: 507–54.
</div>
<div id="ref-gtsummary" class="csl-entry" role="listitem">
Sjoberg, Daniel D., Karissa Whiting, Michael Curry, Jessica A. Lavery, and Joseph Larmarange. 2021. <span>“Reproducible Summary Tables with the Gtsummary Package.”</span> <em><span>The R Journal</span></em> 13: 570–80. <a href="https://doi.org/10.32614/RJ-2021-053">https://doi.org/10.32614/RJ-2021-053</a>.
</div>
<div id="ref-soni2017a" class="csl-entry" role="listitem">
Soni, Aparna, Michael Hendryx, and Kosali Simon. 2017. <span>“Medicaid Expansion Under the Affordable Care Act and Insurance Coverage in Rural and Urban Areas.”</span> <em>The Journal of Rural Health</em> 33 (2): 217–26. <a href="https://doi.org/10.1111/jrh.12234">https://doi.org/10.1111/jrh.12234</a>.
</div>
<div id="ref-sparks_application_2010" class="csl-entry" role="listitem">
Sparks, Patrice Johnelle, and Corey S. Sparks. 2010. <span>“An Application of Spatially Autoregressive Models to the Study of <span>US</span> County Mortality Rates: <span>An</span> <span>Application</span> of <span>Spatially</span> <span>Autoregressive</span> <span>Models</span>.”</span> <em>Population, Space and Place</em> 16 (6): 465–81. <a href="https://doi.org/10.1002/psp.564">https://doi.org/10.1002/psp.564</a>.
</div>
<div id="ref-venables_ripley" class="csl-entry" role="listitem">
Venables, W. N., and B. D. Ripley. 2002. <em>Modern Applied Statistics with s</em>. Fourth. New York: Springer. <a href="https://www.stats.ox.ac.uk/pub/MASS4/">https://www.stats.ox.ac.uk/pub/MASS4/</a>.
</div>
<div id="ref-voss_demography_2007" class="csl-entry" role="listitem">
Voss, Paul R. 2007. <span>“Demography as a <span>Spatial</span> <span>Social</span> <span>Science</span>.”</span> <em>Population Research and Policy Review</em> 26 (5-6): 457–76. <a href="https://doi.org/10.1007/s11113-007-9047-4">https://doi.org/10.1007/s11113-007-9047-4</a>.
</div>
<div id="ref-tigris" class="csl-entry" role="listitem">
Walker, Kyle. 2021. <em>Tigris: Load Census TIGER/Line Shapefiles</em>. <a href="https://CRAN.R-project.org/package=tigris">https://CRAN.R-project.org/package=tigris</a>.
</div>
<div id="ref-walker21" class="csl-entry" role="listitem">
Walker, Kyle, and Matt Herman. 2021. <em>Tidycensus: Load US Census Boundary and Attribute Data as ’Tidyverse’ and ’Sf’-Ready Data Frames</em>. <a href="https://CRAN.R-project.org/package=tidycensus">https://CRAN.R-project.org/package=tidycensus</a>.
</div>
<div id="ref-rdhs" class="csl-entry" role="listitem">
Watson, Oliver J, Rich FitzJohn, and Jeffrey W Eaton. 2019. <span>“Rdhs: An r Package to Interact with the Demographic and Health Surveys (DHS) Program Datasets.”</span> <em>Wellcome Open Research</em> 4: 103. <a href="https://doi.org/10.12688/wellcomeopenres.15311.1">https://doi.org/10.12688/wellcomeopenres.15311.1</a>.
</div>
<div id="ref-white_1980" class="csl-entry" role="listitem">
White, Halbert. 1980. <span>“A <span>Heteroskedasticity</span>-<span>Consistent</span> <span>Covariance</span> <span>Matrix</span> <span>Estimator</span> and a <span>Direct</span> <span>Test</span> for <span>Heteroskedasticity</span>.”</span> <em>Econometrica</em> 48 (4): 817. <a href="https://doi.org/10.2307/1912934">https://doi.org/10.2307/1912934</a>.
</div>
</div>
</section>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><span class="math inline">\(\bar{y}= \text{mean of y}\)</span>, <span class="math inline">\(\bar{x}= \text{mean of x}\)</span><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>http://api.census.gov/data/key_signup.html<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Link to AHRF codebook - <a href="https://data.hrsa.gov/DataDownload/AHRF/AHRF_USER_TECH_2019-2020.zip">“https://data.hrsa.gov/DataDownload/AHRF/AHRF_USER_TECH_2019-2020.zip”</a><a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>More on this below<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>More on this below<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>Link to AHRF codebook - <a href="https://data.hrsa.gov/DataDownload/AHRF/AHRF_USER_TECH_2019-2020.zip">“https://data.hrsa.gov/DataDownload/AHRF/AHRF_USER_TECH_2019-2020.zip”</a><a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./survey.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Analysis of Survey Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./micro.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Event History Models for Microdemography</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>